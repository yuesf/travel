<!-- æ™¯ç‚¹è¯¦æƒ…é¡µï¼ˆç‹¬ç«‹ï¼‰ -->
<view class="page-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view wx:elif="{{detail}}" class="content-container">
    <!-- å›¾ç‰‡/è§†é¢‘è½®æ’­åŒºåŸŸ -->
    <view class="swiper-container">
      <swiper
        class="swiper"
        indicator-dots="{{mediaList.length > 1}}"
        indicator-color="rgba(255, 255, 255, 0.5)"
        indicator-active-color="#ffffff"
        autoplay="{{mediaList.length > 1}}"
        interval="{{3000}}"
        duration="{{500}}"
        circular="{{true}}"
        bindchange="onSwiperChange"
      >
        <swiper-item wx:for="{{mediaList}}" wx:key="index">
          <!-- å›¾ç‰‡ -->
          <image
            wx:if="{{item.type === 'image'}}"
            class="swiper-image"
            src="{{item.url}}"
            mode="aspectFill"
            data-index="{{index}}"
            bindtap="onImageTap"
          />
          <!-- è§†é¢‘ -->
          <video
            wx:elif="{{item.type === 'video'}}"
            class="swiper-video"
            src="{{item.url}}"
            poster="{{item.poster}}"
            controls="{{true}}"
            show-center-play-btn="{{true}}"
            enable-play-gesture="{{true}}"
            bindplay="onVideoPlay"
            bindfullscreenchange="onVideoFullscreenChange"
          />
        </swiper-item>
      </swiper>
      <!-- è½®æ’­æŒ‡ç¤ºå™¨ -->
      <view wx:if="{{mediaList.length > 1}}" class="swiper-indicator">
        <text class="swiper-indicator-text">{{currentSwiperIndex + 1}}/{{mediaList.length}}</text>
      </view>
    </view>

    <!-- åŸºæœ¬ä¿¡æ¯åŒºåŸŸ -->
    <view class="info-section">
      <view class="info-header">
        <text class="info-name">{{detail.name}}</text>
        <view class="info-price-row">
          <text class="info-price">Â¥{{detail.price}}</text>
          <text wx:if="{{detail.originalPrice}}" class="info-original-price">Â¥{{detail.originalPrice}}</text>
        </view>
      </view>

      <!-- è¯„åˆ†å’Œä½ç½® -->
      <view class="info-meta">
        <view wx:if="{{detail.rating}}" class="info-rating">
          <text class="info-rating-text">è¯„åˆ†ï¼š{{detail.rating}}</text>
          <text class="info-rating-star">â˜…</text>
        </view>
        <view wx:if="{{detail.location}}" class="info-location">
          <text class="info-location-icon">ğŸ“</text>
          <text class="info-location-text">{{detail.location}}</text>
        </view>
      </view>

      <!-- åº“å­˜ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ -->
      <view wx:if="{{detail.stock !== undefined}}" class="info-stock">
        <text class="info-stock-text">åº“å­˜ï¼š{{detail.stock}}ä»¶</text>
      </view>
    </view>

    <!-- ä¸» Tabï¼šé—¨ç¥¨é¢„è®¢ / æ™¯åŒºä»‹ç» -->
    <view class="booking-main-tabs">
      <view
        class="booking-main-tab {{bookingMainTab === 'booking' ? 'active' : ''}}"
        data-tab="booking"
        bindtap="onBookingMainTabChange"
      >
        <text class="booking-main-tab-text">é—¨ç¥¨é¢„è®¢</text>
      </view>
      <view
        class="booking-main-tab {{bookingMainTab === 'intro' ? 'active' : ''}}"
        data-tab="intro"
        bindtap="onBookingMainTabChange"
      >
        <text class="booking-main-tab-text">æ™¯åŒºä»‹ç»</text>
      </view>
    </view>

    <!-- é—¨ç¥¨é¢„è®¢åŒºåŸŸ -->
    <view wx:if="{{bookingMainTab === 'booking'}}" class="booking-section">
      <!-- å¯è®¢æ—¥æœŸ -->
      <view class="booking-date-section">
        <view class="booking-date-title">å¯è®¢æ—¥æœŸ</view>
        <view class="date-tabs">
          <view
            wx:for="{{dateOptions}}"
            wx:key="fullDate"
            class="date-tab-item {{selectedDateIndex === index ? 'active' : ''}}"
            data-index="{{index}}"
            bindtap="onSelectUseDateTab"
          >
            <text class="date-tab-label">{{item.label}}</text>
            <text class="date-tab-date">{{item.monthDay}}</text>
          </view>
          <!-- æ›´å¤šæ—¥æœŸ -->
          <picker mode="date" value="{{useDate}}" start="{{minDate}}" bindchange="onUseDateChange">
            <view class="date-tab-item more-date">
              <text class="date-tab-label">æ›´å¤š</text>
              <text class="date-tab-date">æ—¥æœŸ â€º</text>
            </view>
          </picker>
        </view>
      </view>

      <!-- ç¥¨ç§åˆ†ç±» + ç¥¨ç§åˆ—è¡¨ -->
      <view wx:if="{{detail.ticketCategories && detail.ticketCategories.length}}" class="ticket-categories-section">
        <view
          wx:for="{{detail.ticketCategories}}"
          wx:for-item="cat"
          wx:key="id"
          class="ticket-category"
        >
          <view class="ticket-category-header">
            <text class="ticket-category-name">{{cat.name}}</text>
            <text wx:if="{{cat.description}}" class="ticket-category-desc">{{cat.description}}</text>
          </view>
          <view wx:if="{{cat.tickets && cat.tickets.length}}" class="ticket-category-list">
            <view
              wx:for="{{cat.tickets}}"
              wx:for-item="ticket"
              wx:key="id"
              class="ticket-card"
            >
              <view class="ticket-card-info">
                <text class="ticket-card-name">{{ticket.name}}</text>
                <text wx:if="{{ticket.includedAttractions && ticket.includedAttractions.length}}" class="ticket-card-desc">
                  {{ticket.includedAttractions.join('ã€')}}
                </text>
              </view>
              <view class="ticket-card-right">
                <view class="ticket-card-price-row">
                  <text class="ticket-card-price">Â¥{{ticket.price || detail.price}}</text>
                </view>
                <!-- ç¥¨ç§æ•°é‡é€‰æ‹© -->
                <view class="ticket-quantity-row">
                  <text class="ticket-quantity-label">æ•°é‡ï¼š</text>
                  <view class="quantity-controls">
                    <view
                      class="quantity-btn minus"
                      data-ticket-id="{{ticket.id}}"
                      bindtap="onDecreaseTicketQuantity"
                    >-</view>
                    <text class="quantity-value">
                      {{ticketQuantities[ticket.id] || 1}}
                    </text>
                    <view
                      class="quantity-btn plus"
                      data-ticket-id="{{ticket.id}}"
                      bindtap="onIncreaseTicketQuantity"
                    >+</view>
                  </view>
                </view>
                <view
                  class="ticket-card-book-btn"
                  data-ticket="{{ticket}}"
                  bindtap="onTicketBookTap"
                >
                  <text class="ticket-card-book-text">é¢„è®¢</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- å…¨å±€æ•°é‡ï¼ˆå…œåº•ï¼‰ -->
      <view class="booking-quantity-row">
        <text class="quantity-label">æ•°é‡ï¼š</text>
        <view class="quantity-controls">
          <view class="quantity-btn minus" bindtap="onDecreaseQuantity">-</view>
          <text class="quantity-value">{{quantity}}</text>
          <view class="quantity-btn plus" bindtap="onIncreaseQuantity">+</view>
        </view>
      </view>
    </view>

    <!-- æ™¯åŒºä»‹ç»åŒºåŸŸ -->
    <view wx:if="{{bookingMainTab === 'intro'}}" class="detail-section">
      <view class="tabs-container">
        <view
          wx:for="{{tabs}}"
          wx:key="index"
          class="tab-item {{activeTab === index ? 'active' : ''}}"
          data-index="{{index}}"
          bindtap="onTabChange"
        >
          <text class="tab-text">{{item}}</text>
        </view>
      </view>

      <view class="detail-content">
        <!-- è¯¦æƒ… -->
        <view wx:if="{{activeTab === 0}}" class="detail-tab-content">
          <view wx:if="{{detail.description}}" class="detail-description">
            <rich-text nodes="{{detail.description}}"></rich-text>
          </view>
        </view>

        <!-- è¯„ä»· -->
        <view wx:if="{{activeTab === 1}}" class="detail-tab-content">
          <view class="empty-content">
            <text class="empty-text">æš‚æ— è¯„ä»·</text>
          </view>
        </view>

        <!-- é¡»çŸ¥ -->
        <view wx:if="{{activeTab === 2}}" class="detail-tab-content">
          <view wx:if="{{detail.notice}}" class="detail-notice">
            <rich-text nodes="{{detail.notice}}"></rich-text>
          </view>
          <view wx:else class="empty-content">
            <text class="empty-text">æš‚æ— é¡»çŸ¥</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{!loading && !detail}}" class="empty-container">
    <text class="empty-text">æš‚æ— æ™¯ç‚¹ä¿¡æ¯</text>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ ï¼šåªä¿ç•™å¯¼èˆª -->
  <view wx:if="{{detail}}" class="action-bar">
    <view class="action-nav-icons">
      <view class="nav-icon" bindtap="onGoHome">
        <text class="nav-icon-text">ğŸ </text>
        <text class="nav-icon-label">é¦–é¡µ</text>
      </view>
      <view class="nav-icon" bindtap="onGoCart">
        <text class="nav-icon-text">ğŸ›’</text>
        <text class="nav-icon-label">è´­ç‰©è½¦</text>
      </view>
    </view>
  </view>
</view>
