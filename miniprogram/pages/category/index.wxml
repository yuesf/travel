<!--åˆ†ç±»é¡µ-->
<view class="page-container">
  <!-- å·¦å³åˆ†æ å¸ƒå±€ -->
  <view class="category-layout">
    <!-- å·¦ä¾§åˆ†ç±»åˆ—è¡¨ -->
    <scroll-view class="category-sidebar" scroll-y="true">
      <view 
        wx:for="{{categories}}" 
        wx:key="id"
        class="category-item {{currentCategoryId === item.id ? 'active' : ''}}"
        data-categoryid="{{item.id}}"
        bindtap="onCategoryTap"
      >
        <text class="category-text">{{item.name}}</text>
      </view>
    </scroll-view>

    <!-- å³ä¾§å•†å“åˆ—è¡¨ -->
    <scroll-view 
      class="product-content"
      scroll-y="true"
      refresher-enabled="true"
      refresher-triggered="{{loading && page === 1}}"
      bindrefresherrefresh="onPullDownRefresh"
      bindscrolltolower="onReachBottom"
    >
      <!-- å•†å“åˆ—è¡¨ -->
      <view class="product-list">
        <view 
          wx:for="{{products}}"
          wx:key="id"
          class="product-item"
          bindtap="onProductTap"
          data-product="{{item}}"
        >
          <!-- å•†å“å›¾ç‰‡ -->
          <view class="product-image-wrapper">
            <image
              class="product-image"
              src="{{item.image || item.coverImage || '/static/images/default-product.png'}}"
              mode="aspectFill"
              lazy-load="{{true}}"
            />
          </view>
          
          <!-- å•†å“ä¿¡æ¯ -->
          <view class="product-info">
            <view class="product-title">{{item.name}}</view>
            <view class="product-sales">å·²å”®{{item.sales || 0}}ä»¶</view>
            <view class="product-price-wrapper">
              <view class="product-price">
                <text class="price-symbol">Â¥</text>
                <text class="price-value">{{item.price || item.minPrice || 0}}</text>
              </view>
              <text wx:if="{{item.originalPrice && item.originalPrice > (item.price || item.minPrice || 0)}}" class="price-original">
                Â¥{{item.originalPrice}}
              </text>
            </view>
          </view>
          
          <!-- è´­ç‰©è½¦å›¾æ ‡ -->
          <view class="product-cart-icon" catchtap="onAddToCart" data-product="{{item}}">
            <text class="cart-icon">ğŸ›’</text>
          </view>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤šæç¤º -->
      <view wx:if="{{loading && page > 1}}" class="loading-more">
        <text class="loading-more-text">åŠ è½½ä¸­...</text>
      </view>
      
      <!-- æ²¡æœ‰æ›´å¤šæç¤º -->
      <view wx:if="{{!hasMore && products.length > 0}}" class="no-more">
        <text class="no-more-text">äº²,å·²ç»åˆ°åº•å•¦!</text>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view wx:if="{{!loading && products.length === 0}}" class="empty-container">
        <text class="empty-text">æš‚æ— å•†å“</text>
      </view>
    </scroll-view>
  </view>

  <!-- è§„æ ¼é€‰æ‹©å¼¹çª—ï¼ˆå•†å“ï¼‰ -->
  <view wx:if="{{showSpecModal}}" class="spec-modal-mask" bindtap="onCloseSpecModal">
    <view class="spec-modal" catchtap="true">
      <view class="spec-modal-header">
        <text class="spec-modal-title">é€‰æ‹©è§„æ ¼</text>
        <text class="spec-modal-close" bindtap="onCloseSpecModal">âœ•</text>
      </view>
      
      <scroll-view class="spec-modal-content" scroll-y="true">
        <!-- å•†å“ä¿¡æ¯ -->
        <view class="spec-product-info">
          <image wx:if="{{currentProductDetail && currentProductDetail.images && currentProductDetail.images.length > 0}}" class="spec-product-image" src="{{currentProductDetail.images[0]}}" mode="aspectFill" />
          <image wx:elif="{{currentProductDetail && (currentProductDetail.image || currentProductDetail.coverImage)}}" class="spec-product-image" src="{{currentProductDetail.image || currentProductDetail.coverImage}}" mode="aspectFill" />
          <view class="spec-product-details">
            <text class="spec-product-name">{{currentProductDetail ? currentProductDetail.name : ''}}</text>
            <text class="spec-product-price">Â¥{{currentProductDetail ? (currentProductDetail.price || currentProductDetail.minPrice || 0) : 0}}</text>
          </view>
        </view>
        
        <!-- è§„æ ¼é€‰æ‹© -->
        <view wx:if="{{currentProductDetail && currentProductDetail.specList && currentProductDetail.specList.length > 0}}" class="spec-list">
          <view wx:for="{{currentProductDetail.specList}}" wx:for-item="specItem" wx:key="key" class="spec-group">
            <view class="spec-group-title">{{specItem.key}}</view>
            <view class="spec-options">
              <!-- éå†è§„æ ¼é€‰é¡¹ -->
              <view
                wx:for="{{specItem.value}}" wx:for-item="option"
                wx:key="*this"
                class="spec-option {{selectedSpec[specItem.key] === option ? 'active' : ''}}"
                data-spec-key="{{specItem.key}}"
                data-spec-value="{{option}}"
                bindtap="onSelectSpec"
              >
                <text class="spec-option-text">{{option}}</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>

      <!-- è§„æ ¼é€‰æ‹©æç¤ºä¿¡æ¯ -->
      <view wx:if="{{showSpecTip}}" class="spec-tip">
        <text class="spec-tip-text">{{specTipText}}</text>
      </view>

      <!-- æ•°é‡é€‰æ‹©å’Œæ“ä½œæŒ‰é’® -->
      <view class="spec-modal-footer">
        <view class="quantity-selector">
          <text class="quantity-label">æ•°é‡ï¼š</text>
          <view class="quantity-controls">
            <view class="quantity-btn minus" bindtap="onDecreaseQuantity">-</view>
            <text class="quantity-value">{{quantity}}</text>
            <view class="quantity-btn plus" bindtap="onIncreaseQuantity">+</view>
          </view>
        </view>
        <view class="spec-modal-actions">
          <view class="spec-modal-btn cancel" bindtap="onCloseSpecModal">å–æ¶ˆ</view>
          <view class="spec-modal-btn confirm" bindtap="onAddToCart">ç¡®å®š</view>
        </view>
      </view>
    </view>
  </view>
</view>
