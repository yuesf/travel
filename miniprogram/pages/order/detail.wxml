<!--订单详情页-->
<view class="page-container">
  <view wx:if="{{order}}" class="detail-content">
    <!-- 订单状态卡片 -->
    <view class="status-card">
      <view class="status-icon" style="color: {{order.statusColor}}">
        <text class="icon-text">{{order.statusText}}</text>
      </view>
      <view class="status-desc">{{order.statusDesc}}</view>
      <view wx:if="{{order.useDate || order.checkInDate}}" class="status-date">
        <text wx:if="{{order.useDate}}">预计使用时间：{{order.useDate}}</text>
        <text wx:if="{{order.checkInDate}}">入住时间：{{order.checkInDate}} 退房时间：{{order.checkOutDate}}</text>
      </view>
    </view>

    <!-- 商品信息卡片 -->
    <view class="info-card">
      <view class="card-title">商品信息</view>
      <view class="card-content">
        <view
          wx:for="{{order.items || []}}"
          wx:key="id"
          wx:for-item="item"
          class="product-item"
        >
          <image
            class="product-image"
            src="{{item.itemImage || item.image || '/assets/icons/default-product.png'}}"
            mode="aspectFill"
            binderror="onImageError"
            data-index="{{index}}"
          />
          <view class="product-info">
            <view class="product-name">{{item.itemName || '商品信息'}}</view>
            <view wx:if="{{item.itemCode}}" class="product-code">
              编码：{{item.itemCode}}
            </view>
            <view class="product-specs">
              <text wx:if="{{item.useDate}}">使用日期：{{item.useDate}}</text>
              <text wx:if="{{item.checkInDate}}">入住：{{item.checkInDate}} 退房：{{item.checkOutDate}}</text>
            </view>
            <view class="product-price">
              <text class="price-label">数量：{{item.quantity || 1}} × ¥{{item.price || '0.00'}} = ¥{{item.totalPrice || '0.00'}}</text>
            </view>
          </view>
        </view>
        
        <!-- 如果没有items，显示订单类型 -->
        <view wx:if="{{!order.items || order.items.length === 0}}" class="product-item">
          <view class="product-info">
            <view class="product-name">{{order.orderTypeText}}</view>
            <view class="product-price">
              <text class="price-value">¥{{order.payAmount || order.totalAmount || '0.00'}}</text>
            </view>
          </view>
        </view>
        
        <!-- 订单价格汇总 -->
        <view class="order-summary">
          <view class="summary-row">
            <text class="summary-label">订单总额：</text>
            <text class="summary-value">¥{{order.totalAmount || '0.00'}}</text>
          </view>
          <view wx:if="{{order.discountAmount > 0}}" class="summary-row discount-row">
            <text class="summary-label">优惠金额：</text>
            <text class="summary-value discount-value">-¥{{order.discountAmount}}</text>
          </view>
          <view class="summary-row total-row">
            <text class="summary-label">实付金额：</text>
            <text class="summary-value total-value">¥{{order.payAmount || order.totalAmount || '0.00'}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 订单信息卡片 -->
    <view class="info-card">
      <view class="card-title">订单信息</view>
      <view class="card-content">
        <view class="info-row">
          <text class="info-label">订单号</text>
          <text class="info-value">{{order.orderNo}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">下单时间</text>
          <text class="info-value">{{order.createTimeText}}</text>
        </view>
        <view wx:if="{{order.payTimeText}}" class="info-row">
          <text class="info-label">支付时间</text>
          <text class="info-value">{{order.payTimeText}}</text>
        </view>
        <view wx:if="{{order.contactName}}" class="info-row">
          <text class="info-label">联系人</text>
          <text class="info-value">{{order.contactName}}</text>
        </view>
        <view wx:if="{{order.contactPhone}}" class="info-row">
          <text class="info-label">联系电话</text>
          <text class="info-value">{{order.contactPhone}}</text>
        </view>
      </view>
    </view>


    <!-- 备注信息 -->
    <view wx:if="{{order.remark}}" class="info-card">
      <view class="card-title">备注</view>
      <view class="card-content">
        <text class="remark-text">{{order.remark}}</text>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading-container">
    <text>加载中...</text>
  </view>

  <!-- 底部操作栏（固定） -->
  <view wx:if="{{order}}" class="action-bar safe-area-bottom">
    <button
      wx:if="{{order.status === 'PENDING_PAY'}}"
      class="action-btn cancel-btn"
      bindtap="onCancelOrder"
    >
      取消订单
    </button>
    <button
      wx:if="{{order.status === 'PENDING_PAY'}}"
      class="action-btn pay-btn"
      bindtap="onPayOrder"
    >
      立即支付
    </button>
    <button
      wx:if="{{order.status === 'PAID' || order.status === 'USED'}}"
      class="action-btn refund-btn"
      bindtap="onApplyRefund"
    >
      申请退款
    </button>
  </view>
</view>
