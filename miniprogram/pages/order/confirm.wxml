<!--è®¢å•ç¡®è®¤é¡µ-->
<view class="page-container">
  <scroll-view class="confirm-scroll" scroll-y>
    <!-- æ”¶è´§åœ°å€åŒºåŸŸ -->
    <view class="address-section" bindtap="onSelectAddress">
      <view wx:if="{{selectedAddress}}" class="address-content">
        <view class="address-info">
          <text class="receiver-name">{{selectedAddress.receiverName}}</text>
          <text class="receiver-phone">{{selectedAddress.receiverPhone}}</text>
        </view>
        <view class="address-detail">
          {{selectedAddress.province}}{{selectedAddress.city}}{{selectedAddress.district}}{{selectedAddress.detailAddress}}
        </view>
      </view>
      <view wx:else class="address-empty">
        <text class="add-icon">+</text>
        <text class="add-text">è¯·æ·»åŠ æ”¶è´§åœ°å€</text>
      </view>
      <text class="address-arrow">></text>
    </view>

    <!-- å•†å®¶å’Œå•†å“ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="merchant-info">
        <text class="merchant-icon">ğŸª</text>
        <text class="merchant-name">å´æ¡¥æ™ºæ…§æ—…æ¸¸</text>
      </view>
      <view class="card-content">
        <view
          wx:for="{{cartItems}}"
          wx:key="id"
          class="product-item"
        >
          <image
            wx:if="{{item.itemImage || (item.productDetail && (item.productDetail.image || item.productDetail.coverImage))}}"
            class="product-image"
            src="{{item.itemImage || item.productDetail.image || item.productDetail.coverImage}}"
            mode="aspectFill"
          />
          <view class="product-info">
            <view class="product-name">
              {{item.itemName || (item.productDetail ? (item.productDetail.name || item.productDetail.title) : 'å•†å“ä¿¡æ¯')}}
            </view>
            <view class="product-specs">
              <text wx:if="{{item.useDate}}">ä½¿ç”¨æ—¥æœŸï¼š{{item.useDate}}</text>
              <text wx:if="{{item.checkInDate}}">å…¥ä½ï¼š{{item.checkInDate}} é€€æˆ¿ï¼š{{item.checkOutDate}}</text>
              <text wx:if="{{item.productDetail && item.productDetail.material}}">æè´¨ï¼š{{item.productDetail.material}}</text>
            </view>
            <view class="product-price">
              <text class="price-label">æ•°é‡ï¼šx{{item.quantity}}</text>
              <text class="price-value">
                Â¥{{item.itemPrice ? (item.itemPrice * item.quantity) : (item.productDetail ? ((item.productDetail.price || item.productDetail.minPrice || item.productDetail.ticketPrice || 0) * item.quantity) : 0)}}
              </text>
            </view>
          </view>
        </view>
        <view class="product-subtotal">
          <text>å…±{{cartItems.length}}ä»¶ å°è®¡:Â¥{{totalAmount}}</text>
        </view>
      </view>
    </view>

    <!-- é…é€æ–¹å¼ -->
    <view class="info-card">
      <view class="card-content">
        <view class="delivery-row">
          <text class="delivery-label">é…é€æ–¹å¼</text>
          <text class="delivery-value">å¿«é€’é…é€</text>
        </view>
      </view>
    </view>

    <!-- ä¼˜æƒ åˆ¸é€‰æ‹© -->
    <view class="info-card">
      <view class="card-content">
        <view class="coupon-select" bindtap="onSelectCoupon">
          <view class="coupon-label">
            <text class="coupon-icon">æƒ </text>
            <text class="coupon-text-label">ä¼˜æƒ åˆ¸</text>
          </view>
          <view class="coupon-value">
            <text wx:if="{{selectedCoupon}}" class="coupon-text">
              {{selectedCoupon.coupon.name}} (å‡Â¥{{selectedCoupon.coupon.amount}})
            </text>
            <text wx:else class="coupon-text placeholder">æš‚æ— ä¼˜æƒ åˆ¸å¯ç”¨</text>
            <text class="coupon-arrow">></text>
          </view>
        </view>
      </view>
    </view>

    <!-- è¿è´¹ -->
    <view class="info-card">
      <view class="card-content">
        <view class="delivery-row">
          <text class="delivery-label">è¿è´¹</text>
          <text class="delivery-value">Â¥{{shippingFee}}</text>
        </view>
      </view>
    </view>

    <!-- ä¹°å®¶ç•™è¨€ -->
    <view class="info-card">
      <view class="card-title">ä¹°å®¶ç•™è¨€</view>
      <view class="card-content">
        <textarea
          class="form-textarea"
          placeholder="é€‰å¡«ï¼Œå¦‚æœ‰ç‰¹æ®Šè¦æ±‚è¯·å¡«å†™"
          value="{{remark}}"
          bindinput="onRemarkInput"
          maxlength="200"
        />
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨æäº¤æ ï¼ˆå›ºå®šï¼‰ -->
  <view class="submit-bar safe-area-bottom">
    <view class="submit-info">
      <text class="submit-label">åˆè®¡:</text>
      <text class="submit-price">Â¥{{payAmount}}</text>
    </view>
    <button
      class="submit-btn {{loading ? 'loading' : ''}}"
      bindtap="onSubmitOrder"
      disabled="{{loading}}"
    >
      {{loading ? 'æäº¤ä¸­...' : 'æäº¤è®¢å•'}}
    </button>
  </view>
</view>
