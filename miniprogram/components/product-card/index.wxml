<!--å•†å“å¡ç‰‡ç»„ä»¶-->
<view class="product-card" bindtap="onCardTap">
  <!-- å•†å“å›¾ç‰‡ -->
  <view class="product-image-wrapper">
    <image
      class="product-image"
      src="{{product.image || product.coverImage || defaultProductImage}}"
      mode="aspectFill"
    />
    <!-- æ ‡ç­¾ -->
    <view wx:if="{{product.tag}}" class="product-tag">
      {{product.tag}}
    </view>
  </view>

  <!-- å•†å“ä¿¡æ¯ -->
  <view class="product-info">
    <!-- æ ‡é¢˜ -->
    <view class="product-title">{{product.name || product.title}}</view>

    <!-- æè¿°ï¼ˆå¯Œæ–‡æœ¬ï¼‰- ä»…å•†å“ç±»å‹æ˜¾ç¤º -->
    <view wx:if="{{productType === 'PRODUCT' && formattedDescription}}" class="product-desc">
      <rich-text nodes="{{formattedDescription}}"></rich-text>
    </view>

    <!-- é…’åº—è®¾æ–½ï¼ˆä»…é…’åº—ç±»å‹æ˜¾ç¤ºï¼‰ -->
    <view wx:if="{{productType === 'HOTEL' && product.facilities && product.facilities.length > 0}}" class="product-facilities">
      <text class="facilities-label">è®¾æ–½ï¼š</text>
      <text class="facilities-text">{{product.facilities.join('ã€')}}</text>
    </view>

    <!-- æ™¯ç‚¹è¯„çº§ï¼ˆä»…æ™¯ç‚¹ç±»å‹æ˜¾ç¤ºï¼‰ -->
    <view wx:if="{{productType === 'ATTRACTION' && product.rating}}" class="product-rating-info">
      <text class="rating-label">è¯„çº§ï¼š</text>
      <text class="rating-value-text">{{product.rating}}</text>
    </view>

    <!-- åœ°å€ä¿¡æ¯ï¼ˆæ™¯ç‚¹/é…’åº—ï¼‰ -->
    <view wx:if="{{(productType === 'ATTRACTION' || productType === 'HOTEL') && product.address}}" class="product-location">
      <text class="location-icon">ğŸ“</text>
      <text class="location-text">{{product.address}}</text>
    </view>

    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
    <view class="product-footer">
      <!-- ä»·æ ¼ -->
      <view wx:if="{{showPrice}}" class="product-price">
        <text class="price-symbol">Â¥</text>
        <text class="price-value">{{product.price || product.minPrice || 0}}</text>
        <text wx:if="{{product.originalPrice && product.originalPrice > (product.price || product.minPrice)}}" class="price-original">
          Â¥{{product.originalPrice}}
        </text>
      </view>

      <!-- è¯„åˆ†å’Œæ“ä½œæŒ‰é’® -->
      <view class="product-footer-right">
        <!-- è¯„åˆ† -->
        <view wx:if="{{showRating && product.rating}}" class="product-rating">
          <text class="rating-icon">â­</text>
          <text class="rating-value">{{product.rating}}</text>
          <text wx:if="{{product.reviewCount}}" class="rating-count">
            ({{product.reviewCount}})
          </text>
        </view>
        
        <!-- è´­ç‰©è½¦æŒ‰é’®ï¼ˆä»…å•†å“ç±»å‹æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{productType === 'PRODUCT'}}" class="product-cart-icon" catchtap="onAddToCart">
          <text class="cart-icon">ğŸ›’</text>
        </view>
        
        <!-- ç«‹å³é¢„è®¢æŒ‰é’®ï¼ˆæ™¯ç‚¹å’Œé…’åº—ç±»å‹æ˜¾ç¤ºï¼‰ -->
        <view wx:if="{{productType === 'ATTRACTION' || productType === 'HOTEL'}}" class="product-book-btn" catchtap="onBookNow">
          <text class="book-btn-text">ç«‹å³é¢„è®¢</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è§„æ ¼é€‰æ‹©å¼¹çª—ï¼ˆå•†å“ï¼‰ -->
  <view wx:if="{{showSpecModal && productType === 'PRODUCT'}}" class="spec-modal-mask" bindtap="onCloseSpecModal">
    <view class="spec-modal" catchtap="true">
      <view class="spec-modal-header">
        <text class="spec-modal-title">é€‰æ‹©è§„æ ¼</text>
        <text class="spec-modal-close" bindtap="onCloseSpecModal">âœ•</text>
      </view>
      
      <scroll-view class="spec-modal-content" scroll-y="true">
        <!-- å•†å“ä¿¡æ¯ -->
        <view class="spec-product-info">
          <image wx:if="{{productDetail && productDetail.images && productDetail.images.length > 0}}" class="spec-product-image" src="{{productDetail.images[0]}}" mode="aspectFill" />
          <image wx:elif="{{product.image || product.coverImage}}" class="spec-product-image" src="{{product.image || product.coverImage}}" mode="aspectFill" />
          <view class="spec-product-details">
            <text class="spec-product-name">{{productDetail ? productDetail.name : product.name}}</text>
            <text class="spec-product-price">Â¥{{productDetail ? productDetail.price : (product.price || product.minPrice || 0)}}</text>
          </view>
        </view>
        
        <!-- è§„æ ¼é€‰æ‹© -->
        <view wx:if="{{productDetail && productDetail.specList && productDetail.specList.length > 0}}" class="spec-list">
          <view wx:for="{{productDetail.specList}}" wx:for-item="specItem" wx:key="key" class="spec-group">
            <view class="spec-group-title">{{specItem.key}}</view>
            <view class="spec-options">
              <!-- éå†è§„æ ¼é€‰é¡¹ -->
              <view
                wx:for="{{specItem.value}}" wx:for-item="option"
                wx:key="*this"
                class="spec-option {{selectedSpec[specItem.key] === option ? 'active' : ''}}"
                data-spec-key="{{specItem.key}}"
                data-spec-value="{{option}}"
                bindtap="onSelectSpec"
              >
                <text class="spec-option-text">{{option}}</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>

      <!-- è§„æ ¼é€‰æ‹©æç¤ºä¿¡æ¯ -->
      <view wx:if="{{showSpecTip}}" class="spec-tip">
        <text class="spec-tip-text">{{specTipText}}</text>
      </view>

      <!-- æ•°é‡é€‰æ‹©å’Œæ“ä½œæŒ‰é’® -->
      <view class="spec-modal-footer">
        <view class="quantity-selector">
          <text class="quantity-label">æ•°é‡ï¼š</text>
          <view class="quantity-controls">
            <view class="quantity-btn minus" bindtap="onDecreaseQuantity">-</view>
            <text class="quantity-value">{{quantity}}</text>
            <view class="quantity-btn plus" bindtap="onIncreaseQuantity">+</view>
          </view>
        </view>
        <view class="spec-modal-actions">
          <view class="spec-modal-btn cancel" bindtap="onCloseSpecModal">å–æ¶ˆ</view>
          <view class="spec-modal-btn confirm" bindtap="onAddToCart">ç¡®å®š</view>
        </view>
      </view>
    </view>
  </view>
</view>
