<!--ÂïÜÂìÅÂç°ÁâáÁªÑ‰ª∂-->
<view class="product-card" bindtap="onCardTap">
  <!-- ÂïÜÂìÅÂõæÁâá -->
  <view class="product-image-wrapper">
    <image
      class="product-image"
      src="{{product.image || product.coverImage || defaultProductImage}}"
      mode="aspectFill"
    />
    <!-- Ê†áÁ≠æ -->
    <view wx:if="{{product.tag}}" class="product-tag">
      {{product.tag}}
    </view>
  </view>

  <!-- ÂïÜÂìÅ‰ø°ÊÅØ -->
  <view class="product-info">
    <!-- Ê†áÈ¢ò -->
    <view class="product-title">{{product.name || product.title}}</view>

    <!-- ÊèèËø∞ -->
    <view wx:if="{{product.description || product.summary}}" class="product-desc">
      {{product.description || product.summary}}
    </view>

    <!-- ‰ΩçÁΩÆ‰ø°ÊÅØÔºàÊôØÁÇπ/ÈÖíÂ∫óÔºâ -->
    <view wx:if="{{product.location || product.address}}" class="product-location">
      <text class="location-icon">üìç</text>
      <text class="location-text">{{product.location || product.address}}</text>
    </view>

    <!-- Â∫ïÈÉ®‰ø°ÊÅØÊ†è -->
    <view class="product-footer">
      <!-- ‰ª∑Ê†º -->
      <view wx:if="{{showPrice}}" class="product-price">
        <text class="price-symbol">¬•</text>
        <text class="price-value">{{product.price || product.minPrice || 0}}</text>
        <text wx:if="{{product.originalPrice && product.originalPrice > (product.price || product.minPrice)}}" class="price-original">
          ¬•{{product.originalPrice}}
        </text>
      </view>

      <!-- ËØÑÂàÜÂíåË¥≠Áâ©ËΩ¶ÊåâÈíÆ -->
      <view class="product-footer-right">
        <!-- ËØÑÂàÜ -->
        <view wx:if="{{showRating && product.rating}}" class="product-rating">
          <text class="rating-icon">‚≠ê</text>
          <text class="rating-value">{{product.rating}}</text>
          <text wx:if="{{product.reviewCount}}" class="rating-count">
            ({{product.reviewCount}})
          </text>
        </view>
        
        <!-- Ë¥≠Áâ©ËΩ¶ÊåâÈíÆÔºà‰ªÖÂïÜÂìÅÁ±ªÂûãÊòæÁ§∫Ôºâ -->
        <view wx:if="{{productType === 'PRODUCT'}}" class="product-cart-icon" catchtap="onAddToCart">
          <text class="cart-icon">üõí</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ËßÑÊ†ºÈÄâÊã©ÂºπÁ™óÔºàÂïÜÂìÅÔºâ -->
  <view wx:if="{{showSpecModal && productType === 'PRODUCT'}}" class="spec-modal-mask" bindtap="onCloseSpecModal">
    <view class="spec-modal" catchtap="true">
      <view class="spec-modal-header">
        <text class="spec-modal-title">ÈÄâÊã©ËßÑÊ†º</text>
        <text class="spec-modal-close" bindtap="onCloseSpecModal">‚úï</text>
      </view>
      
      <scroll-view class="spec-modal-content" scroll-y="true">
        <!-- ÂïÜÂìÅ‰ø°ÊÅØ -->
        <view class="spec-product-info">
          <image wx:if="{{productDetail && productDetail.images && productDetail.images.length > 0}}" class="spec-product-image" src="{{productDetail.images[0]}}" mode="aspectFill" />
          <image wx:elif="{{product.image || product.coverImage}}" class="spec-product-image" src="{{product.image || product.coverImage}}" mode="aspectFill" />
          <view class="spec-product-details">
            <text class="spec-product-name">{{productDetail ? productDetail.name : product.name}}</text>
            <text class="spec-product-price">¬•{{productDetail ? productDetail.price : (product.price || product.minPrice || 0)}}</text>
          </view>
        </view>
        
        <!-- ËßÑÊ†ºÈÄâÊã© -->
        <view wx:if="{{productDetail && productDetail.specList && productDetail.specList.length > 0}}" class="spec-list">
          <view wx:for="{{productDetail.specList}}" wx:for-item="specItem" wx:key="key" class="spec-group">
            <view class="spec-group-title">{{specItem.key}}</view>
            <view class="spec-options">
              <!-- ÈÅçÂéÜËßÑÊ†ºÈÄâÈ°π -->
              <view
                wx:for="{{specItem.value}}" wx:for-item="option"
                wx:key="*this"
                class="spec-option {{selectedSpec[specItem.key] === option ? 'active' : ''}}"
                data-spec-key="{{specItem.key}}"
                data-spec-value="{{option}}"
                bindtap="onSelectSpec"
              >
                <text class="spec-option-text">{{option}}</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>

      <!-- ËßÑÊ†ºÈÄâÊã©ÊèêÁ§∫‰ø°ÊÅØ -->
      <view wx:if="{{showSpecTip}}" class="spec-tip">
        <text class="spec-tip-text">{{specTipText}}</text>
      </view>

      <!-- Êï∞ÈáèÈÄâÊã©ÂíåÊìç‰ΩúÊåâÈíÆ -->
      <view class="spec-modal-footer">
        <view class="quantity-selector">
          <text class="quantity-label">Êï∞ÈáèÔºö</text>
          <view class="quantity-controls">
            <view class="quantity-btn minus" bindtap="onDecreaseQuantity">-</view>
            <text class="quantity-value">{{quantity}}</text>
            <view class="quantity-btn plus" bindtap="onIncreaseQuantity">+</view>
          </view>
        </view>
        <view class="spec-modal-actions">
          <view class="spec-modal-btn cancel" bindtap="onCloseSpecModal">ÂèñÊ∂à</view>
          <view class="spec-modal-btn confirm" bindtap="onAddToCart">Á°ÆÂÆö</view>
        </view>
      </view>
    </view>
  </view>
</view>
