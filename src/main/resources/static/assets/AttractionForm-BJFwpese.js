import{Z as G,_ as z,b as Z,E,c as J,$ as K,a0 as Q,K as W,L as Y,d as j,e as D,a1 as X,M as ee,a2 as ae,g as oe,o as te}from"./element-plus-BQiw23q9.js";import{r as U,v as F,x as L,A as x,o as A,B as o,c as N,aZ as le,a0 as ne,C as t,aY as de,D as v,Q as B,R as ie}from"./vue-vendor-Cs8obalv.js";import{I as re}from"./ImageUpload-v2Ox_fSm.js";import{V as se}from"./VideoUpload-DRpY8zM5.js";import{R as ce}from"./RichTextEditor-B6hxx3ZN.js";import{M as me}from"./MapPicker-GKwCqwxv.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as ue,u as pe,c as fe}from"./attractions-DXGY3QSt.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const ge={class:"region-picker-container"},ve={__name:"RegionPicker",props:{modelValue:{type:Array,default:()=>[]},placeholder:{type:String,default:"请选择省市区"},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},showAllLevels:{type:Boolean,default:!0}},emits:["update:modelValue","change"],setup(c,{emit:T}){const y=c,p=T,u=U([]),P={value:"code",label:"name",children:"children",emitPath:!0},V=U([{code:"110000",name:"北京市",children:[{code:"110100",name:"北京市",children:[{code:"110101",name:"东城区"},{code:"110102",name:"西城区"},{code:"110105",name:"朝阳区"},{code:"110106",name:"丰台区"},{code:"110107",name:"石景山区"},{code:"110108",name:"海淀区"},{code:"110109",name:"门头沟区"},{code:"110111",name:"房山区"},{code:"110112",name:"通州区"},{code:"110113",name:"顺义区"},{code:"110114",name:"昌平区"},{code:"110115",name:"大兴区"},{code:"110116",name:"怀柔区"},{code:"110117",name:"平谷区"},{code:"110118",name:"密云区"},{code:"110119",name:"延庆区"}]}]},{code:"120000",name:"天津市",children:[{code:"120100",name:"天津市",children:[{code:"120101",name:"和平区"},{code:"120102",name:"河东区"},{code:"120103",name:"河西区"},{code:"120104",name:"南开区"},{code:"120105",name:"河北区"},{code:"120106",name:"红桥区"},{code:"120110",name:"东丽区"},{code:"120111",name:"西青区"},{code:"120112",name:"津南区"},{code:"120113",name:"北辰区"},{code:"120114",name:"武清区"},{code:"120115",name:"宝坻区"},{code:"120116",name:"滨海新区"},{code:"120117",name:"宁河区"},{code:"120118",name:"静海区"},{code:"120119",name:"蓟州区"}]}]},{code:"310000",name:"上海市",children:[{code:"310100",name:"上海市",children:[{code:"310101",name:"黄浦区"},{code:"310104",name:"徐汇区"},{code:"310105",name:"长宁区"},{code:"310106",name:"静安区"},{code:"310107",name:"普陀区"},{code:"310109",name:"虹口区"},{code:"310110",name:"杨浦区"},{code:"310112",name:"闵行区"},{code:"310113",name:"宝山区"},{code:"310114",name:"嘉定区"},{code:"310115",name:"浦东新区"},{code:"310116",name:"金山区"},{code:"310117",name:"松江区"},{code:"310118",name:"青浦区"},{code:"310120",name:"奉贤区"},{code:"310151",name:"崇明区"}]}]},{code:"330000",name:"浙江省",children:[{code:"330100",name:"杭州市",children:[{code:"330102",name:"上城区"},{code:"330105",name:"拱墅区"},{code:"330106",name:"西湖区"},{code:"330108",name:"滨江区"},{code:"330109",name:"萧山区"},{code:"330110",name:"余杭区"},{code:"330111",name:"富阳区"},{code:"330112",name:"临安区"},{code:"330113",name:"临平区"},{code:"330114",name:"钱塘区"},{code:"330122",name:"桐庐县"},{code:"330127",name:"淳安县"},{code:"330182",name:"建德市"}]},{code:"330200",name:"宁波市",children:[{code:"330203",name:"海曙区"},{code:"330205",name:"江北区"},{code:"330206",name:"北仑区"},{code:"330211",name:"镇海区"},{code:"330212",name:"鄞州区"},{code:"330213",name:"奉化区"},{code:"330225",name:"象山县"},{code:"330226",name:"宁海县"},{code:"330281",name:"余姚市"},{code:"330282",name:"慈溪市"}]}]},{code:"440000",name:"广东省",children:[{code:"440100",name:"广州市",children:[{code:"440103",name:"荔湾区"},{code:"440104",name:"越秀区"},{code:"440105",name:"海珠区"},{code:"440106",name:"天河区"},{code:"440111",name:"白云区"},{code:"440112",name:"黄埔区"},{code:"440113",name:"番禺区"},{code:"440114",name:"花都区"},{code:"440115",name:"南沙区"},{code:"440117",name:"从化区"},{code:"440118",name:"增城区"}]},{code:"440300",name:"深圳市",children:[{code:"440303",name:"罗湖区"},{code:"440304",name:"福田区"},{code:"440305",name:"南山区"},{code:"440306",name:"宝安区"},{code:"440307",name:"龙岗区"},{code:"440308",name:"盐田区"},{code:"440309",name:"龙华区"},{code:"440310",name:"坪山区"},{code:"440311",name:"光明区"}]}]}]),a=(d,i)=>{for(const r of i){if(r.code===d)return r.name;if(r.children){const m=a(d,r.children);if(m)return m}}return null},f=(d,i)=>{for(const r of i){if(r.name===d)return r.code;if(r.children){const m=f(d,r.children);if(m)return m}}return null};F(()=>y.modelValue,d=>{if(Array.isArray(d))if(d.length===0)u.value=[];else if(typeof d[0]=="string"){const i=[];let r=V.value;for(const m of d){const k=f(m,r);if(k){i.push(k);const h=r.find(n=>n.code===k);r=(h==null?void 0:h.children)||[]}else break}u.value=i}else u.value=d;else u.value=[]},{immediate:!0});const g=d=>{if(!d||d.length===0){p("update:modelValue",[]),p("change",{province:"",city:"",district:"",codes:[]});return}const i=[];let r=V.value;for(const m of d){const k=a(m,r);if(k){i.push(k);const h=r.find(n=>n.code===m);r=(h==null?void 0:h.children)||[]}}p("update:modelValue",i),p("change",{province:i[0]||"",city:i[1]||"",district:i[2]||"",codes:d})};return L(()=>{}),(d,i)=>{const r=G;return A(),x("div",ge,[o(r,{modelValue:u.value,"onUpdate:modelValue":i[0]||(i[0]=m=>u.value=m),options:V.value,props:P,placeholder:c.placeholder,disabled:c.disabled,clearable:c.clearable,"show-all-levels":c.showAllLevels,style:{width:"100%"},onChange:g},null,8,["modelValue","options","placeholder","disabled","clearable","show-all-levels"])])}}},Ve=R(ve,[["__scopeId","data-v-324168dc"]]),he={class:"time-picker-container"},be={__name:"TimePicker",props:{modelValue:{type:[String,Array],default:null},placeholder:{type:String,default:"请选择时间"},disabled:{type:Boolean,default:!1},format:{type:String,default:"HH:mm"},valueFormat:{type:String,default:"HH:mm"},isRange:{type:Boolean,default:!1},rangeSeparator:{type:String,default:"至"},startPlaceholder:{type:String,default:"开始时间"},endPlaceholder:{type:String,default:"结束时间"},minuteStep:{type:Number,default:30}},emits:["update:modelValue","change"],setup(c,{emit:T}){const y=c,p=T,u=U(null),P=N(()=>{const a=y.minuteStep||30,f=[];for(let g=0;g<60;g+=a)f.push(g);return{disabledMinutes:g=>{const d=[];for(let i=0;i<60;i++)f.includes(i)||d.push(i);return d}}});F(()=>y.modelValue,a=>{u.value=a},{immediate:!0});const V=a=>{p("update:modelValue",a),p("change",a)};return(a,f)=>{const g=z;return A(),x("div",he,[o(g,{modelValue:u.value,"onUpdate:modelValue":f[0]||(f[0]=d=>u.value=d),placeholder:c.placeholder,disabled:c.disabled,format:c.format,"value-format":c.valueFormat,"is-range":c.isRange,"range-separator":c.rangeSeparator,"start-placeholder":c.startPlaceholder,"end-placeholder":c.endPlaceholder,"picker-options":P.value,style:{width:"100%"},onChange:V},null,8,["modelValue","placeholder","disabled","format","value-format","is-range","range-separator","start-placeholder","end-placeholder","picker-options"])])}}},ye=R(be,[["__scopeId","data-v-223e2199"]]),ke={class:"attraction-form-container"},_e={class:"card-header"},Pe={__name:"AttractionForm",setup(c){const T=de(),y=le(),p=U(null),u=U("basic"),P=U(!1),V=N(()=>!!y.params.id),a=ne({name:"",location:"",province:"",city:"",district:"",region:[],address:"",description:"",images:[],videoUrl:"",openTime:null,contactPhone:"",longitude:null,latitude:null,mapLocation:{longitude:null,latitude:null,address:""},ticketPrice:null,ticketStock:null,validPeriod:"",status:1}),f={name:[{required:!0,message:"请输入景点名称",trigger:"blur"}],ticketPrice:[{required:!0,message:"请输入门票价格",trigger:"blur"}],ticketStock:[{required:!0,message:"请输入门票库存",trigger:"blur"}]},g=async()=>{if(V.value)try{const n=await ue(y.params.id);if(n.data){const e=n.data;if(a.name=e.name||"",a.location=e.location||"",a.province=e.province||"",a.city=e.city||"",a.district=e.district||"",e.province||e.city||e.district?a.region=[e.province,e.city,e.district].filter(Boolean):a.region=[],a.address=e.address||"",a.description=e.description||"",a.images=e.images||[],a.videoUrl=e.videoUrl||"",e.openTime&&typeof e.openTime=="string"&&e.openTime.includes("-")){const[S,_]=e.openTime.split("-").map(s=>s.trim());a.openTime=[S,_]}else a.openTime=null;a.contactPhone=e.contactPhone||"",a.longitude=e.longitude?parseFloat(e.longitude):null,a.latitude=e.latitude?parseFloat(e.latitude):null,a.mapLocation={longitude:a.longitude,latitude:a.latitude,address:a.address||""},a.ticketPrice=e.ticketPrice?parseFloat(e.ticketPrice):null,a.ticketStock=e.ticketStock||null,a.validPeriod=e.validPeriod||"",a.status=e.status!==void 0?e.status:1}}catch(n){console.error("加载景点详情失败:",n),E.error("加载景点详情失败")}},d=n=>{a.images=n},i=n=>{a.province=n.province||"",a.city=n.city||"",a.district=n.district||""},r=n=>{a.longitude=n.longitude||null,a.latitude=n.latitude||null,n.address&&(a.address=n.address),a.mapLocation={longitude:a.longitude,latitude:a.latitude,address:n.address||a.address||""}},m=n=>{a.videoUrl=n||""},k=async()=>{p.value&&await p.value.validate(async n=>{if(n){P.value=!0;try{let e="";Array.isArray(a.openTime)&&a.openTime.length===2?e=`${a.openTime[0]}-${a.openTime[1]}`:a.openTime&&(e=String(a.openTime));const{region:S,mapLocation:_,...s}=a,b={...s,images:Array.isArray(a.images)?a.images:[],openTime:e};V.value?(await pe(y.params.id,b),E.success("更新成功")):(await fe(b),E.success("创建成功")),T.push("/attractions")}catch(e){console.error("保存失败:",e),E.error(e.message||"保存失败")}finally{P.value=!1}}})},h=()=>{te.confirm("确定要取消吗？未保存的数据将丢失。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{T.push("/attractions")}).catch(()=>{})};return L(()=>{g()}),(n,e)=>{const S=oe,_=D,s=j,b=Y,w=W,C=Q,M=X,I=ae,$=ee,H=K,O=J,q=Z;return A(),x("div",ke,[o(q,{shadow:"never"},{header:t(()=>[v("div",_e,[v("span",null,ie(V.value?"编辑景点":"创建景点"),1),v("div",null,[o(S,{onClick:h},{default:t(()=>[...e[15]||(e[15]=[B("取消",-1)])]),_:1}),o(S,{type:"primary",onClick:k,loading:P.value},{default:t(()=>[...e[16]||(e[16]=[B(" 保存 ",-1)])]),_:1},8,["loading"])])])]),default:t(()=>[o(O,{ref_key:"formRef",ref:p,model:a,rules:f,"label-width":"120px",class:"attraction-form"},{default:t(()=>[o(H,{modelValue:u.value,"onUpdate:modelValue":e[14]||(e[14]=l=>u.value=l),type:"border-card"},{default:t(()=>[o(C,{label:"基本信息",name:"basic"},{default:t(()=>[o(w,{gutter:20},{default:t(()=>[o(b,{span:12},{default:t(()=>[o(s,{label:"景点名称",prop:"name"},{default:t(()=>[o(_,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.name=l),placeholder:"请输入景点名称"},null,8,["modelValue"])]),_:1})]),_:1}),o(b,{span:12},{default:t(()=>[o(s,{label:"位置",prop:"location"},{default:t(()=>[o(_,{modelValue:a.location,"onUpdate:modelValue":e[1]||(e[1]=l=>a.location=l),placeholder:"请输入位置"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(s,{label:"省市区",prop:"region"},{default:t(()=>[o(Ve,{modelValue:a.region,"onUpdate:modelValue":e[2]||(e[2]=l=>a.region=l),placeholder:"请选择省市区",onChange:i},null,8,["modelValue"])]),_:1}),o(s,{label:"详细地址",prop:"address"},{default:t(()=>[o(_,{modelValue:a.address,"onUpdate:modelValue":e[3]||(e[3]=l=>a.address=l),type:"textarea",rows:2,placeholder:"请输入详细地址"},null,8,["modelValue"])]),_:1}),o(s,{label:"地图位置",prop:"location"},{default:t(()=>[o(me,{modelValue:a.mapLocation,"onUpdate:modelValue":e[4]||(e[4]=l=>a.mapLocation=l),height:"400px",onChange:r},null,8,["modelValue"]),e[17]||(e[17]=v("div",{class:"form-tip"},"点击地图选择位置，或手动输入经纬度",-1))]),_:1}),o(s,{label:"简介",prop:"description"},{default:t(()=>[o(ce,{modelValue:a.description,"onUpdate:modelValue":e[5]||(e[5]=l=>a.description=l),placeholder:"请输入景点简介"},null,8,["modelValue"])]),_:1}),o(w,{gutter:20},{default:t(()=>[o(b,{span:12},{default:t(()=>[o(s,{label:"开放时间",prop:"openTime"},{default:t(()=>[o(ye,{modelValue:a.openTime,"onUpdate:modelValue":e[6]||(e[6]=l=>a.openTime=l),"is-range":!0,placeholder:"请选择开放时间","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"]),e[18]||(e[18]=v("div",{class:"form-tip"},"例如：09:00-18:00",-1))]),_:1})]),_:1}),o(b,{span:12},{default:t(()=>[o(s,{label:"联系电话",prop:"contactPhone"},{default:t(()=>[o(_,{modelValue:a.contactPhone,"onUpdate:modelValue":e[7]||(e[7]=l=>a.contactPhone=l),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(C,{label:"媒体资源",name:"media"},{default:t(()=>[o(s,{label:"景点图片"},{default:t(()=>[o(re,{modelValue:a.images,"onUpdate:modelValue":e[8]||(e[8]=l=>a.images=l),limit:9,"max-size":5,onChange:d},null,8,["modelValue"]),e[19]||(e[19]=v("div",{class:"form-tip"},"最多上传9张图片，单张图片不超过5MB，支持JPG、PNG、WebP格式",-1))]),_:1}),o(s,{label:"景点视频",prop:"videoUrl"},{default:t(()=>[o(se,{modelValue:a.videoUrl,"onUpdate:modelValue":e[9]||(e[9]=l=>a.videoUrl=l),"max-size":50,onChange:m},null,8,["modelValue"]),e[20]||(e[20]=v("div",{class:"form-tip"},"支持MP4格式的视频，文件大小不超过50MB",-1))]),_:1})]),_:1}),o(C,{label:"门票信息",name:"ticket"},{default:t(()=>[o(w,{gutter:20},{default:t(()=>[o(b,{span:12},{default:t(()=>[o(s,{label:"门票价格",prop:"ticketPrice"},{default:t(()=>[o(M,{modelValue:a.ticketPrice,"onUpdate:modelValue":e[10]||(e[10]=l=>a.ticketPrice=l),precision:2,step:.01,min:0,placeholder:"请输入门票价格",style:{width:"100%"}},null,8,["modelValue"]),e[21]||(e[21]=v("span",{class:"form-unit"},"元",-1))]),_:1})]),_:1}),o(b,{span:12},{default:t(()=>[o(s,{label:"门票库存",prop:"ticketStock"},{default:t(()=>[o(M,{modelValue:a.ticketStock,"onUpdate:modelValue":e[11]||(e[11]=l=>a.ticketStock=l),min:0,placeholder:"请输入门票库存",style:{width:"100%"}},null,8,["modelValue"]),e[22]||(e[22]=v("span",{class:"form-unit"},"张",-1))]),_:1})]),_:1})]),_:1}),o(s,{label:"有效期",prop:"validPeriod"},{default:t(()=>[o(_,{modelValue:a.validPeriod,"onUpdate:modelValue":e[12]||(e[12]=l=>a.validPeriod=l),placeholder:"请输入有效期，如：7天"},null,8,["modelValue"]),e[23]||(e[23]=v("div",{class:"form-tip"},"例如：7天、30天、永久有效",-1))]),_:1})]),_:1}),o(C,{label:"状态设置",name:"status"},{default:t(()=>[o(s,{label:"状态",prop:"status"},{default:t(()=>[o($,{modelValue:a.status,"onUpdate:modelValue":e[13]||(e[13]=l=>a.status=l)},{default:t(()=>[o(I,{value:1},{default:t(()=>[...e[24]||(e[24]=[B("上架",-1)])]),_:1}),o(I,{value:0},{default:t(()=>[...e[25]||(e[25]=[B("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1})])}}},Me=R(Pe,[["__scopeId","data-v-87443ed0"]]);export{Me as default};
