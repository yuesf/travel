import{a as H,J,j as Y,b as W,K as se,L as le,M as re,N as ie,g as de,O as ce,P as ue,o as K,E as D}from"./element-plus-BQiw23q9.js";import{c as fe,m as _,o as d,C as a,D as s,A as v,O as $,R as g,B as o,P as N,F as me,Q as u,r as f,a0 as Q,x as ge,aY as pe,am as ye,K as L,ac as q,u as j}from"./vue-vendor-Cs8obalv.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as k}from"./index-DBeEaY1O.js";import"./vendor-x5eiJF7K.js";const ve={class:"card-content"},he={class:"card-left"},_e={class:"card-title"},Ce={class:"card-value"},ke={class:"value-number"},xe={key:0,class:"value-unit"},we={class:"card-right"},Se={key:0,class:"card-footer"},be={__name:"StatisticCard",props:{title:{type:String,required:!0},value:{type:[Number,String],required:!0},unit:{type:String,default:""},icon:{type:String,required:!0},iconColor:{type:String,default:"#409eff"},change:{type:Number,default:void 0}},setup(l){const T=l,i=fe(()=>H[T.icon]||J),C=m=>typeof m=="number"?m>=1e4?(m/1e4).toFixed(2)+"万":m.toLocaleString():m;return(m,p)=>{const h=Y,x=W;return d(),_(x,{class:"statistic-card",shadow:"hover"},{default:a(()=>[s("div",ve,[s("div",he,[s("div",_e,g(l.title),1),s("div",Ce,[s("span",ke,g(C(l.value)),1),l.unit?(d(),v("span",xe,g(l.unit),1)):$("",!0)])]),s("div",we,[o(h,{size:48,color:l.iconColor},{default:a(()=>[(d(),_(N(i.value)))]),_:1},8,["color"])])]),l.change!==void 0?(d(),v("div",Se,[s("span",{class:me(["change-text",l.change>=0?"positive":"negative"])},[o(h,{size:14},{default:a(()=>[(d(),_(N(l.change>=0?"ArrowUp":"ArrowDown")))]),_:1}),u(" "+g(Math.abs(l.change))+"% "+g(l.change>=0?"增长":"下降"),1)],2),p[0]||(p[0]=s("span",{class:"change-label"},"较昨日",-1))])):$("",!0)]),_:1})}}},Ae=X(be,[["__scopeId","data-v-ac00a392"]]);function De(){return k({url:"/admin/dashboard/stats",method:"get"})}function $e(l){return k({url:"/admin/dashboard/order-trend",method:"get",params:l})}function Te(l){return k({url:"/admin/dashboard/sales-stats",method:"get",params:l})}function Be(){return k({url:"/admin/dashboard/cache/clear-all",method:"post"})}function Ve(l){return k({url:"/admin/dashboard/cache/clear",method:"post",params:{cacheType:l}})}function Ee(){return k({url:"/admin/dashboard/cache/stats",method:"get"})}const ze={class:"dashboard-container"},Me={class:"card-header"},Oe={class:"card-header"},Le=["onClick"],qe={class:"action-title"},Ne={class:"card-header"},Re={class:"cache-item"},Ie={class:"cache-info"},Pe={class:"cache-name"},Ue={class:"cache-desc"},Fe={key:0,class:"cache-stats"},Ge={class:"cache-stat-item"},Ke={key:0,class:"cache-stat-item"},Qe={__name:"Dashboard",setup(l){const T=pe(),i=f([{key:"orders",title:"今日订单数",value:0,unit:"单",icon:"ShoppingCart",iconColor:"#409eff",change:0},{key:"sales",title:"今日销售额",value:0,unit:"元",icon:"Money",iconColor:"#67c23a",change:0},{key:"pending",title:"待处理订单",value:0,unit:"单",icon:"Clock",iconColor:"#e6a23c",change:0},{key:"users",title:"用户总数",value:0,unit:"人",icon:"User",iconColor:"#f56c6c",change:0}]),C=f("7"),m=f(!1),p=Q({tooltip:{trigger:"axis"},legend:{data:["订单数"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[{name:"订单数",type:"line",smooth:!0,data:[],itemStyle:{color:"#409eff"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}]}}}]}),h=f("7"),x=f(!1),w=Q({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["销售额"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{name:"销售额",type:"bar",data:[],itemStyle:{color:"#67c23a"}}]}),Z=f([{title:"创建景点",icon:"Plus",path:"/attractions/create",color:"#409eff"},{title:"创建酒店",icon:"OfficeBuilding",path:"/hotels/create",color:"#67c23a"},{title:"创建商品",icon:"Goods",path:"/products/create",color:"#e6a23c"},{title:"创建优惠券",icon:"Ticket",path:"/coupons/create",color:"#f56c6c"},{title:"查看订单",icon:"Document",path:"/orders",color:"#909399"}]),B=f(!1),V=f(""),E=f(!1),S=f({}),z=f([{type:"token",name:"Token黑名单",desc:"清除登录Token黑名单缓存",key:"tokenBlacklist"},{type:"sms",name:"短信验证码",desc:"清除短信验证码缓存",key:"smsCode"},{type:"miniprogram",name:"小程序配置",desc:"清除小程序配置缓存",key:"miniprogramConfig"},{type:"home",name:"首页数据",desc:"清除首页数据缓存",key:"home"},{type:"attraction",name:"景点详情",desc:"清除景点详情缓存",key:"attractionDetail"},{type:"product",name:"商品详情",desc:"清除商品详情缓存",key:"productDetail"},{type:"article",name:"文章详情",desc:"清除文章详情缓存",key:"articleDetail"},{type:"articleView",name:"文章阅读量",desc:"清除文章阅读量缓存",key:"articleView"}]),R=async()=>{try{const t=await De();if(t.data){const e=t.data;i.value[0].value=e.todayOrders||0,i.value[0].change=e.todayOrdersChange||0,i.value[1].value=e.todaySales||0,i.value[1].change=e.todaySalesChange||0,i.value[2].value=e.pendingOrders||0,i.value[3].value=e.totalUsers||0}}catch(t){console.error("加载统计数据失败:",t),i.value[0].value=128,i.value[0].change=12.5,i.value[1].value=56890,i.value[1].change=8.3,i.value[2].value=23,i.value[3].value=1234}},I=async()=>{m.value=!0;try{const t=await $e({days:C.value});t.data&&(p.xAxis.data=t.data.dates||[],p.series[0].data=t.data.values||[])}catch(t){console.error("加载订单趋势失败:",t);const e=parseInt(C.value);p.xAxis.data=Array.from({length:e},(c,y)=>{const r=new Date;return r.setDate(r.getDate()-(e-y-1)),`${r.getMonth()+1}/${r.getDate()}`}),p.series[0].data=Array.from({length:e},()=>Math.floor(Math.random()*100)+50)}finally{m.value=!1}},P=async()=>{x.value=!0;try{const t=await Te({days:h.value});t.data&&(w.xAxis.data=t.data.dates||[],w.series[0].data=t.data.values||[])}catch(t){console.error("加载销售统计失败:",t);const e=parseInt(h.value);w.xAxis.data=Array.from({length:e},(c,y)=>{const r=new Date;return r.setDate(r.getDate()-(e-y-1)),`${r.getMonth()+1}/${r.getDate()}`}),w.series[0].data=Array.from({length:e},()=>Math.floor(Math.random()*5e4)+2e4)}finally{x.value=!1}},ee=t=>H[t]||J,te=t=>{T.push(t)},ae=async()=>{try{await K.confirm("确定要清除所有缓存吗？此操作不可恢复。","确认清除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),B.value=!0,await Be(),D.success("所有缓存已清除"),await b()}catch(t){t!=="cancel"&&(console.error("清除缓存失败:",t),D.error("清除缓存失败"))}finally{B.value=!1}},oe=async t=>{try{const e=z.value.find(c=>c.type===t);await K.confirm(`确定要清除${e==null?void 0:e.name}缓存吗？`,"确认清除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),V.value=t,await Ve(t),D.success(`${e==null?void 0:e.name}缓存已清除`),await b()}catch(e){e!=="cancel"&&(console.error("清除缓存失败:",e),D.error("清除缓存失败"))}finally{V.value=""}},b=async()=>{E.value=!0;try{const t=await Ee();t.data&&(S.value={},z.value.forEach(e=>{t.data[e.key]&&(S.value[e.type]=t.data[e.key])}))}catch(t){console.error("加载缓存统计失败:",t)}finally{E.value=!1}},U=t=>{const e=S.value[t];if(!e||e.hitCount===void 0||e.missCount===void 0)return null;const c=e.hitCount+e.missCount;return c===0?null:(e.hitCount/c*100).toFixed(1)};return ge(()=>{R(),I(),P(),b(),setInterval(()=>{R()},300*1e3)}),(t,e)=>{const c=le,y=se,r=ie,F=re,G=ye("v-chart"),A=W,M=Y,O=de;return d(),v("div",ze,[o(y,{gutter:20,class:"stats-row"},{default:a(()=>[(d(!0),v(L,null,q(i.value,n=>(d(),_(c,{xs:24,sm:12,md:6,key:n.key},{default:a(()=>[o(Ae,{title:n.title,value:n.value,unit:n.unit,icon:n.icon,"icon-color":n.iconColor,change:n.change},null,8,["title","value","unit","icon","icon-color","change"])]),_:2},1024))),128))]),_:1}),o(y,{gutter:20,class:"charts-row"},{default:a(()=>[o(c,{xs:24,lg:12},{default:a(()=>[o(A,{class:"chart-card",shadow:"hover"},{header:a(()=>[s("div",Me,[e[5]||(e[5]=s("span",null,"订单趋势",-1)),o(F,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=n=>C.value=n),size:"small",onChange:I},{default:a(()=>[o(r,{value:"7"},{default:a(()=>[...e[2]||(e[2]=[u("近7天",-1)])]),_:1}),o(r,{value:"30"},{default:a(()=>[...e[3]||(e[3]=[u("近30天",-1)])]),_:1}),o(r,{value:"90"},{default:a(()=>[...e[4]||(e[4]=[u("近90天",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:a(()=>[o(G,{option:p,loading:m.value,style:{height:"300px"},autoresize:""},null,8,["option","loading"])]),_:1})]),_:1}),o(c,{xs:24,lg:12},{default:a(()=>[o(A,{class:"chart-card",shadow:"hover"},{header:a(()=>[s("div",Oe,[e[9]||(e[9]=s("span",null,"销售统计",-1)),o(F,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=n=>h.value=n),size:"small",onChange:P},{default:a(()=>[o(r,{value:"7"},{default:a(()=>[...e[6]||(e[6]=[u("近7天",-1)])]),_:1}),o(r,{value:"30"},{default:a(()=>[...e[7]||(e[7]=[u("近30天",-1)])]),_:1}),o(r,{value:"90"},{default:a(()=>[...e[8]||(e[8]=[u("近90天",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:a(()=>[o(G,{option:w,loading:x.value,style:{height:"300px"},autoresize:""},null,8,["option","loading"])]),_:1})]),_:1})]),_:1}),o(A,{class:"quick-actions-card",shadow:"hover"},{header:a(()=>[...e[10]||(e[10]=[s("span",null,"快捷操作",-1)])]),default:a(()=>[o(y,{gutter:20},{default:a(()=>[(d(!0),v(L,null,q(Z.value,n=>(d(),_(c,{xs:12,sm:6,md:4,key:n.path},{default:a(()=>[s("div",{class:"quick-action-item",onClick:ne=>te(n.path)},[o(M,{size:32,color:n.color},{default:a(()=>[(d(),_(N(ee(n.icon))))]),_:2},1032,["color"]),s("span",qe,g(n.title),1)],8,Le)]),_:2},1024))),128))]),_:1})]),_:1}),o(A,{class:"cache-card",shadow:"hover"},{header:a(()=>[s("div",Ne,[e[13]||(e[13]=s("span",null,"缓存管理",-1)),s("div",null,[o(O,{type:"info",size:"small",loading:E.value,onClick:b},{default:a(()=>[o(M,null,{default:a(()=>[o(j(ce))]),_:1}),e[11]||(e[11]=u(" 刷新统计 ",-1))]),_:1},8,["loading"]),o(O,{type:"danger",size:"small",loading:B.value,onClick:ae,style:{"margin-left":"8px"}},{default:a(()=>[o(M,null,{default:a(()=>[o(j(ue))]),_:1}),e[12]||(e[12]=u(" 清除所有缓存 ",-1))]),_:1},8,["loading"])])])]),default:a(()=>[o(y,{gutter:20},{default:a(()=>[(d(!0),v(L,null,q(z.value,n=>(d(),_(c,{xs:24,sm:12,md:8,lg:6,key:n.type},{default:a(()=>[s("div",Re,[s("div",Ie,[s("span",Pe,g(n.name),1),s("span",Ue,g(n.desc),1),S.value[n.type]?(d(),v("div",Fe,[s("span",Ge,[e[14]||(e[14]=u(" 条目: ",-1)),s("strong",null,g(S.value[n.type].estimatedSize||0),1)]),U(n.type)!==null?(d(),v("span",Ke,[e[15]||(e[15]=u(" 命中率: ",-1)),s("strong",null,g(U(n.type))+"%",1)])):$("",!0)])):$("",!0)]),o(O,{type:"warning",size:"small",loading:V.value===n.type,onClick:ne=>oe(n.type)},{default:a(()=>[...e[16]||(e[16]=[u(" 清除 ",-1)])]),_:1},8,["loading","onClick"])])]),_:2},1024))),128))]),_:1})]),_:1})])}}},Xe=X(Qe,[["__scopeId","data-v-f08c3f38"]]);export{Xe as default};
