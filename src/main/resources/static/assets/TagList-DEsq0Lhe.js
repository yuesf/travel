import{d as S,e as U,af as $,c as z,g as B,a4 as M,E as g,b as N,T as R,O,U as j,V as q,X as P,o as Q}from"./element-plus-BQiw23q9.js";import{l as X,f as G,c as H,m as J}from"./articles-JJVSk3Ev.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as p,c as K,a0 as W,v as Y,m as I,C as l,B as a,D as _,Q as v,o as E,x as Z,A as w,u as x,M as ee,E as ae,R as F}from"./vue-vendor-Cs8obalv.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const te={class:"dialog-footer"},oe={__name:"TagForm",props:{modelValue:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(h,{emit:b}){const r=h,d=b,i=p(null),m=p(!1),c=K({get:()=>r.modelValue,set:n=>d("update:modelValue",n)}),s=W({name:"",color:"#409EFF"}),V={name:[{required:!0,message:"请输入标签名称",trigger:"blur"}]};Y(()=>r.formData,n=>{n&&Object.keys(n).length>0?(s.name=n.name||"",s.color=n.color||"#409EFF"):(s.name="",s.color="#409EFF")},{immediate:!0,deep:!0});const D=async()=>{i.value&&await i.value.validate(async n=>{if(n){m.value=!0;try{const e={name:s.name,color:s.color};r.isEdit&&r.formData.id?(await X(r.formData.id,e),g.success("更新成功")):(await G(e),g.success("创建成功")),d("success"),y()}catch(e){console.error("保存失败:",e),g.error(e.message||"保存失败")}finally{m.value=!1}}})},y=()=>{c.value=!1,i.value&&i.value.resetFields()};return(n,e)=>{const t=U,f=S,k=$,u=z,C=B,T=M;return E(),I(T,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=o=>c.value=o),title:h.isEdit?"编辑标签":"创建标签",width:"600px",onClose:y},{footer:l(()=>[_("div",te,[a(C,{onClick:y},{default:l(()=>[...e[4]||(e[4]=[v("取消",-1)])]),_:1}),a(C,{type:"primary",onClick:D,loading:m.value},{default:l(()=>[...e[5]||(e[5]=[v(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[a(u,{ref_key:"formRef",ref:i,model:s,rules:V,"label-width":"100px"},{default:l(()=>[a(f,{label:"标签名称",prop:"name"},{default:l(()=>[a(t,{modelValue:s.name,"onUpdate:modelValue":e[0]||(e[0]=o=>s.name=o),placeholder:"请输入标签名称"},null,8,["modelValue"])]),_:1}),a(f,{label:"标签颜色",prop:"color"},{default:l(()=>[a(k,{modelValue:s.color,"onUpdate:modelValue":e[1]||(e[1]=o=>s.color=o)},null,8,["modelValue"]),e[3]||(e[3]=_("div",{class:"form-tip"},"选择标签显示颜色，用于区分不同标签",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},le=A(oe,[["__scopeId","data-v-d051c9e2"]]),se={class:"tag-list-container"},re={class:"toolbar"},ne={class:"toolbar-left"},ie={class:"toolbar-right"},de={key:0,class:"color-cell"},ce={key:1},ue={__name:"TagList",setup(h){const b=p([]),r=p(!1),d=p(!1),i=p({}),m=p(!1),c=async()=>{r.value=!0;try{const e=await H();e.data&&(b.value=e.data||[])}catch(e){console.error("加载标签列表失败:",e),g.error("加载标签列表失败"),b.value=[]}finally{r.value=!1}},s=()=>{i.value={},m.value=!1,d.value=!0},V=e=>{i.value={...e},m.value=!0,d.value=!0},D=async e=>{if(e.useCount>0){g.warning("该标签正在使用中，无法删除");return}try{await Q.confirm(`确定要删除标签"${e.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.value=!0;try{await J(e.id),g.success("删除成功"),c()}catch(t){console.error("删除标签失败:",t),g.error(t.message||"删除标签失败")}finally{r.value=!1}}catch{}},y=()=>{d.value=!1,c()},n=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return Z(()=>{c()}),(e,t)=>{const f=B,k=N,u=q,C=j,T=P;return E(),w("div",se,[a(k,{class:"toolbar-card",shadow:"never"},{default:l(()=>[_("div",re,[_("div",ne,[a(f,{type:"primary",onClick:s,icon:x(R)},{default:l(()=>[...t[1]||(t[1]=[v("添加标签",-1)])]),_:1},8,["icon"])]),_("div",ie,[a(f,{icon:x(O),onClick:c},{default:l(()=>[...t[2]||(t[2]=[v("刷新",-1)])]),_:1},8,["icon"])])])]),_:1}),a(k,{class:"table-card",shadow:"never"},{default:l(()=>[ee((E(),I(C,{data:b.value,stripe:"",border:"",style:{width:"100%"},"row-key":"id"},{default:l(()=>[a(u,{prop:"id",label:"ID",width:"80"}),a(u,{prop:"name",label:"标签名称","min-width":"150"}),a(u,{prop:"color",label:"颜色",width:"120"},{default:l(({row:o})=>[o.color?(E(),w("div",de,[_("span",{style:ae({color:o.color}),class:"color-dot"},"●",4),_("span",null,F(o.color),1)])):(E(),w("span",ce,"-"))]),_:1}),a(u,{prop:"useCount",label:"使用次数",width:"120",sortable:"custom"}),a(u,{prop:"createTime",label:"创建时间",width:"180"},{default:l(({row:o})=>[v(F(n(o.createTime)),1)]),_:1}),a(u,{label:"操作",width:"200",fixed:"right"},{default:l(({row:o})=>[a(f,{link:"",type:"primary",size:"small",onClick:L=>V(o)},{default:l(()=>[...t[3]||(t[3]=[v("编辑",-1)])]),_:1},8,["onClick"]),a(f,{link:"",type:"danger",size:"small",onClick:L=>D(o),disabled:o.useCount>0},{default:l(()=>[...t[4]||(t[4]=[v(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[T,r.value]])]),_:1}),a(le,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o),"form-data":i.value,"is-edit":m.value,onSuccess:y},null,8,["modelValue","form-data","is-edit"])])}}},be=A(ue,[["__scopeId","data-v-e4d708e9"]]);export{be as default};
