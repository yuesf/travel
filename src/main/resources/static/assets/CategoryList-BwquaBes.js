import{d as $,e as z,M,a2 as P,a1 as Y,c as G,g as R,a4 as j,E as g,b as q,T as Q,O as W,U as X,V as H,a3 as J,W as K,X as Z,o as ee}from"./element-plus-BQiw23q9.js";import{u as te,c as ae,g as le,d as oe}from"./categories-B-2g2K6-.js";import{I as ne}from"./ImageUpload-v2Ox_fSm.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _,c as se,a0 as re,v as T,m as B,C as l,B as a,O,D as C,Q as u,o as x,x as ue,A as N,u as S,M as ie,R as I}from"./vue-vendor-Cs8obalv.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const de={class:"icon-upload-wrapper"},me={__name:"CategoryForm",props:{modelValue:{type:Boolean,default:!1},formData:{type:Object,default:null},parentCategory:{type:Object,default:null}},emits:["update:modelValue","success"],setup(b,{emit:V}){const s=b,m=V,d=_(null),c=_(!1),f=se({get:()=>s.modelValue,set:y=>m("update:modelValue",y)}),t=re({name:"",icon:"",parentId:null,level:1,sort:0,status:1,type:"DISPLAY"}),U={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]},k=()=>{s.formData?(t.name=s.formData.name||"",t.icon=s.formData.icon||"",t.parentId=s.formData.parentId||null,t.level=s.formData.level||1,t.sort=s.formData.sort||0,t.status=s.formData.status!==void 0?s.formData.status:1,t.type=s.formData.type||"DISPLAY"):s.parentCategory?(t.name="",t.icon="",t.parentId=s.parentCategory.id,t.level=2,t.sort=0,t.status=1,t.type="DISPLAY"):(t.name="",t.icon="",t.parentId=0,t.level=1,t.sort=0,t.status=1,t.type="DISPLAY")};T(()=>s.modelValue,y=>{y&&k()},{immediate:!0}),T(()=>s.formData,()=>{s.modelValue&&k()});const F=async()=>{d.value&&await d.value.validate(async y=>{var e;if(y){c.value=!0;try{const o={name:t.name,icon:t.icon||null,parentId:t.parentId,level:t.level,sort:t.sort,status:t.status,type:t.type};(e=s.formData)!=null&&e.id?(await te(s.formData.id,o),g.success("更新成功")):(await ae(o),g.success("创建成功")),m("success")}catch(o){console.error("保存失败:",o),g.error(o.message||"保存失败")}finally{c.value=!1}}})},w=()=>{f.value=!1,d.value&&d.value.resetFields()};return(y,e)=>{var n;const o=z,i=$,v=P,E=M,p=Y,D=G,h=R,L=j;return x(),B(L,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=r=>f.value=r),title:(n=b.formData)!=null&&n.id?"编辑分类":b.parentCategory?"添加子分类":"添加分类",width:"600px",onClose:w},{footer:l(()=>[a(h,{onClick:w},{default:l(()=>[...e[13]||(e[13]=[u("取消",-1)])]),_:1}),a(h,{type:"primary",onClick:F,loading:c.value},{default:l(()=>[...e[14]||(e[14]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(D,{ref_key:"formRef",ref:d,model:t,rules:U,"label-width":"100px"},{default:l(()=>[b.parentCategory?(x(),B(i,{key:0,label:"父分类"},{default:l(()=>[a(o,{value:b.parentCategory.name,disabled:""},null,8,["value"])]),_:1})):O("",!0),a(i,{label:"分类名称",prop:"name"},{default:l(()=>[a(o,{modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=r=>t.name=r),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),a(i,{label:"分类图标"},{default:l(()=>[C("div",de,[a(o,{modelValue:t.icon,"onUpdate:modelValue":e[1]||(e[1]=r=>t.icon=r),placeholder:"请输入图标URL或上传图片",style:{flex:"1","margin-right":"8px"}},null,8,["modelValue"]),a(ne,{modelValue:t.icon,"onUpdate:modelValue":e[2]||(e[2]=r=>t.icon=r),limit:1,"max-size":2,style:{display:"inline-block"}},null,8,["modelValue"])]),e[7]||(e[7]=C("div",{class:"form-tip"},"支持图片URL或上传图片，建议尺寸：64x64px",-1))]),_:1}),a(i,{label:"分类类型",prop:"type"},{default:l(()=>[a(E,{modelValue:t.type,"onUpdate:modelValue":e[3]||(e[3]=r=>t.type=r)},{default:l(()=>[a(v,{value:"DISPLAY"},{default:l(()=>[...e[8]||(e[8]=[u("展示类型",-1)])]),_:1}),a(v,{value:"CONFIG"},{default:l(()=>[...e[9]||(e[9]=[u("配置类型（用于Icon配置）",-1)])]),_:1})]),_:1},8,["modelValue"]),e[10]||(e[10]=C("div",{class:"form-tip"},"展示类型：用于商品分类展示；配置类型：用于Icon配置选择",-1))]),_:1}),a(i,{label:"排序",prop:"sort"},{default:l(()=>[a(p,{modelValue:t.sort,"onUpdate:modelValue":e[4]||(e[4]=r=>t.sort=r),min:0,precision:0,placeholder:"数字越小越靠前",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(i,{label:"状态",prop:"status"},{default:l(()=>[a(E,{modelValue:t.status,"onUpdate:modelValue":e[5]||(e[5]=r=>t.status=r)},{default:l(()=>[a(v,{value:1},{default:l(()=>[...e[11]||(e[11]=[u("启用",-1)])]),_:1}),a(v,{value:0},{default:l(()=>[...e[12]||(e[12]=[u("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},pe=A(me,[["__scopeId","data-v-070a2f83"]]),ce={class:"category-list-container"},fe={class:"toolbar"},ye={class:"toolbar-left"},ve={class:"toolbar-right"},_e={key:0,class:"category-icon"},ge={__name:"CategoryList",setup(b){const V=_([]),s=_(!1),m=_(!1),d=_(null),c=_(null),f=async()=>{s.value=!0;try{const e=await le();e.data&&(V.value=e.data||[])}catch(e){console.error("加载分类列表失败:",e),g.error("加载分类列表失败"),V.value=[]}finally{s.value=!1}},t=()=>{d.value=null,c.value=null,m.value=!0},U=e=>{if(e.level>=2){g.warning("最多支持两级分类");return}d.value=null,c.value=e,m.value=!0},k=e=>{d.value={...e},c.value=null,m.value=!0},F=async e=>{try{await ee.confirm(`确定要删除分类"${e.name}"吗？删除前会检查是否有商品使用该分类。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.value=!0;try{await oe(e.id),g.success("删除成功"),f()}catch(o){console.error("删除分类失败:",o),g.error(o.message||"删除分类失败")}finally{s.value=!1}}catch{}},w=()=>{m.value=!1,f()},y=e=>e?new Date(e).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return ue(()=>{f()}),(e,o)=>{const i=R,v=q,E=J,p=H,D=K,h=X,L=Z;return x(),N("div",ce,[a(v,{class:"toolbar-card",shadow:"never"},{default:l(()=>[C("div",fe,[C("div",ye,[a(i,{type:"primary",onClick:t,icon:S(Q)},{default:l(()=>[...o[1]||(o[1]=[u("添加分类",-1)])]),_:1},8,["icon"])]),C("div",ve,[a(i,{icon:S(W),onClick:f},{default:l(()=>[...o[2]||(o[2]=[u("刷新",-1)])]),_:1},8,["icon"])])])]),_:1}),a(v,{class:"table-card",shadow:"never"},{default:l(()=>[ie((x(),B(h,{data:V.value,stripe:"",border:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":"",style:{width:"100%"}},{default:l(()=>[a(p,{prop:"name",label:"分类名称","min-width":"200"},{default:l(({row:n})=>[n.icon?(x(),N("span",_e,[a(E,{src:n.icon,fit:"cover",style:{width:"24px",height:"24px","margin-right":"8px","vertical-align":"middle"}},null,8,["src"])])):O("",!0),u(" "+I(n.name),1)]),_:1}),a(p,{prop:"level",label:"层级",width:"100"},{default:l(({row:n})=>[a(D,{type:n.level===1?"primary":"success"},{default:l(()=>[u(I(n.level===1?"一级分类":"二级分类"),1)]),_:2},1032,["type"])]),_:1}),a(p,{prop:"type",label:"类型",width:"120"},{default:l(({row:n})=>[a(D,{type:n.type==="CONFIG"?"warning":"info"},{default:l(()=>[u(I(n.type==="CONFIG"?"配置类型":"展示类型"),1)]),_:2},1032,["type"])]),_:1}),a(p,{prop:"sort",label:"排序",width:"100"}),a(p,{prop:"status",label:"状态",width:"100"},{default:l(({row:n})=>[a(D,{type:n.status===1?"success":"info"},{default:l(()=>[u(I(n.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(p,{prop:"createTime",label:"创建时间",width:"180"},{default:l(({row:n})=>[u(I(y(n.createTime)),1)]),_:1}),a(p,{label:"操作",width:"250",fixed:"right"},{default:l(({row:n})=>[a(i,{link:"",type:"primary",size:"small",onClick:r=>U(n)},{default:l(()=>[...o[3]||(o[3]=[u(" 添加子分类 ",-1)])]),_:1},8,["onClick"]),a(i,{link:"",type:"primary",size:"small",onClick:r=>k(n)},{default:l(()=>[...o[4]||(o[4]=[u("编辑",-1)])]),_:1},8,["onClick"]),a(i,{link:"",type:"danger",size:"small",onClick:r=>F(n),disabled:n.status===0},{default:l(()=>[...o[5]||(o[5]=[u(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[L,s.value]])]),_:1}),a(pe,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=n=>m.value=n),"form-data":d.value,"parent-category":c.value,onSuccess:w},null,8,["modelValue","form-data","parent-category"])])}}},we=A(ge,[["__scopeId","data-v-3c0b3014"]]);export{we as default};
