import{T as Ve,g as ie,X as we,V as de,aa as ue,k as ce,W as ke,a3 as pe,j as Ee,a7 as Ie,U as me,c as fe,d as ge,e as Ne,M as Oe,a2 as Me,a1 as Re,a4 as xe,E as v,o as Se,Q as Te,R as Ue,b as He,a5 as Qe}from"./element-plus-BQiw23q9.js";import{I as Be}from"./ImageUpload-v2Ox_fSm.js";import{V as Ye}from"./VideoUpload-DRpY8zM5.js";import{g as le,u as U,d as De,c as ye}from"./miniprogram-Bq4ZPLt3.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as C,a0 as _e,v as ze,x as be,A as F,o as I,D as E,M as $e,B as t,C as l,Q as _,u as D,m as L,R as P,O as oe,K as Ae,ac as Je,c as We}from"./vue-vendor-Cs8obalv.js";import{a as Le}from"./categories-B-2g2K6-.js";import{g as Xe,a as Ze}from"./articles-JJVSk3Ev.js";import{g as Pe}from"./attractions-DXGY3QSt.js";import{g as et}from"./products-7HgEtHJ3.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const tt={class:"banner-manager"},at={class:"banner-header"},lt={key:0,class:"video-preview-cell"},ot=["src"],nt={class:"image-slot"},st={__name:"BannerManager",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(he,{expose:q,emit:H}){const N=H,R=C(!1),w=C(!1),z=C("添加轮播图"),$=C(!1),g=C(null),c=C([]),x=C(-1),u=_e({title:"",type:"image",image:"",video:"",link:"",sort:0,status:1}),V={title:[{required:!0,message:"请输入轮播图标题",trigger:"blur"}],image:[{validator:(r,a,i)=>{u.type==="image"&&!a?i(new Error("请上传图片")):i()},trigger:"change"}],video:[{validator:(r,a,i)=>{u.type==="video"&&!a?i(new Error("请上传视频")):i()},trigger:"change"}]},s=r=>{try{const a=typeof r.configValue=="string"?JSON.parse(r.configValue):r.configValue;return(a==null?void 0:a.type)||"image"}catch{return"image"}},Q=r=>{try{const a=typeof r.configValue=="string"?JSON.parse(r.configValue):r.configValue;return(a==null?void 0:a.image)||""}catch{return""}},Y=r=>{try{const a=typeof r.configValue=="string"?JSON.parse(r.configValue):r.configValue;return(a==null?void 0:a.video)||""}catch{return""}},T=async()=>{R.value=!0;try{const r=await le("BANNER",{status:null});r.data&&(c.value=r.data.sort((a,i)=>(a.sort||0)-(i.sort||0)),N("update:modelValue",c.value),N("change",c.value))}catch(r){console.error("加载轮播图列表失败:",r),v.error("加载轮播图列表失败")}finally{R.value=!1}},W=async r=>{if(r===0)return;const a=c.value[r],i=c.value[r-1],k=a.sort;a.sort=i.sort,i.sort=k,c.value.splice(r-1,2,a,i);try{await Promise.all([U(a.id,{sort:a.sort}),U(i.id,{sort:i.sort})]),v.success("排序更新成功"),N("update:modelValue",c.value),N("change",c.value)}catch(b){console.error("更新排序失败:",b),v.error("更新排序失败"),await T()}},X=async r=>{if(r===c.value.length-1)return;const a=c.value[r],i=c.value[r+1],k=a.sort;a.sort=i.sort,i.sort=k,c.value.splice(r,2,i,a);try{await Promise.all([U(a.id,{sort:a.sort}),U(i.id,{sort:i.sort})]),v.success("排序更新成功"),N("update:modelValue",c.value),N("change",c.value)}catch(b){console.error("更新排序失败:",b),v.error("更新排序失败"),await T()}},p=()=>{x.value=-1,z.value="添加轮播图",O(),w.value=!0},d=(r,a)=>{x.value=a,z.value="编辑轮播图";try{const i=typeof r.configValue=="string"?JSON.parse(r.configValue):r.configValue;u.title=(i==null?void 0:i.title)||"",u.type=(i==null?void 0:i.type)||"image",u.image=(i==null?void 0:i.image)||"",u.video=(i==null?void 0:i.video)||"",u.link=(i==null?void 0:i.link)||"",u.sort=r.sort||0,u.status=r.status!==void 0?r.status:1}catch(i){console.error("解析配置值失败:",i)}w.value=!0},y=async(r,a)=>{try{await Se.confirm(`确定要删除轮播图"${S(r)}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),R.value=!0;try{await De(r.id),v.success("删除成功"),await T()}catch(i){console.error("删除轮播图失败:",i),v.error("删除轮播图失败")}finally{R.value=!1}}catch{}},S=r=>{try{const a=typeof r.configValue=="string"?JSON.parse(r.configValue):r.configValue;return(a==null?void 0:a.title)||"未命名"}catch{return"未命名"}},K=r=>{try{const a=typeof r.configValue=="string"?JSON.parse(r.configValue):r.configValue;return(a==null?void 0:a.link)||"-"}catch{return"-"}},G=async()=>{if(g.value)try{await g.value.validate(),$.value=!0;const r={title:u.title,type:u.type,image:u.type==="image"?u.image:"",video:u.type==="video"?u.video:"",link:u.link||""};if(x.value>=0){const a=c.value[x.value];await U(a.id,{configValue:JSON.stringify(r),sort:u.sort,status:u.status}),v.success("更新成功")}else{const a=c.value.length>0?Math.max(...c.value.map(i=>i.sort||0)):0;await ye({configKey:`BANNER_${Date.now()}`,configType:"BANNER",configValue:JSON.stringify(r),description:`轮播图：${u.title}`,sort:u.sort||a+1,status:u.status}),v.success("添加成功")}w.value=!1,await T()}catch(r){r!==!1&&(console.error("提交失败:",r),v.error("提交失败"))}finally{$.value=!1}},O=()=>{u.title="",u.type="image",u.image="",u.video="",u.link="",u.sort=c.value.length>0?Math.max(...c.value.map(r=>r.sort||0))+1:1,u.status=1,g.value&&g.value.clearValidate()};ze(()=>u.type,r=>{r==="image"?u.video="":u.image="",g.value&&g.value.clearValidate(["image","video"])});const Z=()=>{O(),x.value=-1};return be(()=>{T()}),q({loadBanners:T}),(r,a)=>{const i=ie,k=de,b=ke,A=Ee,ee=pe,n=me,e=Ne,o=ge,h=Me,B=Oe,ne=Re,ae=fe,se=xe,J=we;return I(),F("div",tt,[E("div",at,[t(i,{type:"primary",onClick:p,icon:D(Ve)},{default:l(()=>[...a[9]||(a[9]=[_("添加轮播图",-1)])]),_:1},8,["icon"])]),$e((I(),L(n,{data:c.value,stripe:"",border:"","row-key":"id",class:"banner-table"},{default:l(()=>[t(k,{type:"index",label:"序号",width:"60"}),t(k,{label:"排序",width:"120",align:"center"},{default:l(({row:m,$index:M})=>[t(i,{link:"",type:"primary",size:"small",icon:D(ue),disabled:M===0,onClick:te=>W(M),title:"上移"},null,8,["icon","disabled","onClick"]),t(i,{link:"",type:"primary",size:"small",icon:D(ce),disabled:M===c.value.length-1,onClick:te=>X(M),title:"下移"},null,8,["icon","disabled","onClick"])]),_:1}),t(k,{label:"类型",width:"100",align:"center"},{default:l(({row:m})=>[t(b,{type:s(m)==="video"?"warning":"success"},{default:l(()=>[_(P(s(m)==="video"?"视频":"图片"),1)]),_:2},1032,["type"])]),_:1}),t(k,{label:"预览",width:"150"},{default:l(({row:m})=>[s(m)==="video"?(I(),F("div",lt,[E("video",{src:Y(m),style:{width:"120px",height:"80px","border-radius":"4px","object-fit":"cover"},controls:""}," 您的浏览器不支持视频播放 ",8,ot)])):(I(),L(ee,{key:1,src:Q(m),fit:"cover",style:{width:"120px",height:"80px","border-radius":"4px"},"preview-src-list":[Q(m)],"preview-teleported":"",lazy:!1},{error:l(()=>[E("div",nt,[t(A,null,{default:l(()=>[t(D(Ie))]),_:1})])]),_:1},8,["src","preview-src-list"]))]),_:1}),t(k,{label:"标题","min-width":"150","show-overflow-tooltip":""},{default:l(({row:m})=>[_(P(S(m)),1)]),_:1}),t(k,{label:"跳转链接","min-width":"200","show-overflow-tooltip":""},{default:l(({row:m})=>[_(P(K(m)),1)]),_:1}),t(k,{prop:"sort",label:"排序",width:"80"}),t(k,{prop:"status",label:"状态",width:"100"},{default:l(({row:m})=>[t(b,{type:m.status===1?"success":"info"},{default:l(()=>[_(P(m.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(k,{label:"操作",width:"180",fixed:"right"},{default:l(({row:m,$index:M})=>[t(i,{link:"",type:"primary",size:"small",onClick:te=>d(m,M)},{default:l(()=>[...a[10]||(a[10]=[_(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(i,{link:"",type:"danger",size:"small",onClick:te=>y(m,M)},{default:l(()=>[...a[11]||(a[11]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,R.value]]),t(se,{modelValue:w.value,"onUpdate:modelValue":a[8]||(a[8]=m=>w.value=m),title:z.value,width:"600px",onClose:Z},{footer:l(()=>[t(i,{onClick:a[7]||(a[7]=m=>w.value=!1)},{default:l(()=>[...a[16]||(a[16]=[_("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:G,loading:$.value},{default:l(()=>[...a[17]||(a[17]=[_(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(ae,{ref_key:"formRef",ref:g,model:u,rules:V,"label-width":"100px"},{default:l(()=>[t(o,{label:"标题",prop:"title"},{default:l(()=>[t(e,{modelValue:u.title,"onUpdate:modelValue":a[0]||(a[0]=m=>u.title=m),placeholder:"请输入轮播图标题"},null,8,["modelValue"])]),_:1}),t(o,{label:"类型",prop:"type"},{default:l(()=>[t(B,{modelValue:u.type,"onUpdate:modelValue":a[1]||(a[1]=m=>u.type=m)},{default:l(()=>[t(h,{value:"image"},{default:l(()=>[...a[12]||(a[12]=[_("图片",-1)])]),_:1}),t(h,{value:"video"},{default:l(()=>[...a[13]||(a[13]=[_("视频",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),u.type==="image"?(I(),L(o,{key:0,label:"图片",prop:"image"},{default:l(()=>[t(Be,{modelValue:u.image,"onUpdate:modelValue":a[2]||(a[2]=m=>u.image=m),limit:1,"max-size":5},null,8,["modelValue"])]),_:1})):oe("",!0),u.type==="video"?(I(),L(o,{key:1,label:"视频",prop:"video"},{default:l(()=>[t(Ye,{modelValue:u.video,"onUpdate:modelValue":a[3]||(a[3]=m=>u.video=m),limit:1,"max-size":50},null,8,["modelValue"])]),_:1})):oe("",!0),t(o,{label:"跳转链接",prop:"link"},{default:l(()=>[t(e,{modelValue:u.link,"onUpdate:modelValue":a[4]||(a[4]=m=>u.link=m),placeholder:"请输入跳转链接（可选）"},null,8,["modelValue"])]),_:1}),t(o,{label:"排序",prop:"sort"},{default:l(()=>[t(ne,{modelValue:u.sort,"onUpdate:modelValue":a[5]||(a[5]=m=>u.sort=m),min:0,max:999},null,8,["modelValue"])]),_:1}),t(o,{label:"状态",prop:"status"},{default:l(()=>[t(B,{modelValue:u.status,"onUpdate:modelValue":a[6]||(a[6]=m=>u.status=m)},{default:l(()=>[t(h,{value:1},{default:l(()=>[...a[14]||(a[14]=[_("启用",-1)])]),_:1}),t(h,{value:0},{default:l(()=>[...a[15]||(a[15]=[_("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},rt=ve(st,[["__scopeId","data-v-a77a1b2b"]]),it={class:"icon-manager"},dt={class:"icon-header"},ut={class:"image-slot"},ct={__name:"IconManager",props:{modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue","change"],setup(he,{expose:q,emit:H}){const N=H,R=C(!1),w=C(!1),z=C("添加图标"),$=C(!1),g=C(null),c=C([]),x=C(-1),u=C(!1),V=C([]),s=_e({type:"",relatedId:null,name:"",icon:"",sort:0,status:1}),Q={type:[{required:!0,message:"请选择图标类型",trigger:"change"}],relatedId:[{validator:(n,e,o)=>{e?o():o(new Error("请选择关联对象"))},trigger:"change"}],name:[{required:!0,message:"请输入图标名称",trigger:"blur"}],icon:[{required:!0,message:"请上传图标图片",trigger:"change"}]},Y=n=>{try{const e=typeof n.configValue=="string"?JSON.parse(n.configValue):n.configValue;return(e==null?void 0:e.icon)||""}catch{return""}},T=n=>{try{const e=typeof n.configValue=="string"?JSON.parse(n.configValue):n.configValue;return(e==null?void 0:e.name)||"未命名"}catch{return"未命名"}},W=n=>{try{const e=typeof n.configValue=="string"?JSON.parse(n.configValue):n.configValue;return(e==null?void 0:e.type)||""}catch{return""}},X=n=>{const e=W(n);return{product_category:"商品分类",article_category:"文章分类",product:"商品",article:"文章",attraction:"景点",hotel:"酒店"}[e]||"未知"},p=n=>{const e=W(n);return{product_category:"success",article_category:"primary",product:"success",article:"info",attraction:"warning",hotel:"danger"}[e]||""},d=n=>{try{const e=typeof n.configValue=="string"?JSON.parse(n.configValue):n.configValue;return(e==null?void 0:e.relatedName)||"-"}catch{return"-"}},y=n=>({product_category:"商品分类",article_category:"文章分类",product:"商品",article:"文章",attraction:"景点",hotel:"酒店"})[n]||"",S=async n=>{u.value=!0,V.value=[];try{if(n==="product_category"){const e=await Le({status:1,type:"CONFIG"});e.data&&(V.value=e.data.map(o=>({id:o.id,name:o.name,icon:o.icon})))}else if(n==="article_category"){const e=await Xe(1);e.data&&(V.value=e.data.map(o=>({id:o.id,name:o.name})))}else if(n==="product"){const e=await et({page:1,pageSize:100,status:1});e.data&&e.data.list&&(V.value=e.data.list.map(o=>({id:o.id,name:o.name})))}else if(n==="article"){const e=await Ze({page:1,pageSize:100,status:1});e.data&&e.data.list&&(V.value=e.data.list.map(o=>({id:o.id,name:o.title})))}else if(n==="attraction"){const e=await Pe({page:1,pageSize:100,status:1});e.data&&e.data.list&&(V.value=e.data.list.map(o=>({id:o.id,name:o.name})))}else n==="hotel"&&(V.value=[],v.warning("酒店功能待实现"))}catch(e){console.error("加载选项失败:",e),v.error("加载选项失败")}finally{u.value=!1}},K=async n=>{s.relatedId=null,s.name="",n&&await S(n)},G=n=>{if(n&&V.value.length>0){const e=V.value.find(o=>o.id===n);e&&(s.name=e.name,s.type==="product_category"&&e.icon&&(s.icon=e.icon))}else s.name="",s.type==="product_category"&&(s.icon="")};ze(()=>s.relatedId,n=>{if(n&&V.value.length>0){const e=V.value.find(o=>o.id===n);e&&(s.name=e.name,s.type==="product_category"&&e.icon&&!s.icon&&(s.icon=e.icon))}});const O=async()=>{R.value=!0;try{const n=await le("ICON",{status:null});n.data&&(c.value=n.data.sort((e,o)=>(e.sort||0)-(o.sort||0)),N("update:modelValue",c.value),N("change",c.value))}catch(n){console.error("加载图标列表失败:",n),v.error("加载图标列表失败")}finally{R.value=!1}},Z=async n=>{if(n===0)return;const e=c.value[n],o=c.value[n-1],h=e.sort;e.sort=o.sort,o.sort=h,c.value.splice(n-1,2,e,o);try{await Promise.all([U(e.id,{sort:e.sort}),U(o.id,{sort:o.sort})]),v.success("排序更新成功"),N("update:modelValue",c.value),N("change",c.value)}catch(B){console.error("更新排序失败:",B),v.error("更新排序失败"),await O()}},r=async n=>{if(n===c.value.length-1)return;const e=c.value[n],o=c.value[n+1],h=e.sort;e.sort=o.sort,o.sort=h,c.value.splice(n,2,o,e);try{await Promise.all([U(e.id,{sort:e.sort}),U(o.id,{sort:o.sort})]),v.success("排序更新成功"),N("update:modelValue",c.value),N("change",c.value)}catch(B){console.error("更新排序失败:",B),v.error("更新排序失败"),await O()}},a=()=>{x.value=-1,z.value="添加图标",A(),w.value=!0},i=async(n,e)=>{x.value=e,z.value="编辑图标";try{const o=typeof n.configValue=="string"?JSON.parse(n.configValue):n.configValue;s.type=(o==null?void 0:o.type)||"",s.relatedId=(o==null?void 0:o.relatedId)||null,s.name=(o==null?void 0:o.name)||"",s.icon=(o==null?void 0:o.icon)||"",s.sort=n.sort||0,s.status=n.status!==void 0?n.status:1,s.type&&await S(s.type)}catch(o){console.error("解析配置值失败:",o)}w.value=!0},k=async(n,e)=>{try{await Se.confirm(`确定要删除图标"${T(n)}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),R.value=!0;try{await De(n.id),v.success("删除成功"),await O()}catch(o){console.error("删除图标失败:",o),v.error("删除图标失败")}finally{R.value=!1}}catch{}},b=async()=>{if(g.value)try{await g.value.validate(),$.value=!0;const n=V.value.find(h=>h.id===s.relatedId),e=n?n.name:"",o={type:s.type,relatedId:s.relatedId,relatedName:e,name:s.name,icon:s.icon};if(x.value>=0){const h=c.value[x.value];await U(h.id,{configValue:JSON.stringify(o),sort:s.sort,status:s.status}),v.success("更新成功")}else{const h=c.value.length>0?Math.max(...c.value.map(B=>B.sort||0)):0;await ye({configKey:`ICON_${s.type}_${Date.now()}`,configType:"ICON",configValue:JSON.stringify(o),description:`${y(s.type)}：${s.name}`,sort:s.sort||h+1,status:s.status}),v.success("添加成功")}w.value=!1,await O()}catch(n){n!==!1&&(console.error("提交失败:",n),v.error("提交失败"))}finally{$.value=!1}},A=()=>{s.type="",s.relatedId=null,s.name="",s.icon="",s.sort=c.value.length>0?Math.max(...c.value.map(n=>n.sort||0))+1:1,s.status=1,V.value=[],g.value&&g.value.clearValidate()},ee=()=>{A(),x.value=-1};return be(()=>{O()}),q({loadIcons:O}),(n,e)=>{const o=ie,h=de,B=Ee,ne=pe,ae=ke,se=me,J=Ue,m=Te,M=ge,te=Ne,Ke=Re,Ce=Me,Fe=Oe,qe=fe,Ge=xe,je=we;return I(),F("div",it,[E("div",dt,[t(o,{type:"primary",onClick:a,icon:D(Ve)},{default:l(()=>[...e[8]||(e[8]=[_("添加图标",-1)])]),_:1},8,["icon"])]),$e((I(),L(se,{data:c.value,stripe:"",border:"","row-key":"id",class:"icon-table"},{default:l(()=>[t(h,{type:"index",label:"序号",width:"60"}),t(h,{label:"排序",width:"120",align:"center"},{default:l(({row:f,$index:j})=>[t(o,{link:"",type:"primary",size:"small",icon:D(ue),disabled:j===0,onClick:re=>Z(j),title:"上移"},null,8,["icon","disabled","onClick"]),t(o,{link:"",type:"primary",size:"small",icon:D(ce),disabled:j===c.value.length-1,onClick:re=>r(j),title:"下移"},null,8,["icon","disabled","onClick"])]),_:1}),t(h,{label:"图标",width:"100",align:"center"},{default:l(({row:f})=>[t(ne,{src:Y(f),fit:"cover",style:{width:"60px",height:"60px","border-radius":"4px"},"preview-src-list":[Y(f)],"preview-teleported":"",lazy:!1},{error:l(()=>[E("div",ut,[t(B,null,{default:l(()=>[t(D(Ie))]),_:1})])]),_:1},8,["src","preview-src-list"])]),_:1}),t(h,{label:"名称","min-width":"150","show-overflow-tooltip":""},{default:l(({row:f})=>[_(P(T(f)),1)]),_:1}),t(h,{label:"类型",width:"120",align:"center"},{default:l(({row:f})=>[t(ae,{type:p(f)},{default:l(()=>[_(P(X(f)),1)]),_:2},1032,["type"])]),_:1}),t(h,{label:"关联对象","min-width":"150","show-overflow-tooltip":""},{default:l(({row:f})=>[_(P(d(f)),1)]),_:1}),t(h,{prop:"sort",label:"排序",width:"80"}),t(h,{prop:"status",label:"状态",width:"100"},{default:l(({row:f})=>[t(ae,{type:f.status===1?"success":"info"},{default:l(()=>[_(P(f.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(h,{label:"操作",width:"180",fixed:"right"},{default:l(({row:f,$index:j})=>[t(o,{link:"",type:"primary",size:"small",onClick:re=>i(f,j)},{default:l(()=>[...e[9]||(e[9]=[_(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(o,{link:"",type:"danger",size:"small",onClick:re=>k(f,j)},{default:l(()=>[...e[10]||(e[10]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[je,R.value]]),t(Ge,{modelValue:w.value,"onUpdate:modelValue":e[7]||(e[7]=f=>w.value=f),title:z.value,width:"600px",onClose:ee},{footer:l(()=>[t(o,{onClick:e[6]||(e[6]=f=>w.value=!1)},{default:l(()=>[...e[13]||(e[13]=[_("取消",-1)])]),_:1}),t(o,{type:"primary",onClick:b,loading:$.value},{default:l(()=>[...e[14]||(e[14]=[_(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(qe,{ref_key:"formRef",ref:g,model:s,rules:Q,"label-width":"100px"},{default:l(()=>[t(M,{label:"图标类型",prop:"type"},{default:l(()=>[t(m,{modelValue:s.type,"onUpdate:modelValue":e[0]||(e[0]=f=>s.type=f),placeholder:"请选择图标类型",style:{width:"100%"},onChange:K},{default:l(()=>[t(J,{label:"商品分类",value:"product_category"}),t(J,{label:"文章分类",value:"article_category"}),t(J,{label:"商品",value:"product"}),t(J,{label:"文章",value:"article"}),t(J,{label:"景点",value:"attraction"}),t(J,{label:"酒店",value:"hotel"})]),_:1},8,["modelValue"])]),_:1}),s.type?(I(),L(M,{key:0,label:y(s.type),prop:"relatedId"},{default:l(()=>[t(m,{modelValue:s.relatedId,"onUpdate:modelValue":e[1]||(e[1]=f=>s.relatedId=f),placeholder:`请选择${y(s.type)}`,filterable:"",style:{width:"100%"},loading:u.value,onChange:G},{default:l(()=>[(I(!0),F(Ae,null,Je(V.value,f=>(I(),L(J,{key:f.id,label:f.name,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"])):oe("",!0),t(M,{label:"图标名称",prop:"name"},{default:l(()=>[t(te,{modelValue:s.name,"onUpdate:modelValue":e[2]||(e[2]=f=>s.name=f),placeholder:s.relatedId?"将自动填充关联对象名称":"请输入图标名称",disabled:!!s.relatedId},null,8,["modelValue","placeholder","disabled"])]),_:1}),t(M,{label:"图标图片",prop:"icon"},{default:l(()=>[t(Be,{modelValue:s.icon,"onUpdate:modelValue":e[3]||(e[3]=f=>s.icon=f),limit:1,"max-size":2},null,8,["modelValue"])]),_:1}),t(M,{label:"排序",prop:"sort"},{default:l(()=>[t(Ke,{modelValue:s.sort,"onUpdate:modelValue":e[4]||(e[4]=f=>s.sort=f),min:0,max:999},null,8,["modelValue"])]),_:1}),t(M,{label:"状态",prop:"status"},{default:l(()=>[t(Fe,{modelValue:s.status,"onUpdate:modelValue":e[5]||(e[5]=f=>s.status=f)},{default:l(()=>[t(Ce,{value:1},{default:l(()=>[...e[11]||(e[11]=[_("启用",-1)])]),_:1}),t(Ce,{value:0},{default:l(()=>[...e[12]||(e[12]=[_("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pt=ve(ct,[["__scopeId","data-v-2f4c87b1"]]),mt={class:"home-config-container"},ft={class:"card-header"},gt={style:{width:"100%"}},yt={style:{"margin-top":"8px",color:"#909399","font-size":"12px"}},vt={key:0,style:{"margin-top":"16px"}},_t={key:1,style:{color:"#909399"}},bt={__name:"HomeConfig",setup(he){const q=C(!1),H=C([]),N=C([]),R=C([]),w=C([]),z=C(null),$=C(null),g=_e({productCategories:[],attractions:[],hotels:[]}),c=async()=>{try{const p=await Pe({page:1,pageSize:100,status:1});p.data&&p.data.list&&(R.value=p.data.list)}catch(p){console.error("加载景点选项失败:",p)}},x=async()=>{try{const p=await Le({status:1});p.data&&(w.value=p.data.filter(d=>d&&d.id!=null).map(d=>({id:d.id,name:d.name,icon:d.icon})))}catch(p){console.error("加载商品分类选项失败:",p)}},u=We(()=>g.productCategories.map(p=>w.value.find(d=>d.id===p)).filter(p=>p!==void 0)),V=p=>{p.length>4&&(v.warning("最多只能选择4个商品分类"),g.productCategories=p.slice(0,4))},s=p=>{if(p===0)return;const d=g.productCategories,y=d[p];d[p]=d[p-1],d[p-1]=y},Q=p=>{if(p===g.productCategories.length-1)return;const d=g.productCategories,y=d[p];d[p]=d[p+1],d[p+1]=y},Y=async()=>{try{const p=await le("RECOMMEND");p.data&&p.data.length>0&&p.data.forEach(d=>{try{const y=typeof d.configValue=="string"?JSON.parse(d.configValue):d.configValue;d.configKey==="RECOMMEND_PRODUCT_CATEGORY"?g.productCategories=(y==null?void 0:y.ids)||[]:d.configKey==="RECOMMEND_ATTRACTION"?g.attractions=(y==null?void 0:y.ids)||[]:d.configKey==="RECOMMEND_HOTEL"&&(g.hotels=(y==null?void 0:y.ids)||[])}catch(y){console.error("解析推荐配置失败:",y)}})}catch(p){console.error("加载推荐配置失败:",p)}},T=async()=>{var p;if(g.productCategories.length===0){v.warning("请至少选择一个商品分类");return}if(g.productCategories.length>4){v.warning("最多只能选择4个商品分类");return}q.value=!0;try{const d=[{configKey:"RECOMMEND_PRODUCT_CATEGORY",configType:"RECOMMEND",configValue:JSON.stringify({ids:g.productCategories}),description:"推荐商品分类"}];for(const y of d)try{const K=(p=(await le("RECOMMEND")).data)==null?void 0:p.find(G=>G.configKey===y.configKey);K?await U(K.id,{configValue:y.configValue}):await ye({...y,sort:0,status:1})}catch(S){console.error(`保存${y.description}失败:`,S)}v.success("保存成功")}catch(d){console.error("保存推荐配置失败:",d),v.error("保存失败")}finally{q.value=!1}},W=()=>{},X=()=>{};return be(()=>{c(),x(),Y()}),(p,d)=>{const y=He,S=Qe,K=Ue,G=Te,O=de,Z=pe,r=ie,a=me,i=ge,k=fe;return I(),F("div",mt,[t(y,{shadow:"never"},{default:l(()=>[t(y,{shadow:"never",class:"section-card"},{header:l(()=>[...d[3]||(d[3]=[E("div",{class:"card-header"},[E("span",null,"轮播图管理")],-1)])]),default:l(()=>[t(rt,{ref_key:"bannerManagerRef",ref:z,modelValue:H.value,"onUpdate:modelValue":d[0]||(d[0]=b=>H.value=b),onChange:W},null,8,["modelValue"])]),_:1}),t(y,{shadow:"never",class:"section-card"},{header:l(()=>[...d[4]||(d[4]=[E("div",{class:"card-header"},[E("span",null,"Icon图标配置")],-1)])]),default:l(()=>[t(pt,{ref_key:"iconManagerRef",ref:$,modelValue:N.value,"onUpdate:modelValue":d[1]||(d[1]=b=>N.value=b),onChange:X},null,8,["modelValue"])]),_:1}),t(y,{shadow:"never",class:"section-card"},{header:l(()=>[E("div",ft,[d[6]||(d[6]=E("span",null,"热门推荐",-1)),t(S,{type:"info",closable:!1,"show-icon":"",style:{"margin-left":"10px"}},{default:l(()=>[...d[5]||(d[5]=[E("span",{style:{"font-size":"12px"}},"可通过拖拽调整顺序",-1)])]),_:1})])]),default:l(()=>[t(k,{model:g,"label-width":"120px"},{default:l(()=>[t(i,{label:"推荐商品分类"},{default:l(()=>[E("div",gt,[t(G,{modelValue:g.productCategories,"onUpdate:modelValue":d[2]||(d[2]=b=>g.productCategories=b),multiple:"",filterable:"",placeholder:"请选择推荐商品分类（最多4个）",style:{width:"100%"},"max-collapse-tags":3,onChange:V},{default:l(()=>[(I(!0),F(Ae,null,Je(w.value,b=>(I(),L(K,{key:b.id,label:b.name,value:b.id,disabled:g.productCategories.length>=4&&!g.productCategories.includes(b.id)},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"]),E("div",yt," 已选择 "+P(g.productCategories.length)+"/4 个商品分类 ",1),g.productCategories.length>0?(I(),F("div",vt,[d[7]||(d[7]=E("div",{style:{"margin-bottom":"8px","font-weight":"500"}},"排序（拖拽调整顺序）：",-1)),t(a,{data:u.value,"row-key":"id",border:"",style:{width:"100%"}},{default:l(()=>[t(O,{type:"index",label:"序号",width:"60"}),t(O,{label:"分类名称",prop:"name"}),t(O,{label:"图标",width:"80",align:"center"},{default:l(({row:b})=>[b.icon?(I(),L(Z,{key:0,src:b.icon,fit:"cover",style:{width:"40px",height:"40px","border-radius":"4px"},"preview-src-list":[b.icon],"preview-teleported":""},null,8,["src","preview-src-list"])):(I(),F("span",_t,"无"))]),_:1}),t(O,{label:"操作",width:"120"},{default:l(({row:b,$index:A})=>[t(r,{link:"",type:"primary",size:"small",icon:D(ue),disabled:A===0,onClick:ee=>s(A),title:"上移"},null,8,["icon","disabled","onClick"]),t(r,{link:"",type:"primary",size:"small",icon:D(ce),disabled:A===u.value.length-1,onClick:ee=>Q(A),title:"下移"},null,8,["icon","disabled","onClick"])]),_:1})]),_:1},8,["data"])])):oe("",!0)])]),_:1}),t(i,{label:"推荐景点"},{default:l(()=>[t(S,{type:"warning",closable:!1,"show-icon":""},{default:l(()=>[...d[8]||(d[8]=[E("span",null,"功能后期待实现",-1)])]),_:1})]),_:1}),t(i,{label:"推荐酒店"},{default:l(()=>[t(S,{type:"warning",closable:!1,"show-icon":""},{default:l(()=>[...d[9]||(d[9]=[E("span",null,"功能后期待实现",-1)])]),_:1})]),_:1}),t(i,null,{default:l(()=>[t(r,{type:"primary",onClick:T,loading:q.value},{default:l(()=>[...d[10]||(d[10]=[_(" 保存推荐配置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})])}}},St=ve(bt,[["__scopeId","data-v-6fefd793"]]);export{St as default};
