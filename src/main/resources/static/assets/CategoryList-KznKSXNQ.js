import{d as N,e as S,a1 as R,M as z,a2 as j,c as O,g as $,a4 as q,E as f,b as G,T as Q,O as W,U as X,V as H,W as J,X as K,o as P}from"./element-plus-BQiw23q9.js";import{i as A,j as Y,g as Z,k as ee}from"./articles-JJVSk3Ev.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as v,c as te,a0 as ae,v as oe,m as M,C as a,B as e,D as h,Q as m,o as U,x as le,A as se,u as F,M as re,R as I}from"./vue-vendor-Cs8obalv.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const ne={class:"dialog-footer"},ie={__name:"CategoryForm",props:{modelValue:{type:Boolean,default:!1},formData:{type:Object,default:()=>({})},isEdit:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup(D,{emit:b}){const i=D,_=b,c=v(null),g=v(!1),p=te({get:()=>i.modelValue,set:r=>_("update:modelValue",r)}),o=ae({name:"",description:"",sort:0,status:1}),x={name:[{required:!0,message:"请输入分类名称",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]};oe(()=>i.formData,r=>{r&&Object.keys(r).length>0?(o.name=r.name||"",o.description=r.description||"",o.sort=r.sort!==void 0?r.sort:0,o.status=r.status!==void 0?r.status:1):(o.name="",o.description="",o.sort=0,o.status=1)},{immediate:!0,deep:!0});const w=async()=>{c.value&&await c.value.validate(async r=>{if(r){g.value=!0;try{const t={name:o.name,description:o.description,sort:o.sort,status:o.status};i.isEdit&&i.formData.id?(await A(i.formData.id,t),f.success("更新成功")):(await Y(t),f.success("创建成功")),_("success"),C()}catch(t){console.error("保存失败:",t),f.error(t.message||"保存失败")}finally{g.value=!1}}})},C=()=>{p.value=!1,c.value&&c.value.resetFields()};return(r,t)=>{const l=S,s=N,y=R,V=j,u=z,B=O,E=$,T=q;return U(),M(T,{modelValue:p.value,"onUpdate:modelValue":t[4]||(t[4]=d=>p.value=d),title:D.isEdit?"编辑分类":"创建分类",width:"600px",onClose:C},{footer:a(()=>[h("div",ne,[e(E,{onClick:C},{default:a(()=>[...t[8]||(t[8]=[m("取消",-1)])]),_:1}),e(E,{type:"primary",onClick:w,loading:g.value},{default:a(()=>[...t[9]||(t[9]=[m(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:a(()=>[e(B,{ref_key:"formRef",ref:c,model:o,rules:x,"label-width":"100px"},{default:a(()=>[e(s,{label:"分类名称",prop:"name"},{default:a(()=>[e(l,{modelValue:o.name,"onUpdate:modelValue":t[0]||(t[0]=d=>o.name=d),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"描述",prop:"description"},{default:a(()=>[e(l,{modelValue:o.description,"onUpdate:modelValue":t[1]||(t[1]=d=>o.description=d),type:"textarea",rows:3,placeholder:"请输入分类描述"},null,8,["modelValue"])]),_:1}),e(s,{label:"排序",prop:"sort"},{default:a(()=>[e(y,{modelValue:o.sort,"onUpdate:modelValue":t[2]||(t[2]=d=>o.sort=d),min:0,step:1,placeholder:"请输入排序值",style:{width:"100%"}},null,8,["modelValue"]),t[5]||(t[5]=h("div",{class:"form-tip"},"数字越小越靠前",-1))]),_:1}),e(s,{label:"状态",prop:"status"},{default:a(()=>[e(u,{modelValue:o.status,"onUpdate:modelValue":t[3]||(t[3]=d=>o.status=d)},{default:a(()=>[e(V,{value:1},{default:a(()=>[...t[6]||(t[6]=[m("启用",-1)])]),_:1}),e(V,{value:0},{default:a(()=>[...t[7]||(t[7]=[m("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},de=L(ie,[["__scopeId","data-v-0571d11b"]]),ue={class:"category-list-container"},me={class:"toolbar"},ce={class:"toolbar-left"},pe={class:"toolbar-right"},fe={__name:"CategoryList",setup(D){const b=v([]),i=v(!1),_=v(!1),c=v({}),g=v(!1),p=async()=>{i.value=!0;try{const l=await Z();l.data&&(b.value=l.data||[])}catch(l){console.error("加载分类列表失败:",l),f.error("加载分类列表失败"),b.value=[]}finally{i.value=!1}},o=()=>{c.value={},g.value=!1,_.value=!0},x=l=>{c.value={...l},g.value=!0,_.value=!0},w=async l=>{if(l.articleCount>0){f.warning("该分类下有文章，无法删除");return}try{await P.confirm(`确定要删除分类"${l.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),i.value=!0;try{await ee(l.id),f.success("删除成功"),p()}catch(s){console.error("删除分类失败:",s),f.error(s.message||"删除分类失败")}finally{i.value=!1}}catch{}},C=async l=>{try{await A(l.id,{name:l.name,description:l.description,sort:l.sort,status:l.status}),f.success("排序更新成功")}catch(s){console.error("更新排序失败:",s),f.error("更新排序失败"),p()}},r=()=>{_.value=!1,p()},t=l=>l?new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return le(()=>{p()}),(l,s)=>{const y=$,V=G,u=H,B=R,E=J,T=X,d=K;return U(),se("div",ue,[e(V,{class:"toolbar-card",shadow:"never"},{default:a(()=>[h("div",me,[h("div",ce,[e(y,{type:"primary",onClick:o,icon:F(Q)},{default:a(()=>[...s[1]||(s[1]=[m("添加分类",-1)])]),_:1},8,["icon"])]),h("div",pe,[e(y,{icon:F(W),onClick:p},{default:a(()=>[...s[2]||(s[2]=[m("刷新",-1)])]),_:1},8,["icon"])])])]),_:1}),e(V,{class:"table-card",shadow:"never"},{default:a(()=>[re((U(),M(T,{data:b.value,stripe:"",border:"",style:{width:"100%"},"row-key":"id"},{default:a(()=>[e(u,{prop:"id",label:"ID",width:"80"}),e(u,{prop:"name",label:"分类名称","min-width":"150"}),e(u,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),e(u,{prop:"sort",label:"排序",width:"100",sortable:"custom"},{default:a(({row:n})=>[e(B,{modelValue:n.sort,"onUpdate:modelValue":k=>n.sort=k,min:0,step:1,size:"small",style:{width:"100px"},onChange:k=>C(n)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(u,{prop:"status",label:"状态",width:"100"},{default:a(({row:n})=>[e(E,{type:n.status===1?"success":"info"},{default:a(()=>[m(I(n.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"articleCount",label:"文章数",width:"100"}),e(u,{prop:"createTime",label:"创建时间",width:"180"},{default:a(({row:n})=>[m(I(t(n.createTime)),1)]),_:1}),e(u,{label:"操作",width:"200",fixed:"right"},{default:a(({row:n})=>[e(y,{link:"",type:"primary",size:"small",onClick:k=>x(n)},{default:a(()=>[...s[3]||(s[3]=[m("编辑",-1)])]),_:1},8,["onClick"]),e(y,{link:"",type:"danger",size:"small",onClick:k=>w(n),disabled:n.articleCount>0},{default:a(()=>[...s[4]||(s[4]=[m(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[d,i.value]])]),_:1}),e(de,{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=n=>_.value=n),"form-data":c.value,"is-edit":g.value,onSuccess:r},null,8,["modelValue","form-data","is-edit"])])}}},Ve=L(fe,[["__scopeId","data-v-4d3a1603"]]);export{Ve as default};
