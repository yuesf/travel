import{L as B,c as Y,d as z,a1 as G,e as H,g as L,K as N,E as f}from"./element-plus-BQiw23q9.js";import{a_ as O,r as M,v as R,x as S,G as D,$ as j,A as Q,o as q,B as n,C as u,D as k,Q as K}from"./vue-vendor-Cs8obalv.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W="8d4c7df1f8193698d6732e1446a567ed",C=()=>W,X={class:"map-picker-container"},Z={class:"map-info"},ee={__name:"MapPicker",props:{modelValue:{type:Object,default:()=>({longitude:null,latitude:null,address:""})},apiKey:{type:String,default:()=>C()},height:{type:String,default:"400px"}},emits:["update:modelValue","change"],setup(h,{emit:F}){O(o=>({v16be962e:h.height}));const r=h,V=F,s=M(null),x=M(""),e=M({longitude:null,latitude:null,address:""});let d=null,c=null,g=null;const I=()=>new Promise((o,l)=>{if(window.AMap){o(window.AMap);return}const a=r.apiKey||C();if(a==="YOUR_API_KEY"){l(new Error("è¯·é…ç½®é«˜å¾·åœ°å›¾API Key"));return}const t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=`https://webapi.amap.com/maps?v=2.0&key=${a}&callback=initAMap`;const i=setTimeout(()=>{l(new Error("åŠ è½½é«˜å¾·åœ°å›¾è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"))},1e4);window.initAMap=()=>{clearTimeout(i),o(window.AMap),delete window.initAMap},t.onerror=()=>{clearTimeout(i),l(new Error("åŠ è½½é«˜å¾·åœ°å›¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–API Keyé…ç½®"))},document.head.appendChild(t)}),b=async()=>{var o,l;if(!s.value){setTimeout(()=>{b()},100);return}try{const a=r.apiKey||C();if(!a||a==="YOUR_API_KEY"){f.warning("è¯·é…ç½®é«˜å¾·åœ°å›¾API Keyï¼Œå¦åˆ™åœ°å›¾åŠŸèƒ½æ— æ³•ä½¿ç”¨"),s.value&&(s.value.innerHTML=`
          <div style="padding: 40px 20px; text-align: center; color: #909399; background: #f5f5f5; border-radius: 4px; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ—ºï¸</div>
            <div style="font-size: 16px; font-weight: 500; margin-bottom: 8px; color: #606266;">åœ°å›¾åŠŸèƒ½éœ€è¦é…ç½®API Key</div>
            <div style="font-size: 14px; color: #909399; margin-bottom: 16px;">è¯·åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½® VITE_AMAP_API_KEY</div>
            <div style="font-size: 12px; color: #C0C4CC;">æ‚¨ä»ç„¶å¯ä»¥é€šè¿‡æ‰‹åŠ¨è¾“å…¥ç»çº¬åº¦æ¥è®¾ç½®ä½ç½®</div>
          </div>
        `);return}const t=await I();s.value.offsetHeight===0&&(s.value.style.minHeight=r.height||"400px"),s.value.innerHTML="";const i=(o=r.modelValue)!=null&&o.longitude&&((l=r.modelValue)!=null&&l.latitude)?[r.modelValue.longitude,r.modelValue.latitude]:[116.397428,39.90923];d=new t.Map(s.value,{zoom:13,center:i,viewMode:"3D"}),d.on("complete",()=>{console.log("åœ°å›¾åŠ è½½å®Œæˆ"),t.plugin("AMap.Geocoder",()=>{var p,m;g=new t.Geocoder({city:"å…¨å›½"}),(p=r.modelValue)!=null&&p.longitude&&((m=r.modelValue)!=null&&m.latitude)&&_([r.modelValue.longitude,r.modelValue.latitude])})}),d.on("click",p=>{const{lng:m,lat:y}=p.lnglat;e.value.longitude=parseFloat(m.toFixed(7)),e.value.latitude=parseFloat(y.toFixed(7)),_([m,y]),setTimeout(()=>{A(m,y)},100)})}catch(a){console.error("åœ°å›¾åˆå§‹åŒ–å¤±è´¥:",a),f.error(a.message||"åœ°å›¾åˆå§‹åŒ–å¤±è´¥"),s.value&&(s.value.innerHTML=`<div style="padding: 20px; text-align: center; color: #F56C6C;">${a.message}</div>`)}},_=o=>{d&&(c&&d.remove(c),c=new window.AMap.Marker({position:o,draggable:!0}),d.add(c),d.setCenter(o),c.on("dragend",l=>{const{lng:a,lat:t}=l.lnglat;e.value.longitude=parseFloat(a.toFixed(7)),e.value.latitude=parseFloat(t.toFixed(7)),A(a,t)}))},A=(o,l)=>{if(!g||!window.AMap){console.warn("Geocoderæ’ä»¶æœªåŠ è½½ï¼Œæ— æ³•è·å–åœ°å€");return}g.getAddress([o,l],(a,t)=>{var i;if(a==="complete"&&t.info==="OK"){const p=t.regeocode.formattedAddress||(t.regeocode.addressComponent?`${t.regeocode.addressComponent.province||""}${t.regeocode.addressComponent.city||""}${t.regeocode.addressComponent.district||""}${t.regeocode.addressComponent.street||""}${t.regeocode.addressComponent.streetNumber||""}`:"")||((i=t.regeocode.addressComponent)==null?void 0:i.district)||"";e.value.address=p.trim(),w()}})},P=o=>{if(!g||!o||!window.AMap){g||f.warning("åœ°ç†ç¼–ç æ’ä»¶æœªåŠ è½½ï¼Œè¯·ç¨å€™å†è¯•");return}g.getLocation(o,(l,a)=>{if(l==="complete"&&a.geocodes.length>0){const t=a.geocodes[0].location;e.value.longitude=parseFloat(t.lng.toFixed(7)),e.value.latitude=parseFloat(t.lat.toFixed(7)),_([t.lng,t.lat]),e.value.address=a.geocodes[0].formattedAddress||o,w(),f.success("æœç´¢æˆåŠŸ")}else f.error("æœªæ‰¾åˆ°è¯¥åœ°å€ï¼Œè¯·å°è¯•æ›´è¯¦ç»†çš„åœ°å€ä¿¡æ¯")})},T=()=>{const o=x.value||e.value.address;if(!o){f.warning("è¯·è¾“å…¥åœ°å€");return}P(o)},E=()=>{e.value.longitude&&e.value.latitude&&(_([e.value.longitude,e.value.latitude]),A(e.value.longitude,e.value.latitude)),w()},$=()=>{x.value="",e.value={longitude:null,latitude:null,address:""},c&&(d==null||d.remove(c),c=null),w()},w=()=>{V("update:modelValue",{longitude:e.value.longitude,latitude:e.value.latitude,address:e.value.address}),V("change",{longitude:e.value.longitude,latitude:e.value.latitude,address:e.value.address})};return R(()=>r.modelValue,o=>{o&&(e.value={longitude:o.longitude||null,latitude:o.latitude||null,address:o.address||""},o.longitude&&o.latitude&&d&&_([o.longitude,o.latitude]))},{immediate:!0,deep:!0}),S(()=>{D(()=>{b()})}),j(()=>{d&&(d.destroy(),d=null),c=null,g=null}),(o,l)=>{const a=B,t=G,i=z,p=H,m=L,y=Y,U=N;return q(),Q("div",X,[n(U,{gutter:20},{default:u(()=>[n(a,{span:16},{default:u(()=>[k("div",{ref_key:"mapContainer",ref:s,class:"map-container"},null,512)]),_:1}),n(a,{span:8},{default:u(()=>[k("div",Z,[n(y,{model:e.value,"label-width":"80px"},{default:u(()=>[n(i,{label:"ç»åº¦"},{default:u(()=>[n(t,{modelValue:e.value.longitude,"onUpdate:modelValue":l[0]||(l[0]=v=>e.value.longitude=v),precision:7,step:1e-7,min:-180,max:180,placeholder:"ç»åº¦",style:{width:"100%"},onChange:E},null,8,["modelValue"])]),_:1}),n(i,{label:"çº¬åº¦"},{default:u(()=>[n(t,{modelValue:e.value.latitude,"onUpdate:modelValue":l[1]||(l[1]=v=>e.value.latitude=v),precision:7,step:1e-7,min:-90,max:90,placeholder:"çº¬åº¦",style:{width:"100%"},onChange:E},null,8,["modelValue"])]),_:1}),n(i,{label:"æœç´¢åœ°å€"},{default:u(()=>[n(p,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=v=>x.value=v),placeholder:"è¯·è¾“å…¥åœ°å€è¿›è¡Œæœç´¢",clearable:""},null,8,["modelValue"])]),_:1}),n(i,{label:"è¯¦ç»†åœ°å€"},{default:u(()=>[n(p,{modelValue:e.value.address,"onUpdate:modelValue":l[3]||(l[3]=v=>e.value.address=v),type:"textarea",rows:3,placeholder:"è¯¦ç»†åœ°å€",readonly:""},null,8,["modelValue"])]),_:1}),n(i,null,{default:u(()=>[n(m,{type:"primary",onClick:T},{default:u(()=>[...l[4]||(l[4]=[K("æœç´¢åœ°å€",-1)])]),_:1}),n(m,{onClick:$},{default:u(()=>[...l[5]||(l[5]=[K("é‡ç½®",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1})])}}},ae=J(ee,[["__scopeId","data-v-a3b70544"]]);export{ae as M};
