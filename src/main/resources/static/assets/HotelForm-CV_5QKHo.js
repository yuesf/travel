import{K as D,L as ee,d as le,e as ae,a1 as Te,M as te,a2 as oe,c as se,g as ne,a4 as ke,E as y,b as xe,$ as Ee,a0 as Re,Q as Ue,R as Ce,T as we,O as Ae,U as Be,V as Fe,W as Le,X as he,a5 as Ie,o as X}from"./element-plus-BQiw23q9.js";import{r as f,c as O,a0 as ie,v as Y,m as ue,C as a,B as e,D as c,Q as p,o as R,aZ as Pe,x as Se,A as F,aY as Me,M as He,O as Ne,u as Z,R as z}from"./vue-vendor-Cs8obalv.js";import{I as de}from"./ImageUpload-v2Ox_fSm.js";import{R as qe}from"./RichTextEditor-B6hxx3ZN.js";import{M as $e}from"./MapPicker-GKwCqwxv.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as ze,b as Oe,c as We,u as je,e as Ge,f as Qe,h as Je}from"./hotels-B-PzGg76.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const Ke={__name:"RoomForm",props:{modelValue:{type:Boolean,default:!1},roomData:{type:Object,default:null},hotelId:{type:Number,required:!0}},emits:["update:modelValue","submit"],setup(J,{emit:L}){const b=J,B=L,T=f(null),U=f(!1),r=O({get:()=>b.modelValue,set:i=>B("update:modelValue",i)}),h=O(()=>{var i;return!!((i=b.roomData)!=null&&i.id)}),o=ie({roomType:"",price:null,stock:null,bedType:"",area:null,facilities:[],images:[],status:1}),v=f(""),I={roomType:[{required:!0,message:"请输入房型名称",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],stock:[{required:!0,message:"请输入库存",trigger:"blur"}]};Y(()=>b.roomData,i=>{i?(o.roomType=i.roomType||"",o.price=i.price?parseFloat(i.price):null,o.stock=i.stock||null,o.bedType=i.bedType||"",o.area=i.area?parseFloat(i.area):null,o.facilities=Array.isArray(i.facilities)?i.facilities:[],o.images=Array.isArray(i.images)?i.images:[],o.status=i.status!==void 0?i.status:1,v.value=Array.isArray(o.facilities)?o.facilities.join(","):""):k()},{immediate:!0}),Y(r,i=>{i||k()});const k=()=>{o.roomType="",o.price=null,o.stock=null,o.bedType="",o.area=null,o.facilities=[],o.images=[],o.status=1,v.value="",T.value&&T.value.clearValidate()},C=()=>{v.value.trim()?o.facilities=v.value.split(",").map(i=>i.trim()).filter(i=>i):o.facilities=[]},P=async()=>{T.value&&await T.value.validate(async i=>{if(i){C(),U.value=!0;try{const s={hotelId:b.hotelId,roomType:o.roomType,price:o.price,stock:o.stock,bedType:o.bedType||void 0,area:o.area||void 0,facilities:o.facilities.length>0?o.facilities:void 0,images:Array.isArray(o.images)?o.images:[],status:o.status};B("submit",{...s,id:h.value?b.roomData.id:void 0}),r.value=!1}catch(s){console.error("提交失败:",s),y.error(s.message||"提交失败")}finally{U.value=!1}}})},t=()=>{r.value=!1};return(i,s)=>{const S=ae,_=le,x=ee,M=Te,E=D,N=oe,W=te,j=se,q=ne,G=ke;return R(),ue(G,{modelValue:r.value,"onUpdate:modelValue":s[8]||(s[8]=d=>r.value=d),title:h.value?"编辑房型":"添加房型",width:"800px",onClose:t},{footer:a(()=>[e(q,{onClick:t},{default:a(()=>[...s[16]||(s[16]=[p("取消",-1)])]),_:1}),e(q,{type:"primary",onClick:P,loading:U.value},{default:a(()=>[...s[17]||(s[17]=[p(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(j,{ref_key:"formRef",ref:T,model:o,rules:I,"label-width":"100px"},{default:a(()=>[e(E,{gutter:20},{default:a(()=>[e(x,{span:12},{default:a(()=>[e(_,{label:"房型名称",prop:"roomType"},{default:a(()=>[e(S,{modelValue:o.roomType,"onUpdate:modelValue":s[0]||(s[0]=d=>o.roomType=d),placeholder:"请输入房型名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(x,{span:12},{default:a(()=>[e(_,{label:"价格",prop:"price"},{default:a(()=>[e(M,{modelValue:o.price,"onUpdate:modelValue":s[1]||(s[1]=d=>o.price=d),precision:2,step:.01,min:0,placeholder:"请输入价格",style:{width:"100%"}},null,8,["modelValue"]),s[9]||(s[9]=c("span",{class:"form-unit"},"元/晚",-1))]),_:1})]),_:1})]),_:1}),e(E,{gutter:20},{default:a(()=>[e(x,{span:12},{default:a(()=>[e(_,{label:"库存",prop:"stock"},{default:a(()=>[e(M,{modelValue:o.stock,"onUpdate:modelValue":s[2]||(s[2]=d=>o.stock=d),min:0,precision:0,placeholder:"请输入库存",style:{width:"100%"}},null,8,["modelValue"]),s[10]||(s[10]=c("span",{class:"form-unit"},"间",-1))]),_:1})]),_:1}),e(x,{span:12},{default:a(()=>[e(_,{label:"床型"},{default:a(()=>[e(S,{modelValue:o.bedType,"onUpdate:modelValue":s[3]||(s[3]=d=>o.bedType=d),placeholder:"例如：大床、双床、单人床"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(E,{gutter:20},{default:a(()=>[e(x,{span:12},{default:a(()=>[e(_,{label:"面积"},{default:a(()=>[e(M,{modelValue:o.area,"onUpdate:modelValue":s[4]||(s[4]=d=>o.area=d),precision:2,step:1,min:0,placeholder:"请输入面积",style:{width:"100%"}},null,8,["modelValue"]),s[11]||(s[11]=c("span",{class:"form-unit"},"平方米",-1))]),_:1})]),_:1}),e(x,{span:12},{default:a(()=>[e(_,{label:"状态",prop:"status"},{default:a(()=>[e(W,{modelValue:o.status,"onUpdate:modelValue":s[5]||(s[5]=d=>o.status=d)},{default:a(()=>[e(N,{value:1},{default:a(()=>[...s[12]||(s[12]=[p("上架",-1)])]),_:1}),e(N,{value:0},{default:a(()=>[...s[13]||(s[13]=[p("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(_,{label:"设施"},{default:a(()=>[e(S,{modelValue:v.value,"onUpdate:modelValue":s[6]||(s[6]=d=>v.value=d),type:"textarea",rows:3,placeholder:"请输入设施，多个设施用逗号分隔，例如：WiFi,空调,电视,冰箱",onBlur:C},null,8,["modelValue"]),s[14]||(s[14]=c("div",{class:"form-tip"},"多个设施用逗号分隔",-1))]),_:1}),e(_,{label:"房型图片"},{default:a(()=>[e(de,{modelValue:o.images,"onUpdate:modelValue":s[7]||(s[7]=d=>o.images=d),limit:9,"max-size":5},null,8,["modelValue"]),s[15]||(s[15]=c("div",{class:"form-tip"},"最多上传9张图片，单张图片不超过5MB",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}},Xe=re(Ke,[["__scopeId","data-v-ca6039fc"]]),Ye={class:"hotel-form-container"},Ze={class:"card-header"},De={class:"rooms-toolbar"},el={key:0},ll={key:1},al={key:0},tl={key:1},ol={key:0,class:"rooms-tip"},sl={__name:"HotelForm",setup(J){const L=Me(),b=Pe(),B=f(null),T=f("basic"),U=f(!1),r=O(()=>!!b.params.id),h=O(()=>r.value?parseInt(b.params.id):null),o=f(null),v=f(""),I=f([]),k=f(!1),C=f(!1),P=f(null),t=ie({name:"",province:"",city:"",district:"",address:"",starLevel:null,description:"",images:[],facilities:[],contactPhone:"",longitude:null,latitude:null,status:1,syncSource:""}),i=f(""),s={name:[{required:!0,message:"请输入酒店名称",trigger:"blur"}],starLevel:[{required:!0,message:"请选择星级",trigger:"change"}]},S=u=>{u?(t.longitude=u.lng||null,t.latitude=u.lat||null):(t.longitude=null,t.latitude=null)},_=()=>{v.value.trim()?t.facilities=v.value.split(",").map(u=>u.trim()).filter(u=>u):t.facilities=[]},x=u=>{t.images=u},M=async()=>{if(r.value)try{const u=await ze(b.params.id);if(u.data){const l=u.data;if(t.name=l.name||"",t.province=l.province||"",t.city=l.city||"",t.district=l.district||"",t.address=l.address||"",t.starLevel=l.starLevel||null,t.description=l.description||"",t.images=Array.isArray(l.images)?l.images:[],t.facilities=Array.isArray(l.facilities)?l.facilities:[],t.contactPhone=l.contactPhone||"",t.longitude=l.longitude?parseFloat(l.longitude):null,t.latitude=l.latitude?parseFloat(l.latitude):null,t.status=l.status!==void 0?l.status:1,t.syncSource=l.syncSource||"",v.value=Array.isArray(t.facilities)?t.facilities.join(","):"",t.longitude&&t.latitude&&(o.value={lng:t.longitude,lat:t.latitude}),l.syncTime){const g=new Date(l.syncTime);i.value=g.toLocaleString("zh-CN")}E()}}catch(u){console.error("加载酒店详情失败:",u),y.error("加载酒店详情失败")}},E=async()=>{if(r.value){k.value=!0;try{const u=await Oe(h.value);u.data&&(I.value=u.data||[])}catch(u){console.error("加载房型列表失败:",u),y.error("加载房型列表失败"),I.value=[]}finally{k.value=!1}}},N=()=>{P.value=null,C.value=!0},W=u=>{P.value={...u},C.value=!0},j=async u=>{try{await X.confirm(`确定要删除房型"${u.roomType}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.value=!0;try{await We(u.id),y.success("删除成功"),E()}catch(l){console.error("删除房型失败:",l),y.error("删除房型失败")}finally{k.value=!1}}catch{}},q=async u=>{try{u.id?(await Qe(u.id,u),y.success("更新房型成功")):(await Je(u),y.success("添加房型成功")),E()}catch(l){throw console.error("保存房型失败:",l),y.error(l.message||"保存房型失败"),l}},G=async()=>{B.value&&await B.value.validate(async u=>{if(u){_(),U.value=!0;try{const l={name:t.name,province:t.province||void 0,city:t.city||void 0,district:t.district||void 0,address:t.address||void 0,starLevel:t.starLevel,description:t.description||void 0,images:Array.isArray(t.images)?t.images:[],facilities:t.facilities.length>0?t.facilities:void 0,contactPhone:t.contactPhone||void 0,longitude:t.longitude||void 0,latitude:t.latitude||void 0,status:t.status};if(r.value)await je(b.params.id,l),y.success("更新成功");else{const g=await Ge(l);y.success("创建成功"),L.push(`/hotels/edit/${g.data.id}`);return}L.push("/hotels")}catch(l){console.error("保存失败:",l),y.error(l.message||"保存失败")}finally{U.value=!1}}})},d=()=>{X.confirm("确定要取消吗？未保存的数据将丢失。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{L.push("/hotels")}).catch(()=>{})};return Se(()=>{M()}),(u,l)=>{const g=ne,V=ae,m=le,w=ee,H=Ce,me=Ue,Q=D,K=oe,pe=te,$=Re,A=Fe,fe=Le,ce=Be,ve=Ie,_e=Ee,ye=se,be=xe,ge=he;return R(),F("div",Ye,[e(be,{shadow:"never"},{header:a(()=>[c("div",Ze,[c("span",null,z(r.value?"编辑酒店":"创建酒店"),1),c("div",null,[e(g,{onClick:d},{default:a(()=>[...l[16]||(l[16]=[p("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:G,loading:U.value},{default:a(()=>[...l[17]||(l[17]=[p(" 保存 ",-1)])]),_:1},8,["loading"])])])]),default:a(()=>[e(ye,{ref_key:"formRef",ref:B,model:t,rules:s,"label-width":"120px",class:"hotel-form"},{default:a(()=>[e(_e,{modelValue:T.value,"onUpdate:modelValue":l[14]||(l[14]=n=>T.value=n),type:"border-card"},{default:a(()=>[e($,{label:"基本信息",name:"basic"},{default:a(()=>[e(Q,{gutter:20},{default:a(()=>[e(w,{span:12},{default:a(()=>[e(m,{label:"酒店名称",prop:"name"},{default:a(()=>[e(V,{modelValue:t.name,"onUpdate:modelValue":l[0]||(l[0]=n=>t.name=n),placeholder:"请输入酒店名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:12},{default:a(()=>[e(m,{label:"星级",prop:"starLevel"},{default:a(()=>[e(me,{modelValue:t.starLevel,"onUpdate:modelValue":l[1]||(l[1]=n=>t.starLevel=n),placeholder:"请选择星级",style:{width:"100%"}},{default:a(()=>[e(H,{label:"1星",value:1}),e(H,{label:"2星",value:2}),e(H,{label:"3星",value:3}),e(H,{label:"4星",value:4}),e(H,{label:"5星",value:5})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(Q,{gutter:20},{default:a(()=>[e(w,{span:8},{default:a(()=>[e(m,{label:"省份"},{default:a(()=>[e(V,{modelValue:t.province,"onUpdate:modelValue":l[2]||(l[2]=n=>t.province=n),placeholder:"请输入省份"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:8},{default:a(()=>[e(m,{label:"城市"},{default:a(()=>[e(V,{modelValue:t.city,"onUpdate:modelValue":l[3]||(l[3]=n=>t.city=n),placeholder:"请输入城市"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:8},{default:a(()=>[e(m,{label:"区县"},{default:a(()=>[e(V,{modelValue:t.district,"onUpdate:modelValue":l[4]||(l[4]=n=>t.district=n),placeholder:"请输入区县"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{label:"详细地址"},{default:a(()=>[e(V,{modelValue:t.address,"onUpdate:modelValue":l[5]||(l[5]=n=>t.address=n),type:"textarea",rows:2,placeholder:"请输入详细地址"},null,8,["modelValue"])]),_:1}),e(m,{label:"地图位置"},{default:a(()=>[e($e,{modelValue:o.value,"onUpdate:modelValue":l[6]||(l[6]=n=>o.value=n),height:"400px",onChange:S},null,8,["modelValue"]),l[18]||(l[18]=c("div",{class:"form-tip"},"点击地图选择位置，或手动输入经纬度",-1))]),_:1}),e(Q,{gutter:20},{default:a(()=>[e(w,{span:12},{default:a(()=>[e(m,{label:"联系电话"},{default:a(()=>[e(V,{modelValue:t.contactPhone,"onUpdate:modelValue":l[7]||(l[7]=n=>t.contactPhone=n),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:12},{default:a(()=>[e(m,{label:"状态",prop:"status"},{default:a(()=>[e(pe,{modelValue:t.status,"onUpdate:modelValue":l[8]||(l[8]=n=>t.status=n)},{default:a(()=>[e(K,{value:1},{default:a(()=>[...l[19]||(l[19]=[p("上架",-1)])]),_:1}),e(K,{value:0},{default:a(()=>[...l[20]||(l[20]=[p("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(m,{label:"设施"},{default:a(()=>[e(V,{modelValue:v.value,"onUpdate:modelValue":l[9]||(l[9]=n=>v.value=n),type:"textarea",rows:3,placeholder:"请输入设施，多个设施用逗号分隔，例如：WiFi,停车场,健身房,游泳池",onBlur:_},null,8,["modelValue"]),l[21]||(l[21]=c("div",{class:"form-tip"},"多个设施用逗号分隔",-1))]),_:1}),e(m,{label:"简介"},{default:a(()=>[e(qe,{modelValue:t.description,"onUpdate:modelValue":l[10]||(l[10]=n=>t.description=n),placeholder:"请输入酒店简介"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{label:"媒体资源",name:"media"},{default:a(()=>[e(m,{label:"酒店图片"},{default:a(()=>[e(de,{modelValue:t.images,"onUpdate:modelValue":l[11]||(l[11]=n=>t.images=n),limit:9,"max-size":5,onChange:x},null,8,["modelValue"]),l[22]||(l[22]=c("div",{class:"form-tip"},"最多上传9张图片，单张图片不超过5MB，支持JPG、PNG、WebP格式",-1))]),_:1})]),_:1}),e($,{label:"房型管理",name:"rooms"},{default:a(()=>[c("div",De,[e(g,{type:"primary",icon:Z(we),onClick:N,disabled:!r.value},{default:a(()=>[...l[23]||(l[23]=[p(" 添加房型 ",-1)])]),_:1},8,["icon","disabled"]),e(g,{icon:Z(Ae),onClick:E,disabled:!r.value},{default:a(()=>[...l[24]||(l[24]=[p("刷新",-1)])]),_:1},8,["icon","disabled"])]),He((R(),ue(ce,{data:I.value,stripe:"",border:"",style:{width:"100%","margin-top":"16px"}},{default:a(()=>[e(A,{prop:"roomType",label:"房型名称","min-width":"120"}),e(A,{prop:"price",label:"价格",width:"120"},{default:a(({row:n})=>[n.price?(R(),F("span",el,"¥"+z(n.price)+"/晚",1)):(R(),F("span",ll,"-"))]),_:1}),e(A,{prop:"stock",label:"库存",width:"100"}),e(A,{prop:"bedType",label:"床型",width:"120"}),e(A,{prop:"area",label:"面积",width:"100"},{default:a(({row:n})=>[n.area?(R(),F("span",al,z(n.area)+"㎡",1)):(R(),F("span",tl,"-"))]),_:1}),e(A,{prop:"status",label:"状态",width:"100"},{default:a(({row:n})=>[e(fe,{type:n.status===1?"success":"info"},{default:a(()=>[p(z(n.status===1?"上架":"下架"),1)]),_:2},1032,["type"])]),_:1}),e(A,{label:"操作",width:"150",fixed:"right"},{default:a(({row:n})=>[e(g,{link:"",type:"primary",size:"small",onClick:Ve=>W(n)},{default:a(()=>[...l[25]||(l[25]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(g,{link:"",type:"danger",size:"small",onClick:Ve=>j(n)},{default:a(()=>[...l[26]||(l[26]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ge,k.value]]),r.value?Ne("",!0):(R(),F("div",ol,[e(ve,{title:"提示",type:"info",closable:!1,"show-icon":""},{default:a(()=>[...l[27]||(l[27]=[p(" 请先保存酒店基本信息，然后才能添加房型 ",-1)])]),_:1})]))]),_:1}),e($,{label:"同步设置",name:"sync"},{default:a(()=>[e(m,{label:"同步来源"},{default:a(()=>[e(V,{modelValue:t.syncSource,"onUpdate:modelValue":l[12]||(l[12]=n=>t.syncSource=n),placeholder:"请输入同步来源",disabled:""},null,8,["modelValue"]),l[28]||(l[28]=c("div",{class:"form-tip"},"同步来源由系统自动设置",-1))]),_:1}),e(m,{label:"同步时间"},{default:a(()=>[e(V,{modelValue:i.value,"onUpdate:modelValue":l[13]||(l[13]=n=>i.value=n),placeholder:"未同步",disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1}),e(Xe,{modelValue:C.value,"onUpdate:modelValue":l[15]||(l[15]=n=>C.value=n),"room-data":P.value,"hotel-id":h.value,onSubmit:q},null,8,["modelValue","room-data","hotel-id"])])}}},vl=re(sl,[["__scopeId","data-v-ab98b308"]]);export{vl as default};
