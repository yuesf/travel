import{b as te,E as y,c as ae,d as le,e as oe,Q as ne,R as se,ae as re,g as ie,S as de,O as U,T as ue,P as pe,U as ce,V as me,W as ge,X as fe,Y as _e,o as A}from"./element-plus-BQiw23q9.js";import{a0 as S,r as b,x as ye,A as $,B as t,C as o,aY as he,o as g,ax as M,K as be,ac as ve,m as v,u as w,Q as r,D as C,M as we,O as Ce,R as N}from"./vue-vendor-Cs8obalv.js";import{g as ke,a as Ve,d as xe,b as ze}from"./articles-JJVSk3Ev.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const Se={class:"article-list-container"},Te={class:"toolbar"},Be={class:"toolbar-left"},De={class:"toolbar-right"},Ie={class:"pagination-wrapper"},Le={__name:"ArticleList",setup(Ue){const k=he(),n=S({title:"",categoryId:null,author:"",status:null}),c=b(null),T=b([]),V=b([]),m=b(!1),f=b([]),s=S({page:1,pageSize:10,total:0}),u=S({prop:null,order:null}),Y=async()=>{try{const a=await ke(1);a.data&&(T.value=(a.data||[]).filter(e=>e&&e.id!=null))}catch(a){console.error("加载分类列表失败:",a)}},d=async()=>{m.value=!0;try{const a={page:s.page,pageSize:s.pageSize,title:n.title||void 0,categoryId:n.categoryId||void 0,author:n.author||void 0,status:n.status};c.value&&c.value.length===2&&(a.startTime=c.value[0],a.endTime=c.value[1]),u.prop&&u.order&&(a.orderBy=u.prop,a.order=u.order==="ascending"?"asc":"desc");const e=await Ve(a);e.data&&(V.value=e.data.list||[],s.total=e.data.total||0)}catch(a){console.error("加载文章列表失败:",a),y.error("加载文章列表失败"),V.value=[],s.total=0}finally{m.value=!1}},x=()=>{s.page=1,d()},P=()=>{n.title="",n.categoryId=null,n.author="",n.status=null,c.value=null,u.prop=null,u.order=null,s.page=1,d()},R=a=>{s.page=a,d()},F=a=>{s.pageSize=a,s.page=1,d()},K=({prop:a,order:e})=>{u.prop=a,u.order=e,d()},O=a=>{f.value=a.map(e=>e.id)},H=()=>{k.push("/articles/create")},Q=a=>{k.push(`/articles/${a.id}`)},j=a=>{k.push(`/articles/edit/${a.id}`)},W=async a=>{try{await A.confirm(`确定要删除文章"${a.title}"吗？删除后状态将改为已下架。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.value=!0;try{await ze(a.id),y.success("删除成功"),d()}catch(e){console.error("删除文章失败:",e),y.error("删除文章失败")}finally{m.value=!1}}catch{}},X=async()=>{if(f.value.length===0){y.warning("请选择要删除的文章");return}try{await A.confirm(`确定要删除选中的 ${f.value.length} 篇文章吗？删除后状态将改为已下架。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),m.value=!0;try{await xe(f.value),y.success("批量删除成功"),f.value=[],d()}catch(a){console.error("批量删除失败:",a),y.error("批量删除失败")}finally{m.value=!1}}catch{}},B=a=>a?new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return ye(()=>{Y(),d()}),(a,e)=>{const D=oe,_=le,h=se,I=ne,q=re,p=ie,G=ae,z=te,i=me,E=ge,J=ce,Z=_e,ee=fe;return g(),$("div",Se,[t(z,{class:"search-card",shadow:"never"},{default:o(()=>[t(G,{model:n,inline:!0,class:"search-form"},{default:o(()=>[t(_,{label:"文章标题"},{default:o(()=>[t(D,{modelValue:n.title,"onUpdate:modelValue":e[0]||(e[0]=l=>n.title=l),placeholder:"请输入文章标题",clearable:"",style:{width:"200px"},onKeyup:M(x,["enter"])},null,8,["modelValue"])]),_:1}),t(_,{label:"分类"},{default:o(()=>[t(I,{modelValue:n.categoryId,"onUpdate:modelValue":e[1]||(e[1]=l=>n.categoryId=l),placeholder:"请选择分类",clearable:"",style:{width:"150px"}},{default:o(()=>[(g(!0),$(be,null,ve(T.value,l=>(g(),v(h,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"作者"},{default:o(()=>[t(D,{modelValue:n.author,"onUpdate:modelValue":e[2]||(e[2]=l=>n.author=l),placeholder:"请输入作者",clearable:"",style:{width:"150px"},onKeyup:M(x,["enter"])},null,8,["modelValue"])]),_:1}),t(_,{label:"状态"},{default:o(()=>[t(I,{modelValue:n.status,"onUpdate:modelValue":e[3]||(e[3]=l=>n.status=l),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:o(()=>[t(h,{label:"全部",value:null}),t(h,{label:"草稿",value:0}),t(h,{label:"已发布",value:1}),t(h,{label:"已下架",value:2})]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"发布时间"},{default:o(()=>[t(q,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=l=>c.value=l),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"350px"}},null,8,["modelValue"])]),_:1}),t(_,null,{default:o(()=>[t(p,{type:"primary",onClick:x,icon:w(de)},{default:o(()=>[...e[7]||(e[7]=[r("搜索",-1)])]),_:1},8,["icon"]),t(p,{onClick:P,icon:w(U)},{default:o(()=>[...e[8]||(e[8]=[r("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),t(z,{class:"toolbar-card",shadow:"never"},{default:o(()=>[C("div",Te,[C("div",Be,[t(p,{type:"primary",onClick:H,icon:w(ue)},{default:o(()=>[...e[9]||(e[9]=[r("添加文章",-1)])]),_:1},8,["icon"]),t(p,{type:"danger",disabled:f.value.length===0,onClick:X,icon:w(pe)},{default:o(()=>[...e[10]||(e[10]=[r(" 批量删除 ",-1)])]),_:1},8,["disabled","icon"])]),C("div",De,[t(p,{icon:w(U),onClick:d},{default:o(()=>[...e[11]||(e[11]=[r("刷新",-1)])]),_:1},8,["icon"])])])]),_:1}),t(z,{class:"table-card",shadow:"never"},{default:o(()=>[we((g(),v(J,{data:V.value,stripe:"",border:"",style:{width:"100%"},onSortChange:K,onSelectionChange:O},{default:o(()=>[t(i,{type:"selection",width:"55"}),t(i,{prop:"id",label:"ID",width:"80",sortable:"custom"}),t(i,{prop:"title",label:"文章标题","min-width":"200","show-overflow-tooltip":""}),t(i,{prop:"categoryName",label:"分类",width:"120"}),t(i,{prop:"author",label:"作者",width:"120"}),t(i,{prop:"status",label:"状态",width:"100"},{default:o(({row:l})=>[l.status===0?(g(),v(E,{key:0,type:"info"},{default:o(()=>[...e[12]||(e[12]=[r("草稿",-1)])]),_:1})):l.status===1?(g(),v(E,{key:1,type:"success"},{default:o(()=>[...e[13]||(e[13]=[r("已发布",-1)])]),_:1})):l.status===2?(g(),v(E,{key:2,type:"warning"},{default:o(()=>[...e[14]||(e[14]=[r("已下架",-1)])]),_:1})):Ce("",!0)]),_:1}),t(i,{prop:"viewCount",label:"阅读量",width:"100",sortable:"custom"}),t(i,{prop:"likeCount",label:"点赞量",width:"100",sortable:"custom"}),t(i,{prop:"publishTime",label:"发布时间",width:"180",sortable:"custom"},{default:o(({row:l})=>[r(N(B(l.publishTime)),1)]),_:1}),t(i,{prop:"createTime",label:"创建时间",width:"180",sortable:"custom"},{default:o(({row:l})=>[r(N(B(l.createTime)),1)]),_:1}),t(i,{label:"操作",width:"200",fixed:"right"},{default:o(({row:l})=>[t(p,{link:"",type:"primary",size:"small",onClick:L=>Q(l)},{default:o(()=>[...e[15]||(e[15]=[r("查看",-1)])]),_:1},8,["onClick"]),t(p,{link:"",type:"primary",size:"small",onClick:L=>j(l)},{default:o(()=>[...e[16]||(e[16]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(p,{link:"",type:"danger",size:"small",onClick:L=>W(l),disabled:l.status===2},{default:o(()=>[...e[17]||(e[17]=[r(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ee,m.value]]),C("div",Ie,[t(Z,{"current-page":s.page,"onUpdate:currentPage":e[5]||(e[5]=l=>s.page=l),"page-size":s.pageSize,"onUpdate:pageSize":e[6]||(e[6]=l=>s.pageSize=l),"page-sizes":[10,20,50,100],total:s.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:F,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1})])}}},Re=Ee(Le,[["__scopeId","data-v-40ab7b74"]]);export{Re as default};
