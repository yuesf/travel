import{b as ae,E as d,c as le,$ as oe,a0 as se,K as re,L as ne,d as ue,e as de,Q as ie,R as me,M as ce,a2 as pe,ae as fe,W as ge,af as _e,g as ye,o as ve}from"./element-plus-BQiw23q9.js";import{r as i,c as N,aZ as be,a0 as Ie,x as Ve,A as m,B as l,C as o,aY as he,o as n,K as E,ac as T,m as w,D as u,Q as c,O as xe,R as k,E as Y,ax as Ce}from"./vue-vendor-Cs8obalv.js";import{I as Ee}from"./ImageUpload-v2Ox_fSm.js";import{R as Te}from"./RichTextEditor-B6hxx3ZN.js";import{g as we,c as ke,e as Ae,f as Re,u as Ue,h as Be}from"./articles-JJVSk3Ev.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const De={class:"article-form-container"},Me={class:"card-header"},Le={style:{float:"left"}},Ne={key:0,style:{float:"right",color:"#8492a6","font-size":"13px"}},Ye={key:0,class:"no-tags"},qe={key:1,class:"selected-tags"},Ke={__name:"ArticleForm",setup(Se){const A=he(),b=be(),I=i(null),R=i("basic"),V=i(!1),h=N(()=>!!b.params.id),U=i([]),g=i([]),t=Ie({title:"",categoryId:null,summary:"",coverImage:"",author:"",status:0,publishTime:null,content:"",tagIds:[]}),p=i(""),_=i("#409EFF"),B=N(()=>g.value.filter(s=>t.tagIds.includes(s.id))),q={title:[{required:!0,message:"请输入文章标题",trigger:"blur"}],categoryId:[{required:!0,message:"请选择文章分类",trigger:"change"}],summary:[{required:!0,message:"请输入文章摘要",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}]},K=async()=>{try{const s=await we();s.data&&(U.value=(s.data||[]).filter(e=>e&&e.id!=null))}catch(s){console.error("加载分类列表失败:",s)}},S=async()=>{try{const s=await ke();s.data&&(g.value=(s.data||[]).filter(e=>e&&e.id!=null))}catch(s){console.error("加载标签列表失败:",s)}},z=async()=>{if(h.value)try{const s=await Ae(b.params.id);if(s.data){const e=s.data;t.title=e.title||"",t.categoryId=e.categoryId||null,t.summary=e.summary||"",t.coverImage=e.coverImage||"",t.author=e.author||"",t.status=e.status!==void 0?e.status:0,t.publishTime=e.publishTime||null,t.content=e.content||"",e.tagIds&&Array.isArray(e.tagIds)?t.tagIds=e.tagIds:e.tags&&Array.isArray(e.tags)?t.tagIds=e.tags.map(f=>f.id):t.tagIds=[]}}catch(s){console.error("加载文章详情失败:",s),d.error("加载文章详情失败")}},O=s=>{t.coverImage=s},P=s=>{t.content=s},H=s=>{t.tagIds=s},Q=s=>{const e=t.tagIds.indexOf(s);e>-1&&t.tagIds.splice(e,1)},F=async()=>{if(!p.value.trim()){d.warning("请输入标签名称");return}try{const s=await Re({name:p.value.trim(),color:_.value});s.data&&(d.success("标签创建成功"),g.value.push(s.data),t.tagIds.push(s.data.id),p.value="",_.value="#409EFF")}catch(s){console.error("创建标签失败:",s),d.error(s.message||"创建标签失败")}},$=async()=>{I.value&&await I.value.validate(async s=>{if(s){V.value=!0;try{const e={title:t.title,categoryId:t.categoryId,summary:t.summary,coverImage:t.coverImage,author:t.author,status:t.status,publishTime:t.publishTime,content:t.content,tagIds:t.tagIds};h.value?(await Ue(b.params.id,e),d.success("更新成功")):(await Be(e),d.success("创建成功")),A.push("/articles")}catch(e){console.error("保存失败:",e),d.error(e.message||"保存失败")}finally{V.value=!1}}})},G=()=>{ve.confirm("确定要取消吗？未保存的数据将丢失。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{A.push("/articles")}).catch(()=>{})};return Ve(()=>{K(),S(),z()}),(s,e)=>{const f=ye,y=de,r=ue,v=ne,D=me,M=ie,L=re,x=pe,W=ce,Z=fe,C=se,j=ge,J=_e,X=oe,ee=le,te=ae;return n(),m("div",De,[l(te,{shadow:"never"},{header:o(()=>[u("div",Me,[u("span",null,k(h.value?"编辑文章":"创建文章"),1),u("div",null,[l(f,{onClick:G},{default:o(()=>[...e[12]||(e[12]=[c("取消",-1)])]),_:1}),l(f,{type:"primary",onClick:$,loading:V.value},{default:o(()=>[...e[13]||(e[13]=[c(" 保存 ",-1)])]),_:1},8,["loading"])])])]),default:o(()=>[l(ee,{ref_key:"formRef",ref:I,model:t,rules:q,"label-width":"120px",class:"article-form"},{default:o(()=>[l(X,{modelValue:R.value,"onUpdate:modelValue":e[11]||(e[11]=a=>R.value=a),type:"border-card"},{default:o(()=>[l(C,{label:"基本信息",name:"basic"},{default:o(()=>[l(L,{gutter:20},{default:o(()=>[l(v,{span:12},{default:o(()=>[l(r,{label:"文章标题",prop:"title"},{default:o(()=>[l(y,{modelValue:t.title,"onUpdate:modelValue":e[0]||(e[0]=a=>t.title=a),placeholder:"请输入文章标题"},null,8,["modelValue"])]),_:1})]),_:1}),l(v,{span:12},{default:o(()=>[l(r,{label:"文章分类",prop:"categoryId"},{default:o(()=>[l(M,{modelValue:t.categoryId,"onUpdate:modelValue":e[1]||(e[1]=a=>t.categoryId=a),placeholder:"请选择分类",style:{width:"100%"},filterable:""},{default:o(()=>[(n(!0),m(E,null,T(U.value,a=>(n(),w(D,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(r,{label:"文章摘要",prop:"summary"},{default:o(()=>[l(y,{modelValue:t.summary,"onUpdate:modelValue":e[2]||(e[2]=a=>t.summary=a),type:"textarea",rows:3,placeholder:"请输入文章摘要",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(r,{label:"封面图",prop:"coverImage"},{default:o(()=>[l(Ee,{modelValue:t.coverImage,"onUpdate:modelValue":e[3]||(e[3]=a=>t.coverImage=a),limit:1,"max-size":5,onChange:O},null,8,["modelValue"]),e[14]||(e[14]=u("div",{class:"form-tip"},"建议尺寸：750x400px，单张图片不超过5MB",-1))]),_:1}),l(L,{gutter:20},{default:o(()=>[l(v,{span:12},{default:o(()=>[l(r,{label:"作者",prop:"author"},{default:o(()=>[l(y,{modelValue:t.author,"onUpdate:modelValue":e[4]||(e[4]=a=>t.author=a),placeholder:"请输入作者"},null,8,["modelValue"])]),_:1})]),_:1}),l(v,{span:12},{default:o(()=>[l(r,{label:"状态",prop:"status"},{default:o(()=>[l(W,{modelValue:t.status,"onUpdate:modelValue":e[5]||(e[5]=a=>t.status=a)},{default:o(()=>[l(x,{value:0},{default:o(()=>[...e[15]||(e[15]=[c("草稿",-1)])]),_:1}),l(x,{value:1},{default:o(()=>[...e[16]||(e[16]=[c("已发布",-1)])]),_:1}),l(x,{value:2},{default:o(()=>[...e[17]||(e[17]=[c("已下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(r,{label:"发布时间",prop:"publishTime"},{default:o(()=>[l(Z,{modelValue:t.publishTime,"onUpdate:modelValue":e[6]||(e[6]=a=>t.publishTime=a),type:"datetime",placeholder:"选择发布时间","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"]),e[18]||(e[18]=u("div",{class:"form-tip"},"不选择则立即发布，选择后将在指定时间自动发布",-1))]),_:1})]),_:1}),l(C,{label:"文章内容",name:"content"},{default:o(()=>[l(r,{label:"文章内容",prop:"content"},{default:o(()=>[l(Te,{modelValue:t.content,"onUpdate:modelValue":e[7]||(e[7]=a=>t.content=a),placeholder:"请输入文章内容...",onChange:P},null,8,["modelValue"])]),_:1})]),_:1}),l(C,{label:"标签设置",name:"tags"},{default:o(()=>[l(r,{label:"选择标签"},{default:o(()=>[l(M,{modelValue:t.tagIds,"onUpdate:modelValue":e[8]||(e[8]=a=>t.tagIds=a),multiple:"",placeholder:"请选择标签",style:{width:"100%"},filterable:"",onChange:H},{default:o(()=>[(n(!0),m(E,null,T(g.value,a=>(n(),w(D,{key:a.id,label:a.name,value:a.id},{default:o(()=>[u("span",Le,k(a.name),1),a.color?(n(),m("span",Ne,[u("span",{style:Y({color:a.color}),class:"tag-color-dot"},"●",4)])):xe("",!0)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"]),e[19]||(e[19]=u("div",{class:"form-tip"},"可以选择多个标签，也可以创建新标签",-1))]),_:1}),l(r,{label:"已选标签"},{default:o(()=>[B.value.length===0?(n(),m("div",Ye,"暂无标签")):(n(),m("div",qe,[(n(!0),m(E,null,T(B.value,a=>(n(),w(j,{key:a.id,type:a.color?"":"info",style:Y([a.color?{color:a.color,borderColor:a.color}:{},{"margin-right":"8px","margin-bottom":"8px"}]),closable:"",onClose:ze=>Q(a.id)},{default:o(()=>[c(k(a.name),1)]),_:2},1032,["type","style","onClose"]))),128))]))]),_:1}),l(r,{label:"创建新标签"},{default:o(()=>[l(y,{modelValue:p.value,"onUpdate:modelValue":e[9]||(e[9]=a=>p.value=a),placeholder:"请输入新标签名称",style:{width:"200px","margin-right":"10px"},onKeyup:Ce(F,["enter"])},null,8,["modelValue"]),l(J,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=a=>_.value=a)},null,8,["modelValue"]),l(f,{type:"primary",onClick:F,style:{"margin-left":"10px"}},{default:o(()=>[...e[20]||(e[20]=[c(" 创建标签 ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1})])}}},je=Fe(Ke,[["__scopeId","data-v-6e8fe759"]]);export{je as default};
