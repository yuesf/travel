import{g as N,ab as U,ac as P,ad as T,E as l}from"./element-plus-BQiw23q9.js";import{g as C}from"./index-DBeEaY1O.js";import{_ as $}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as h,r as n,v as A,A as m,o as p,B as v,O as g,C as f,u as D,Q as L,D as _,R as x}from"./vue-vendor-Cs8obalv.js";const R={class:"video-upload-container"},H={class:"el-upload__tip"},I={key:0,class:"upload-progress"},O={class:"progress-text"},Q={key:1,class:"video-preview"},W=["src"],j={__name:"VideoUpload",props:{modelValue:{type:String,default:""},limit:{type:Number,default:1},disabled:{type:Boolean,default:!1},maxSize:{type:Number,default:50}},emits:["update:modelValue","change"],setup(d,{emit:y}){const i=d,u=y,V=h(()=>"/api/v1/common/file/upload/video"),b=h(()=>({Authorization:`Bearer ${C()}`})),c=n([]),r=n(""),t=n(0);A(()=>i.modelValue,e=>{r.value=e||"",e?c.value=[{uid:"video-1",name:"video.mp4",url:e,status:"success"}]:c.value=[]},{immediate:!0});const B=e=>{const a=e.type.startsWith("video/"),s=e.type==="video/mp4",o=e.size/1024/1024<i.maxSize;return!a||!s?(l.error("只能上传MP4格式的视频文件"),!1):o?(t.value=0,!0):(l.error(`视频大小不能超过 ${i.maxSize}MB`),!1)},k=(e,a)=>{t.value=Math.round(e.loaded/e.total*100)},E=(e,a)=>{var s;if(t.value=100,e&&e.code===200){const o=((s=e.data)==null?void 0:s.url)||e.data;r.value=o,a.url=o,a.status="success",u("update:modelValue",o),u("change",o),l.success("上传成功"),setTimeout(()=>{t.value=0},1e3)}else a.status="error",t.value=0,l.error((e==null?void 0:e.message)||"上传失败")},S=(e,a)=>{a.status="error",t.value=0,console.error("上传失败:",e),l.error("上传失败，请重试")},z=()=>{r.value="",c.value=[],t.value=0,u("update:modelValue",""),u("change","")},M=()=>{l.warning(`最多只能上传 ${i.limit} 个视频`)};return(e,a)=>{const s=N,o=P,w=T;return p(),m("div",R,[v(o,{action:V.value,headers:b.value,"file-list":c.value,"on-success":E,"on-error":S,"on-progress":k,"before-upload":B,limit:d.limit,"on-exceed":M,disabled:d.disabled,"on-remove":z,accept:"video/mp4","show-file-list":!0},{tip:f(()=>[_("div",H," 只能上传MP4格式的视频，文件大小不超过"+x(d.maxSize)+"MB ",1)]),default:f(()=>[v(s,{type:"primary",icon:D(U)},{default:f(()=>[...a[0]||(a[0]=[L("上传视频",-1)])]),_:1},8,["icon"])]),_:1},8,["action","headers","file-list","limit","disabled"]),t.value>0&&t.value<100?(p(),m("div",I,[v(w,{percentage:t.value,status:t.value===100?"success":void 0,"stroke-width":8},null,8,["percentage","status"]),_("div",O,"上传中... "+x(t.value)+"%",1)])):g("",!0),r.value?(p(),m("div",Q,[_("video",{src:r.value,controls:"",style:{width:"100%","max-width":"500px","margin-top":"16px"}}," 您的浏览器不支持视频播放 ",8,W)])):g("",!0)])}}},K=$(j,[["__scopeId","data-v-5fef2d68"]]);export{K as V};
