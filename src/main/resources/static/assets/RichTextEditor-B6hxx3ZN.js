import{a4 as b}from"./vendor-x5eiJF7K.js";import{g as _}from"./index-DBeEaY1O.js";import{_ as y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as r}from"./element-plus-BQiw23q9.js";import{r as k,v as p,x as w,$ as M,A as v,o as E,D as S}from"./vue-vendor-Cs8obalv.js";const V=["id"],B={__name:"RichTextEditor",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"请输入内容..."},disabled:{type:Boolean,default:!1},id:{type:String,default:""}},emits:["update:modelValue","change"],setup(m,{expose:u,emit:f}){const o=m,l=f,d=k(null);let e=null;const g=()=>{d.value&&(e=new b(d.value,{theme:"snow",placeholder:o.placeholder,modules:{toolbar:{container:[[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{script:"sub"},{script:"super"}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["link","image","video"],["clean"]],handlers:{image:async function(){const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/jpeg,image/jpg,image/png,image/webp"),t.click(),t.onchange=async()=>{var c;const i=t.files[0];if(!i)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(i.type)){r.error("只能上传图片文件（JPG、PNG、WebP格式）");return}const x=5*1024*1024;if(i.size>x){r.error("图片大小不能超过5MB");return}const n=e.getSelection(!0);if(!n){r.warning("请先选择插入位置");return}e.insertText(n.index,"上传中...","user"),e.setSelection(n.index+3);try{const a=new FormData;a.append("file",i),a.append("module","article");const h=_(),s=await(await fetch("/api/v1/common/file/upload/image",{method:"POST",headers:{Authorization:`Bearer ${h}`},body:a})).json();if(s.code===200){const T=((c=s.data)==null?void 0:c.url)||s.data;e.deleteText(n.index,3),e.insertEmbed(n.index,"image",T,"user"),e.setSelection(n.index+1),r.success("图片上传成功")}else e.deleteText(n.index,3),r.error(s.message||"图片上传失败")}catch(a){console.error("图片上传失败:",a),e.deleteText(n.index,3),r.error("图片上传失败，请重试")}}}}}}}),o.modelValue&&(e.root.innerHTML=o.modelValue),e.on("text-change",()=>{const t=e.root.innerHTML;l("update:modelValue",t),l("change",t)}),o.disabled&&e.enable(!1))};return p(()=>o.modelValue,t=>{e&&e.root.innerHTML!==t&&(e.root.innerHTML=t||"")}),p(()=>o.disabled,t=>{e&&e.enable(!t)}),w(()=>{g()}),M(()=>{e&&(e=null)}),u({getContent:()=>(e==null?void 0:e.root.innerHTML)||"",setContent:t=>{e&&(e.root.innerHTML=t||"")},getText:()=>(e==null?void 0:e.getText())||"",focus:()=>e==null?void 0:e.focus()}),(t,i)=>(E(),v("div",{class:"rich-text-editor-container",id:o.id||void 0},[S("div",{ref_key:"editorRef",ref:d,class:"editor-wrapper"},null,512)],8,V))}},D=y(B,[["__scopeId","data-v-c81a366c"]]);export{D as R};
