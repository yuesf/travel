import{b as k,c as q,d as B,e as j,j as N,aj as b,M as F,a2 as M,ak as O,g as z,a5 as L,E as c}from"./element-plus-BQiw23q9.js";import{s as w}from"./index-DBeEaY1O.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as y,a0 as W,x as $,A as U,B as t,C as o,o as K,D as n,u as g,O as G,Q as _,R as Q}from"./vue-vendor-Cs8obalv.js";import"./vendor-x5eiJF7K.js";function T(){return w({url:"/admin/payment-config",method:"get"})}function Z(p){return w({url:"/admin/payment-config",method:"post",data:p})}function H(p,d){return w({url:`/admin/payment-config/${p}`,method:"put",data:d})}const J={class:"payment-config-container"},X={class:"card-header"},Y={class:"form-tip"},ee={key:0,class:"form-tip"},te={class:"form-tip"},ae={class:"form-tip"},le={__name:"PaymentConfig",setup(p){const d=y(null),I=y(!1),r=y(!1),m=y(null),a=W({appId:"",mchId:"",apiKey:"",notifyUrl:"",status:1,description:""}),h={appId:[{required:!0,message:"请输入AppID",trigger:"blur"},{pattern:/^wx[a-zA-Z0-9]+$/,message:"AppID格式不正确，必须以wx开头",trigger:"blur"}],mchId:[{required:!0,message:"请输入商户号",trigger:"blur"}],apiKey:[{required:!0,message:"请输入API密钥",trigger:"blur"}],notifyUrl:[{required:!0,message:"请输入支付回调地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},v=async()=>{try{const l=await T();l.code===200&&l.data?(r.value=!0,m.value=l.data.id,Object.assign(a,{appId:l.data.appId,mchId:l.data.mchId,apiKey:l.data.apiKey||"",notifyUrl:l.data.notifyUrl,status:l.data.status,description:l.data.description||""})):(r.value=!1,m.value=null)}catch(l){console.error("加载配置失败:",l),r.value=!1,m.value=null}},A=async()=>{if(d.value)try{await d.value.validate(),I.value=!0;const l={appId:a.appId,mchId:a.mchId,apiKey:a.apiKey,notifyUrl:a.notifyUrl,status:a.status,description:a.description};r.value?(l.apiKey&&l.apiKey.startsWith("****")&&delete l.apiKey,await H(m.value,l),c.success("更新配置成功")):(await Z(l),c.success("创建配置成功")),await v()}catch(l){l.message?c.error(l.message):c.error(r.value?"更新配置失败":"创建配置失败")}finally{I.value=!1}},E=()=>{d.value&&d.value.resetFields(),r.value?v():Object.assign(a,{appId:"",mchId:"",apiKey:"",notifyUrl:"",status:1,description:""})};return $(()=>{v()}),(l,e)=>{const C=L,u=j,f=N,i=B,V=M,D=F,x=z,P=q,R=k;return K(),U("div",J,[t(R,{shadow:"never"},{header:o(()=>[n("div",X,[e[7]||(e[7]=n("span",null,"支付配置",-1)),t(C,{type:"warning",closable:!1,"show-icon":"",style:{"margin-left":"10px"}},{default:o(()=>[...e[6]||(e[6]=[n("span",{style:{"font-size":"12px"}},"配置修改后立即生效，请谨慎操作",-1)])]),_:1})])]),default:o(()=>[t(P,{ref_key:"formRef",ref:d,model:a,rules:h,"label-width":"140px",class:"payment-config-form"},{default:o(()=>[t(i,{label:"小程序AppID",prop:"appId"},{default:o(()=>[t(u,{modelValue:a.appId,"onUpdate:modelValue":e[0]||(e[0]=s=>a.appId=s),placeholder:"请输入小程序AppID（必须以wx开头）",disabled:r.value,style:{width:"400px"}},null,8,["modelValue","disabled"]),n("div",Y,[t(f,null,{default:o(()=>[t(g(b))]),_:1}),e[8]||(e[8]=n("span",null,"AppID必须与小程序实际AppID一致，否则支付会失败",-1))])]),_:1}),t(i,{label:"商户号",prop:"mchId"},{default:o(()=>[t(u,{modelValue:a.mchId,"onUpdate:modelValue":e[1]||(e[1]=s=>a.mchId=s),placeholder:"请输入微信支付商户号",style:{width:"400px"}},null,8,["modelValue"])]),_:1}),t(i,{label:"API密钥",prop:"apiKey"},{default:o(()=>[t(u,{modelValue:a.apiKey,"onUpdate:modelValue":e[2]||(e[2]=s=>a.apiKey=s),type:"password",placeholder:"请输入API密钥","show-password":"",style:{width:"400px"}},null,8,["modelValue"]),r.value&&a.apiKey&&a.apiKey.startsWith("****")?(K(),U("div",ee,[t(f,null,{default:o(()=>[t(g(b))]),_:1}),e[9]||(e[9]=n("span",null,"如需更新API密钥，请输入新密钥；否则保持原值",-1))])):G("",!0)]),_:1}),t(i,{label:"支付回调地址",prop:"notifyUrl"},{default:o(()=>[t(u,{modelValue:a.notifyUrl,"onUpdate:modelValue":e[3]||(e[3]=s=>a.notifyUrl=s),placeholder:"请输入支付回调地址（完整URL）",style:{width:"500px"}},null,8,["modelValue"]),n("div",te,[t(f,null,{default:o(()=>[t(g(b))]),_:1}),e[10]||(e[10]=n("span",null,"支付成功后微信会调用此地址通知支付结果",-1))])]),_:1}),t(i,{label:"状态",prop:"status"},{default:o(()=>[t(D,{modelValue:a.status,"onUpdate:modelValue":e[4]||(e[4]=s=>a.status=s)},{default:o(()=>[t(V,{label:1},{default:o(()=>[...e[11]||(e[11]=[_("启用",-1)])]),_:1}),t(V,{label:0},{default:o(()=>[...e[12]||(e[12]=[_("禁用",-1)])]),_:1})]),_:1},8,["modelValue"]),n("div",ae,[t(f,null,{default:o(()=>[t(g(O))]),_:1}),e[13]||(e[13]=n("span",null,"禁用后，小程序将无法使用支付功能",-1))])]),_:1}),t(i,{label:"描述"},{default:o(()=>[t(u,{modelValue:a.description,"onUpdate:modelValue":e[5]||(e[5]=s=>a.description=s),type:"textarea",rows:3,placeholder:"请输入配置描述（可选）",style:{width:"500px"}},null,8,["modelValue"])]),_:1}),t(i,null,{default:o(()=>[t(x,{type:"primary",onClick:A,loading:I.value},{default:o(()=>[_(Q(r.value?"更新配置":"创建配置"),1)]),_:1},8,["loading"]),t(x,{onClick:E},{default:o(()=>[...e[14]||(e[14]=[_("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},ie=S(le,[["__scopeId","data-v-8f089704"]]);export{ie as default};
