import{b as te,a4 as ae,E as g,c as le,d as oe,e as ne,Z as se,a1 as ie,Q as re,R as de,g as ue,S as ce,O as T,T as pe,U as me,V as ge,a3 as fe,W as _e,X as ye,Y as be,o as ke}from"./element-plus-BQiw23q9.js";import{a0 as z,r as b,x as ve,A as f,B as t,C as l,aY as he,o as m,ax as Ve,D as k,u as h,Q as r,M as xe,m as B,R as V}from"./vue-vendor-Cs8obalv.js";import{g as we,d as Ce,u as Pe}from"./products-7HgEtHJ3.js";import{g as Se}from"./categories-B-2g2K6-.js";import{_ as Ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const ze={class:"product-list-container"},Ie={class:"toolbar"},Ue={class:"toolbar-left"},De={class:"toolbar-right"},Ne={key:1},Te={key:0},Be={key:1},$e={key:0,style:{"text-decoration":"line-through",color:"#999"}},Le={key:1},Fe={class:"pagination-wrapper"},Me={__name:"ProductList",setup(Re){const x=he(),n=z({name:"",categoryId:null,minPrice:null,maxPrice:null,status:null}),I=b([]),w=b([]),_=b(!1),i=z({page:1,pageSize:10,total:0}),y=b(!1),C=b(!1),s=z({productId:null,productName:"",currentStock:0,stock:0}),$=async()=>{try{const o=await Se({status:1});o.data&&(I.value=o.data||[])}catch(o){console.error("加载分类失败:",o)}},c=async()=>{_.value=!0;try{const o={page:i.page,pageSize:i.pageSize,name:n.name||void 0,categoryId:n.categoryId||void 0,minPrice:n.minPrice||void 0,maxPrice:n.maxPrice||void 0,status:n.status},e=await we(o);e.data&&(w.value=e.data.list||[],i.total=e.data.total||0)}catch(o){console.error("加载商品列表失败:",o),g.error("加载商品列表失败"),w.value=[],i.total=0}finally{_.value=!1}},U=()=>{i.page=1,c()},L=()=>{n.name="",n.categoryId=null,n.minPrice=null,n.maxPrice=null,n.status=null,i.page=1,c()},F=o=>{i.page=o,c()},M=o=>{i.pageSize=o,i.page=1,c()},R=()=>{x.push("/products/create")},O=o=>{x.push(`/products/edit/${o.id}`)},K=o=>{x.push(`/products/edit/${o.id}`)},Q=o=>{s.productId=o.id,s.productName=o.name,s.currentStock=o.stock||0,s.stock=o.stock||0,y.value=!0},Y=async()=>{if(s.stock===null||s.stock<0){g.warning("请输入有效的库存数量");return}C.value=!0;try{await Pe(s.productId,s.stock),g.success("更新库存成功"),y.value=!1,c()}catch(o){console.error("更新库存失败:",o),g.error("更新库存失败")}finally{C.value=!1}},j=async o=>{try{await ke.confirm(`确定要删除商品"${o.name}"吗？删除后状态将改为下架。`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),_.value=!0;try{await Ce(o.id),g.success("删除成功"),c()}catch(e){console.error("删除商品失败:",e),g.error("删除商品失败")}finally{_.value=!1}}catch{}},q=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return ve(()=>{$(),c()}),(o,e)=>{const D=ne,p=oe,A=se,v=ie,P=de,W=re,u=ue,N=le,S=te,d=ge,X=fe,Z=_e,G=me,H=be,J=ae,ee=ye;return m(),f("div",ze,[t(S,{class:"search-card",shadow:"never"},{default:l(()=>[t(N,{model:n,inline:!0,class:"search-form"},{default:l(()=>[t(p,{label:"商品名称"},{default:l(()=>[t(D,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=a=>n.name=a),placeholder:"请输入商品名称",clearable:"",style:{width:"200px"},onKeyup:Ve(U,["enter"])},null,8,["modelValue"])]),_:1}),t(p,{label:"分类"},{default:l(()=>[t(A,{modelValue:n.categoryId,"onUpdate:modelValue":e[1]||(e[1]=a=>n.categoryId=a),options:I.value,props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},placeholder:"请选择分类",clearable:"",style:{width:"200px"}},null,8,["modelValue","options"])]),_:1}),t(p,{label:"价格区间"},{default:l(()=>[t(v,{modelValue:n.minPrice,"onUpdate:modelValue":e[2]||(e[2]=a=>n.minPrice=a),precision:2,step:.01,min:0,placeholder:"最低价",style:{width:"120px"}},null,8,["modelValue"]),e[12]||(e[12]=k("span",{style:{margin:"0 8px"}},"-",-1)),t(v,{modelValue:n.maxPrice,"onUpdate:modelValue":e[3]||(e[3]=a=>n.maxPrice=a),precision:2,step:.01,min:0,placeholder:"最高价",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),t(p,{label:"状态"},{default:l(()=>[t(W,{modelValue:n.status,"onUpdate:modelValue":e[4]||(e[4]=a=>n.status=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:l(()=>[t(P,{label:"全部",value:null}),t(P,{label:"上架",value:1}),t(P,{label:"下架",value:0})]),_:1},8,["modelValue"])]),_:1}),t(p,null,{default:l(()=>[t(u,{type:"primary",onClick:U,icon:h(ce)},{default:l(()=>[...e[13]||(e[13]=[r("搜索",-1)])]),_:1},8,["icon"]),t(u,{onClick:L,icon:h(T)},{default:l(()=>[...e[14]||(e[14]=[r("重置",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),t(S,{class:"toolbar-card",shadow:"never"},{default:l(()=>[k("div",Ie,[k("div",Ue,[t(u,{type:"primary",onClick:R,icon:h(pe)},{default:l(()=>[...e[15]||(e[15]=[r("添加商品",-1)])]),_:1},8,["icon"])]),k("div",De,[t(u,{icon:h(T),onClick:c},{default:l(()=>[...e[16]||(e[16]=[r("刷新",-1)])]),_:1},8,["icon"])])])]),_:1}),t(S,{class:"table-card",shadow:"never"},{default:l(()=>[xe((m(),B(G,{data:w.value,stripe:"",border:"",style:{width:"100%"}},{default:l(()=>[t(d,{prop:"id",label:"ID",width:"80"}),t(d,{label:"商品图片",width:"100"},{default:l(({row:a})=>[a.images&&a.images.length>0?(m(),B(X,{key:0,src:a.images[0],"preview-src-list":a.images,fit:"cover",style:{width:"60px",height:"60px","border-radius":"4px"}},null,8,["src","preview-src-list"])):(m(),f("span",Ne,"-"))]),_:1}),t(d,{prop:"name",label:"商品名称","min-width":"150","show-overflow-tooltip":""}),t(d,{prop:"categoryName",label:"分类",width:"120"}),t(d,{prop:"price",label:"价格",width:"100",sortable:"custom"},{default:l(({row:a})=>[a.price?(m(),f("span",Te,"¥"+V(a.price),1)):(m(),f("span",Be,"-"))]),_:1}),t(d,{prop:"originalPrice",label:"原价",width:"100"},{default:l(({row:a})=>[a.originalPrice?(m(),f("span",$e," ¥"+V(a.originalPrice),1)):(m(),f("span",Le,"-"))]),_:1}),t(d,{prop:"stock",label:"库存",width:"100",sortable:"custom"}),t(d,{prop:"sales",label:"销量",width:"100",sortable:"custom"}),t(d,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[t(Z,{type:a.status===1?"success":"info"},{default:l(()=>[r(V(a.status===1?"上架":"下架"),1)]),_:2},1032,["type"])]),_:1}),t(d,{prop:"createTime",label:"创建时间",width:"180",sortable:"custom"},{default:l(({row:a})=>[r(V(q(a.createTime)),1)]),_:1}),t(d,{label:"操作",width:"250",fixed:"right"},{default:l(({row:a})=>[t(u,{link:"",type:"primary",size:"small",onClick:E=>O(a)},{default:l(()=>[...e[17]||(e[17]=[r("查看",-1)])]),_:1},8,["onClick"]),t(u,{link:"",type:"primary",size:"small",onClick:E=>K(a)},{default:l(()=>[...e[18]||(e[18]=[r("编辑",-1)])]),_:1},8,["onClick"]),t(u,{link:"",type:"primary",size:"small",onClick:E=>Q(a)},{default:l(()=>[...e[19]||(e[19]=[r("库存",-1)])]),_:1},8,["onClick"]),t(u,{link:"",type:"danger",size:"small",onClick:E=>j(a),disabled:a.status===0},{default:l(()=>[...e[20]||(e[20]=[r(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ee,_.value]]),k("div",Fe,[t(H,{"current-page":i.page,"onUpdate:currentPage":e[5]||(e[5]=a=>i.page=a),"page-size":i.pageSize,"onUpdate:pageSize":e[6]||(e[6]=a=>i.pageSize=a),"page-sizes":[10,20,50,100],total:i.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),_:1}),t(J,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=a=>y.value=a),title:"更新库存",width:"400px"},{footer:l(()=>[t(u,{onClick:e[10]||(e[10]=a=>y.value=!1)},{default:l(()=>[...e[21]||(e[21]=[r("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:Y,loading:C.value},{default:l(()=>[...e[22]||(e[22]=[r(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(N,{model:s,"label-width":"80px"},{default:l(()=>[t(p,{label:"商品名称"},{default:l(()=>[t(D,{modelValue:s.productName,"onUpdate:modelValue":e[7]||(e[7]=a=>s.productName=a),disabled:""},null,8,["modelValue"])]),_:1}),t(p,{label:"当前库存"},{default:l(()=>[t(v,{modelValue:s.currentStock,"onUpdate:modelValue":e[8]||(e[8]=a=>s.currentStock=a),disabled:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(p,{label:"新库存",required:""},{default:l(()=>[t(v,{modelValue:s.stock,"onUpdate:modelValue":e[9]||(e[9]=a=>s.stock=a),min:0,precision:0,style:{width:"100%"},placeholder:"请输入库存数量"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},We=Ee(Me,[["__scopeId","data-v-7d0f4c2e"]]);export{We as default};
