import{b as $,a4 as L,E as c,U as q,V as G,a3 as Q,W,g as X,X as j,T as H,c as P,d as Y,e as Z,a1 as ee,M as te,a2 as le,o as ae}from"./element-plus-BQiw23q9.js";import{I as oe}from"./ImageUpload-v2Ox_fSm.js";import{g as se,d as ne,u as ie,c as re}from"./miniprogram-Bq4ZPLt3.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as d,a0 as ue,x as pe,A as me,B as a,C as o,o as E,M as ce,m as fe,Q as n,R as ge,D as w,u as _e}from"./vue-vendor-Cs8obalv.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const ve={class:"ad-config-container"},ye={class:"card-header"},Ve={__name:"AdConfig",setup(be){const f=d(!1),_=d([]),u=d(!1),v=d("添加广告位"),y=d(!1),g=d(null),p=d(null),t=ue({image:"",link:"",description:"",configKey:"",sort:0,status:1}),A={image:[{required:!0,message:"请上传广告图片",trigger:"change"}],configKey:[{required:!0,message:"请输入配置键",trigger:"blur"}]},V=async()=>{f.value=!0;try{const l=await se("AD",{status:null});l.data&&(_.value=l.data.sort((e,i)=>(e.sort||0)-(i.sort||0)))}catch(l){console.error("加载广告位列表失败:",l),c.error("加载广告位列表失败")}finally{f.value=!1}},k=l=>{try{const e=typeof l.configValue=="string"?JSON.parse(l.configValue):l.configValue;return(e==null?void 0:e.image)||""}catch{return""}},D=()=>{p.value=null,v.value="添加广告位",x(),u.value=!0},K=l=>{p.value=l.id,v.value="编辑广告位";try{const e=typeof l.configValue=="string"?JSON.parse(l.configValue):l.configValue;t.image=(e==null?void 0:e.image)||"",t.link=(e==null?void 0:e.link)||"",t.description=l.description||"",t.configKey=l.configKey||"",t.sort=l.sort||0,t.status=l.status!==void 0?l.status:1}catch(e){console.error("解析广告配置失败:",e)}u.value=!0},B=async l=>{try{await ae.confirm(`确定要删除广告位"${l.description||l.configKey}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.value=!0;try{await ne(l.id),c.success("删除成功"),await V()}catch(e){console.error("删除广告位失败:",e),c.error("删除广告位失败")}finally{f.value=!1}}catch{}},I=async()=>{if(g.value)try{await g.value.validate(),y.value=!0;const l={image:t.image,link:t.link||""};p.value!==null?(await ie(p.value,{configValue:JSON.stringify(l),description:t.description,sort:t.sort,status:t.status}),c.success("更新成功")):(await re({configKey:t.configKey,configType:"AD",configValue:JSON.stringify(l),description:t.description,sort:t.sort,status:t.status}),c.success("添加成功")),u.value=!1,await V()}catch(l){l!==!1&&(console.error("提交失败:",l),c.error("提交失败"))}finally{y.value=!1}},x=()=>{t.image="",t.link="",t.description="",t.configKey="",t.sort=_.value.length>0?Math.max(..._.value.map(l=>l.sort||0))+1:1,t.status=1,g.value&&g.value.clearValidate()},T=()=>{x(),p.value=null};return pe(()=>{V()}),(l,e)=>{const i=X,r=G,h=Q,U=W,N=q,F=$,m=Y,b=Z,S=ee,C=le,M=te,R=P,z=L,J=j;return E(),me("div",ve,[a(F,{shadow:"never"},{header:o(()=>[w("div",ye,[e[9]||(e[9]=w("span",null,"广告位列表",-1)),a(i,{type:"primary",size:"small",onClick:D,icon:_e(H)},{default:o(()=>[...e[8]||(e[8]=[n(" 添加广告位 ",-1)])]),_:1},8,["icon"])])]),default:o(()=>[ce((E(),fe(N,{data:_.value,stripe:"",border:"",style:{width:"100%"}},{default:o(()=>[a(r,{prop:"id",label:"ID",width:"80"}),a(r,{label:"广告图片",width:"150"},{default:o(({row:s})=>[a(h,{src:k(s),fit:"cover",style:{width:"120px",height:"80px","border-radius":"4px"},"preview-src-list":[k(s)],"preview-teleported":""},null,8,["src","preview-src-list"])]),_:1}),a(r,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),a(r,{prop:"configKey",label:"配置键","min-width":"150","show-overflow-tooltip":""}),a(r,{prop:"sort",label:"排序",width:"80"}),a(r,{prop:"status",label:"状态",width:"100"},{default:o(({row:s})=>[a(U,{type:s.status===1?"success":"info"},{default:o(()=>[n(ge(s.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(r,{label:"操作",width:"200",fixed:"right"},{default:o(({row:s})=>[a(i,{link:"",type:"primary",size:"small",onClick:O=>K(s)},{default:o(()=>[...e[10]||(e[10]=[n(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(i,{link:"",type:"danger",size:"small",onClick:O=>B(s)},{default:o(()=>[...e[11]||(e[11]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,f.value]])]),_:1}),a(z,{modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=s=>u.value=s),title:v.value,width:"600px",onClose:T},{footer:o(()=>[a(i,{onClick:e[6]||(e[6]=s=>u.value=!1)},{default:o(()=>[...e[14]||(e[14]=[n("取消",-1)])]),_:1}),a(i,{type:"primary",onClick:I,loading:y.value},{default:o(()=>[...e[15]||(e[15]=[n(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(R,{ref_key:"adFormRef",ref:g,model:t,rules:A,"label-width":"100px"},{default:o(()=>[a(m,{label:"广告图片",prop:"image"},{default:o(()=>[a(oe,{modelValue:t.image,"onUpdate:modelValue":e[0]||(e[0]=s=>t.image=s),limit:1,"max-size":5},null,8,["modelValue"])]),_:1}),a(m,{label:"跳转链接",prop:"link"},{default:o(()=>[a(b,{modelValue:t.link,"onUpdate:modelValue":e[1]||(e[1]=s=>t.link=s),placeholder:"请输入跳转链接（可选）"},null,8,["modelValue"])]),_:1}),a(m,{label:"描述",prop:"description"},{default:o(()=>[a(b,{modelValue:t.description,"onUpdate:modelValue":e[2]||(e[2]=s=>t.description=s),type:"textarea",rows:3,placeholder:"请输入广告描述"},null,8,["modelValue"])]),_:1}),a(m,{label:"配置键",prop:"configKey"},{default:o(()=>[a(b,{modelValue:t.configKey,"onUpdate:modelValue":e[3]||(e[3]=s=>t.configKey=s),placeholder:"请输入配置键（唯一标识）",disabled:p.value!==null},null,8,["modelValue","disabled"])]),_:1}),a(m,{label:"排序",prop:"sort"},{default:o(()=>[a(S,{modelValue:t.sort,"onUpdate:modelValue":e[4]||(e[4]=s=>t.sort=s),min:0,max:999},null,8,["modelValue"])]),_:1}),a(m,{label:"状态",prop:"status"},{default:o(()=>[a(M,{modelValue:t.status,"onUpdate:modelValue":e[5]||(e[5]=s=>t.status=s)},{default:o(()=>[a(C,{value:1},{default:o(()=>[...e[12]||(e[12]=[n("启用",-1)])]),_:1}),a(C,{value:0},{default:o(()=>[...e[13]||(e[13]=[n("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ke=de(Ve,[["__scopeId","data-v-0e43c682"]]);export{Ke as default};
