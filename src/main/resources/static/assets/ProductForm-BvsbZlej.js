import{b as W,E as p,c as Y,$ as H,a0 as X,K as ee,L as ae,d as le,e as te,Z as oe,a1 as se,M as re,a2 as ne,g as ie,P as ue,T as de,o as pe}from"./element-plus-BQiw23q9.js";import{r as c,c as ce,aZ as me,a0 as fe,v as R,x as ge,A as y,B as l,C as t,aY as ve,o as _,D as u,Q as f,K as ye,ac as _e,u as T,R as be,G as Ve}from"./vue-vendor-Cs8obalv.js";import{I as ke}from"./ImageUpload-v2Ox_fSm.js";import{R as we}from"./RichTextEditor-B6hxx3ZN.js";import{a as xe,b as Ee,c as Ce}from"./products-7HgEtHJ3.js";import{g as Ue}from"./categories-B-2g2K6-.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vendor-x5eiJF7K.js";import"./index-DBeEaY1O.js";const Pe={class:"product-form-container"},Se={class:"card-header"},Ne={id:"product-images"},he={key:0,class:"spec-form-mode"},Oe={key:1,class:"spec-json-mode"},Je={__name:"ProductForm",setup(Re){const S=ve(),w=me(),x=c(null),b=c(null),N=c("basic"),E=c(!1),C=ce(()=>!!w.params.id),h=c([]),g=c("form"),m=c([]),d=c(""),a=fe({name:"",categoryId:null,price:null,originalPrice:null,stock:null,description:"",images:[],specifications:{},status:1}),B={name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],stock:[{required:!0,message:"请输入库存",trigger:"blur"}]},F=async()=>{try{const o=await Ue({status:1});if(o.data){const e=n=>n.filter(r=>r&&r.id!=null).map(r=>({...r,children:r.children?e(r.children):void 0}));h.value=e(o.data||[])}}catch(o){console.error("加载分类失败:",o)}},j=async()=>{if(C.value)try{const o=await xe(w.params.id);if(o.data){const e=o.data;a.name=e.name||"",a.categoryId=e.categoryId||null,a.price=e.price?parseFloat(e.price):null,a.originalPrice=e.originalPrice?parseFloat(e.originalPrice):null,a.stock=e.stock||null,a.description=e.description||"",a.images=Array.isArray(e.images)?e.images:e.images?[e.images]:[],a.specifications=e.specifications||{},a.status=e.status!==void 0?e.status:1,a.specifications&&Object.keys(a.specifications).length>0&&(m.value=Object.keys(a.specifications).map(n=>({key:n,value:a.specifications[n]})),d.value=JSON.stringify(a.specifications,null,2))}}catch(o){console.error("加载商品详情失败:",o),p.error("加载商品详情失败")}},A=o=>{a.images=o},M=o=>{o==="images"&&Ve(()=>{b.value&&b.value.refresh&&b.value.refresh()})},D=()=>{m.value.push({key:"",value:""})},G=o=>{m.value.splice(o,1)},L=()=>{try{if(d.value.trim()){const o=JSON.parse(d.value);typeof o=="object"&&!Array.isArray(o)?a.specifications=o:p.warning("规格必须是JSON对象格式")}else a.specifications={}}catch{p.warning("JSON格式错误，请检查")}};R(()=>m.value,()=>{if(g.value==="form"){const o={};m.value.forEach(e=>{e.key&&e.value&&(o[e.key]=e.value)}),a.specifications=o}},{deep:!0}),R(g,o=>{o==="json"?d.value=JSON.stringify(a.specifications,null,2):m.value=Object.keys(a.specifications||{}).map(e=>({key:e,value:a.specifications[e]}))});const q=async()=>{x.value&&await x.value.validate(async o=>{if(o){if(g.value==="json")try{if(d.value.trim()){const e=JSON.parse(d.value);if(typeof e!="object"||Array.isArray(e)){p.warning("规格必须是JSON对象格式");return}a.specifications=e}else a.specifications={}}catch{p.warning("JSON格式错误，请检查");return}E.value=!0;try{const e={...a,images:Array.isArray(a.images)?a.images:[],specifications:a.specifications||{}};C.value?(await Ee(w.params.id,e),p.success("更新成功")):(await Ce(e),p.success("创建成功")),S.push("/products")}catch(e){console.error("保存失败:",e),p.error(e.message||"保存失败")}finally{E.value=!1}}})},K=()=>{pe.confirm("确定要取消吗？未保存的数据将丢失。","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{S.push("/products")}).catch(()=>{})};return ge(()=>{F(),j()}),(o,e)=>{const n=ie,r=te,i=le,v=ae,Z=oe,U=ee,I=se,V=ne,O=re,P=X,$=H,z=Y,Q=W;return _(),y("div",Pe,[l(Q,{shadow:"never"},{header:t(()=>[u("div",Se,[u("span",null,be(C.value?"编辑商品":"创建商品"),1),u("div",null,[l(n,{onClick:K},{default:t(()=>[...e[11]||(e[11]=[f("取消",-1)])]),_:1}),l(n,{type:"primary",onClick:q,loading:E.value},{default:t(()=>[...e[12]||(e[12]=[f(" 保存 ",-1)])]),_:1},8,["loading"])])])]),default:t(()=>[l(z,{ref_key:"formRef",ref:x,model:a,rules:B,"label-width":"120px",class:"product-form"},{default:t(()=>[l($,{modelValue:N.value,"onUpdate:modelValue":e[10]||(e[10]=s=>N.value=s),type:"border-card",onTabChange:M},{default:t(()=>[l(P,{label:"基本信息",name:"basic"},{default:t(()=>[l(U,{gutter:20},{default:t(()=>[l(v,{span:12},{default:t(()=>[l(i,{label:"商品名称",prop:"name"},{default:t(()=>[l(r,{id:"product-name",modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=s=>a.name=s),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1})]),_:1}),l(v,{span:12},{default:t(()=>[l(i,{label:"商品分类",prop:"categoryId"},{default:t(()=>[l(Z,{id:"product-category",modelValue:a.categoryId,"onUpdate:modelValue":e[1]||(e[1]=s=>a.categoryId=s),options:h.value,props:{value:"id",label:"name",children:"children",checkStrictly:!0,emitPath:!1},placeholder:"请选择商品分类",clearable:"",style:{width:"100%"},filterable:!1},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),l(U,{gutter:20},{default:t(()=>[l(v,{span:12},{default:t(()=>[l(i,{label:"价格",prop:"price"},{default:t(()=>[l(I,{id:"product-price",modelValue:a.price,"onUpdate:modelValue":e[2]||(e[2]=s=>a.price=s),precision:2,step:.01,min:0,placeholder:"请输入价格",style:{width:"100%"}},null,8,["modelValue"]),e[13]||(e[13]=u("span",{class:"form-unit"},"元",-1))]),_:1})]),_:1}),l(v,{span:12},{default:t(()=>[l(i,{label:"原价"},{default:t(()=>[l(I,{id:"product-original-price",modelValue:a.originalPrice,"onUpdate:modelValue":e[3]||(e[3]=s=>a.originalPrice=s),precision:2,step:.01,min:0,placeholder:"请输入原价（可选）",style:{width:"100%"}},null,8,["modelValue"]),e[14]||(e[14]=u("span",{class:"form-unit"},"元",-1))]),_:1})]),_:1})]),_:1}),l(U,{gutter:20},{default:t(()=>[l(v,{span:12},{default:t(()=>[l(i,{label:"库存",prop:"stock"},{default:t(()=>[l(I,{id:"product-stock",modelValue:a.stock,"onUpdate:modelValue":e[4]||(e[4]=s=>a.stock=s),min:0,precision:0,placeholder:"请输入库存",style:{width:"100%"}},null,8,["modelValue"]),e[15]||(e[15]=u("span",{class:"form-unit"},"件",-1))]),_:1})]),_:1}),l(v,{span:12},{default:t(()=>[l(i,{label:"状态",prop:"status"},{default:t(()=>[l(O,{id:"product-status",modelValue:a.status,"onUpdate:modelValue":e[5]||(e[5]=s=>a.status=s)},{default:t(()=>[l(V,{value:1},{default:t(()=>[...e[16]||(e[16]=[f("上架",-1)])]),_:1}),l(V,{value:0},{default:t(()=>[...e[17]||(e[17]=[f("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(i,{label:"商品描述"},{default:t(()=>[l(we,{id:"product-description",modelValue:a.description,"onUpdate:modelValue":e[6]||(e[6]=s=>a.description=s),placeholder:"请输入商品描述"},null,8,["modelValue"])]),_:1})]),_:1}),l(P,{label:"商品图片",name:"images"},{default:t(()=>[l(i,{label:"商品图片"},{default:t(()=>[u("div",Ne,[l(ke,{ref_key:"imageUploadRef",ref:b,modelValue:a.images,"onUpdate:modelValue":e[7]||(e[7]=s=>a.images=s),limit:9,"max-size":5,onChange:A},null,8,["modelValue"])]),e[18]||(e[18]=u("div",{class:"form-tip"},"最多上传9张图片，单张图片不超过5MB，支持JPG、PNG、WebP格式",-1))]),_:1})]),_:1}),l(P,{label:"商品规格",name:"specifications"},{default:t(()=>[l(i,{label:"规格设置"},{default:t(()=>[l(O,{id:"product-spec-mode",modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=s=>g.value=s),style:{"margin-bottom":"16px"}},{default:t(()=>[l(V,{value:"form"},{default:t(()=>[...e[19]||(e[19]=[f("表单模式",-1)])]),_:1}),l(V,{value:"json"},{default:t(()=>[...e[20]||(e[20]=[f("JSON模式",-1)])]),_:1})]),_:1},8,["modelValue"]),g.value==="form"?(_(),y("div",he,[(_(!0),y(ye,null,_e(m.value,(s,J)=>(_(),y("div",{key:J,class:"spec-form-item"},[l(r,{modelValue:s.key,"onUpdate:modelValue":k=>s.key=k,placeholder:"规格名称",style:{width:"200px","margin-right":"8px"}},null,8,["modelValue","onUpdate:modelValue"]),l(r,{modelValue:s.value,"onUpdate:modelValue":k=>s.value=k,placeholder:"规格值",style:{width:"200px","margin-right":"8px"}},null,8,["modelValue","onUpdate:modelValue"]),l(n,{type:"danger",icon:T(ue),circle:"",onClick:k=>G(J)},null,8,["icon","onClick"])]))),128)),l(n,{type:"primary",icon:T(de),onClick:D,style:{"margin-top":"8px"}},{default:t(()=>[...e[21]||(e[21]=[f(" 添加规格 ",-1)])]),_:1},8,["icon"])])):(_(),y("div",Oe,[l(r,{modelValue:d.value,"onUpdate:modelValue":e[9]||(e[9]=s=>d.value=s),type:"textarea",rows:10,placeholder:'请输入JSON格式的规格，例如：{"颜色": "红色", "尺寸": "L", "材质": "纯棉"}',onBlur:L},null,8,["modelValue"]),e[22]||(e[22]=u("div",{class:"form-tip"},' JSON格式示例：{"颜色": "红色", "尺寸": "L", "材质": "纯棉"} ',-1))]))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["model"])]),_:1})])}}},qe=Ie(Je,[["__scopeId","data-v-ccca1b81"]]);export{qe as default};
