<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.travel.mapper.OrderItemMapper">

    <resultMap id="BaseResultMap" type="com.travel.entity.OrderItem">
        <id column="id" property="id"/>
        <result column="order_id" property="orderId"/>
        <result column="item_type" property="itemType"/>
        <result column="item_id" property="itemId"/>
        <result column="item_name" property="itemName"/>
        <result column="item_image" property="itemImage"/>
        <result column="item_code" property="itemCode"/>
        <result column="quantity" property="quantity"/>
        <result column="price" property="price"/>
        <result column="total_price" property="totalPrice"/>
        <result column="check_in_date" property="checkInDate"/>
        <result column="check_out_date" property="checkOutDate"/>
        <result column="use_date" property="useDate"/>
        <result column="create_time" property="createTime"/>
    </resultMap>

    <sql id="Base_Column_List">
        id, order_id, item_type, item_id, item_name, item_image, item_code,
        quantity, price, total_price,
        check_in_date, check_out_date, use_date, create_time
    </sql>

    <!-- 根据订单ID查询订单明细列表 -->
    <select id="selectByOrderId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM order_item
        WHERE order_id = #{orderId}
        ORDER BY id ASC
    </select>

    <!-- 批量查询订单项（根据订单ID列表） -->
    <select id="selectByOrderIds" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM order_item
        WHERE order_id IN
        <foreach collection="orderIds" item="orderId" open="(" separator="," close=")">
            #{orderId}
        </foreach>
        ORDER BY order_id ASC, id ASC
    </select>

    <!-- 批量插入订单明细 -->
    <insert id="insertBatch">
        INSERT INTO order_item (
            order_id, item_type, item_id, item_name, item_image, item_code,
            quantity, price, total_price,
            check_in_date, check_out_date, use_date
        ) VALUES
        <foreach collection="items" item="item" separator=",">
            (
                #{item.orderId}, #{item.itemType}, #{item.itemId}, #{item.itemName},
                #{item.itemImage}, #{item.itemCode},
                #{item.quantity}, #{item.price}, #{item.totalPrice},
                #{item.checkInDate}, #{item.checkOutDate}, #{item.useDate}
            )
        </foreach>
    </insert>

</mapper>
